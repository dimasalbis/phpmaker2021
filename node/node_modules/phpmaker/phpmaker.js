/**
 *
 * Node module for PHPMaker 2021
 * @license (C) 2021 e.World Technology Limited. All rights reserved.
 *
 */
"use strict";var regExpChars=/[|\\{}()[\]^$+*?.]/g;exports.escapeRegExpChars=function(e){return e?String(e).replace(regExpChars,"\\$&"):""},exports.shallowCopy=function(e,l){for(var t in l=l||{})e[t]=l[t];return e},exports.shallowCopyFromList=function(e,l,t){for(var a=0;a<t.length;a++){var d=t[a];void 0!==l[d]&&(e[d]=l[d])}return e},exports.cache={_data:{},set:function(e,l){this._data[e]=l},get:function(e){return this._data[e]},remove:function(e){delete this._data[e]},reset:function(){this._data={}}};var utils=Object.assign({},exports),fs=require("fs"),path=require("path"),_DEFAULT_OPEN_DELIMITER=(utils=utils||require("./utils"),"<"),_DEFAULT_CLOSE_DELIMITER=">",_DEFAULT_DELIMITER="%",_DEFAULT_LOCALS_NAME="locals",_REGEX_STRING="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",_OPTS_PASSABLE_WITH_DATA=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],_BOM=/^\uFEFF/;function resolvePaths(e,l){var t;if(l.some((function(l){return t=exports.resolveInclude(e,l,!0),fs.existsSync(t)})))return t}function getIncludePath(e,l){var t,a,d=l.views,r=/^[A-Za-z]+:\\|^\//.exec(e);if(r&&r.length)e=e.replace(/^\/*/,""),t=Array.isArray(l.root)?resolvePaths(e,l.root):exports.resolveInclude(e,l.root||"/",!0);else if(l.filename&&(a=exports.resolveInclude(e,l.filename),fs.existsSync(a)&&(t=a)),!t&&Array.isArray(d)&&(t=resolvePaths(e,d)),!t&&"function"!=typeof l.includer)throw new Error('Could not find the include file "'+l.escapeFunction(e)+'"');return t}function handleCache(e,l){var t,a=e.filename,d=arguments.length>1;if(e.cache){if(!a)throw new Error("Cache option requires a filename");if(t=exports.cache.get(a))return t;d||(l=fileLoader(a).toString().replace(_BOM,""))}else if(!d){if(!a)throw new Error("No file name or template provided");l=fileLoader(a).toString().replace(_BOM,"")}return t=exports.compile(l,e),e.cache&&exports.cache.set(a,t),t}function fileLoader(e){return exports.fileLoader(e)}function includeFile(e,l){var t=utils.shallowCopy({},l);if(t.filename=getIncludePath(e,t),"function"==typeof l.includer){var a=l.includer(e,t.filename);if(a&&(a.filename&&(t.filename=a.filename),a.template))return handleCache(t,a.template)}return handleCache(t)}function rethrow(e,l,t,a,d){var r=l.split("\n"),n=Math.max(a-3,0),i=Math.min(r.length,a+3),p=d(t),s=r.slice(n,i).map((function(e,l){var t=l+n+1;return(t==a?" >> ":"    ")+t+"| "+e})).join("\n");throw e.path=p,e.message=(p||"ejs")+":"+a+"\n"+s+"\n\n"+e.message,e}function stripSemi(e,l){return e=e.replace(/;+(\s*$)/,"$1"),l?`String(${e}).replace(/\\n/g, '\\n${l.replace(/\t/g,"\\t")}')`:e}function Template(e,l){l=l||{};var t={};this.templateText=e,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",this.indents="",t.client=l.client||!1,t.escapeFunction=l.escape||l.escapeFunction||utils.escapeXML,t.compileDebug=!1!==l.compileDebug,t.debug=!!l.debug,t.filename=l.filename,t.openDelimiter=l.openDelimiter||exports.openDelimiter||_DEFAULT_OPEN_DELIMITER,t.closeDelimiter=l.closeDelimiter||exports.closeDelimiter||_DEFAULT_CLOSE_DELIMITER,t.delimiter=l.delimiter||exports.delimiter||_DEFAULT_DELIMITER,t.strict=l.strict||!1,t.context=l.context,t.cache=l.cache||!1,t.rmWhitespace=l.rmWhitespace,t.root=l.root,t.includer=l.includer,t.outputFunctionName=l.outputFunctionName,t.localsName=l.localsName||exports.localsName||_DEFAULT_LOCALS_NAME,t.views=l.views,t.async=l.async,t.destructuredLocals=l.destructuredLocals,t.legacyInclude=void 0===l.legacyInclude||!!l.legacyInclude,t.eventName=l.eventName,t.strict?t._with=!1:t._with=void 0===l._with||l._with,this.opts=t,this.regex=this.createRegex()}exports.cache=utils.cache,exports.fileLoader=fs.readFileSync,exports.localsName=_DEFAULT_LOCALS_NAME,exports.promiseImpl=new Function("return this;")().Promise,exports.resolveInclude=function(e,l,t){var a=path.dirname,d=path.extname,r=(0,path.resolve)(t?l:a(l),e);return d(e)||(r+=".ejs"),r},exports.compile=function(e,l){return new Template(e,l).compile()},exports.render=function(e,l,t){var a=l||{},d=t||{};return 2==arguments.length&&utils.shallowCopyFromList(d,a,_OPTS_PASSABLE_WITH_DATA),handleCache(d,e)(a)},exports.Template=Template,exports.clearCache=function(){exports.cache.reset()},Template.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"},Template.prototype={createRegex:function(){var e=_REGEX_STRING,l=utils.escapeRegExpChars(this.opts.delimiter),t=utils.escapeRegExpChars(this.opts.openDelimiter),a=utils.escapeRegExpChars(this.opts.closeDelimiter);return e=e.replace(/%/g,l).replace(/</g,t).replace(/>/g,a),new RegExp(e)},compile:function(){var e,l,t,a=this.opts,d="",r="",n=a.escapeFunction;if(!this.source){if(this.generateSource(),d+='  var __output = "";\n  function __append(s) { if (s !== undefined && s !== null) __output += s }\n',a.outputFunctionName&&(d+="  var "+a.outputFunctionName+" = __append;\n"),a.destructuredLocals&&a.destructuredLocals.length){for(var i="  var __locals = ("+a.localsName+" || {}),\n",p=0;p<a.destructuredLocals.length;p++){var s=a.destructuredLocals[p];p>0&&(i+=",\n  "),i+=s+" = __locals."+s}d+=i+";\n"}!1!==a._with&&(d+="  with ("+a.localsName+" || {}) {\n",r+="  }\n"),r+='  let __args = { "arguments": arguments[0], "code": __output };',a.eventName&&(r+='Events.emit("'+a.eventName+'", __args);'),r+='  if (args && "code" in args) args.code = args.code.trimEnd() + "\\n\\n" + __args.code.replace(/^[\\r\\n]*/g, "");\n',r+="  return __args.code;\n",this.source=d+this.source+r}e=a.compileDebug?"var __line = 1\n  , __lines = "+JSON.stringify(this.templateText)+"\n  , __filename = "+(a.filename?JSON.stringify(a.filename):"undefined")+";\ntry {\n"+this.source+"} catch (e) {\n  rethrow(e, __lines, __filename, __line, escapeFn);\n}\n":this.source,a.client&&(e="escapeFn = escapeFn || "+n.toString()+";\n"+e,a.compileDebug&&(e="rethrow = rethrow || "+rethrow.toString()+";\n"+e)),a.strict&&(e='"use strict";\n'+e),a.debug&&console.log(e),a.compileDebug&&a.filename&&(e=e+"\n//# sourceURL="+a.filename+"\n");try{if(a.async)try{t=new Function("return (async function(){}).constructor;")()}catch(e){throw e instanceof SyntaxError?new Error("This environment does not support async/await"):e}else t=Function;l=new t(a.localsName+", escapeFn, include, rethrow",e)}catch(e){throw e instanceof SyntaxError&&(a.filename&&(e.message+=" in "+a.filename),e.message+=" while compiling ejs\n\n"),e}var o=a.client?l:function(e){return l.apply(a.context,[e||{},n,function(l,t){var d=utils.shallowCopy({},e);return t&&(d=utils.shallowCopy(d,t)),includeFile(l,Object.assign({},a,{eventName:GetEventName(l)}))(d)},rethrow])};if(a.filename&&"function"==typeof Object.defineProperty){var _=a.filename,c=path.basename(_,path.extname(_));try{Object.defineProperty(o,"name",{value:c,writable:!1,enumerable:!1,configurable:!0})}catch(e){}}return o},generateSource:function(){this.opts.rmWhitespace&&(this.templateText=this.templateText.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),this.templateText=this.templateText.replace(/[ \t]*<#_/g,"<#_").replace(/_#>[ \t]*/g,"_#>");var e=this,l=this.parseTemplateText(),t=this.opts.delimiter,a=this.opts.openDelimiter,d=this.opts.closeDelimiter;l&&l.length&&l.forEach((function(r,n){var i;if(0===r.indexOf(a+t)&&0!==r.indexOf(a+t+t)&&(i=l[n+2])!=t+d&&i!="-"+t+d&&i!="_"+t+d)throw console.log(e.templateText),new Error('Could not find matching close tag for "'+r+'".');if((r==a+t+"="||r==a+t+"-")&&n>0){let t=l[n-1].match(/\n([\t ]+)$/);e.indents=t&&t[1]?t[1]:""}e.scanLine(r)}))},parseTemplateText:function(){for(var e,l=this.templateText,t=this.regex,a=t.exec(l),d=[];a;)0!==(e=a.index)&&(d.push(l.substring(0,e)),l=l.slice(e)),d.push(a[0]),l=l.slice(a[0].length),a=t.exec(l);return l&&d.push(l),d},_addOutput:function(e){if(this.truncate&&(e=e.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!e)return e;e=(e=(e=(e=e.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/"/g,'\\"'),this.source+='    ; __append("'+e+'")\n'},scanLine:function(e){var l,t=this.opts.delimiter,a=this.opts.openDelimiter,d=this.opts.closeDelimiter;switch(l=e.split("\n").length-1,e){case a+t:case a+t+"_":this.mode=Template.modes.EVAL;break;case a+t+"=":this.mode=Template.modes.ESCAPED;break;case a+t+"-":this.mode=Template.modes.RAW;break;case a+t+"#":this.mode=Template.modes.COMMENT;break;case a+t+t:this.mode=Template.modes.LITERAL,this.source+='    ; __append("'+e.replace(a+t+t,a+t)+'")\n';break;case t+t+d:this.mode=Template.modes.LITERAL,this.source+='    ; __append("'+e.replace(t+t+d,t+d)+'")\n';break;case t+d:case"-"+t+d:case"_"+t+d:this.mode==Template.modes.LITERAL&&this._addOutput(e),this.mode=null,this.truncate=0===e.indexOf("-")||0===e.indexOf("_");break;default:if(this.mode){switch(this.mode){case Template.modes.EVAL:case Template.modes.ESCAPED:case Template.modes.RAW:e.lastIndexOf("//")>e.lastIndexOf("\n")&&(e+="\n")}switch(this.mode){case Template.modes.EVAL:this.source+="    ; "+e+"\n";break;case Template.modes.ESCAPED:case Template.modes.RAW:this.source+="    ; __append("+stripSemi(e,this.indents)+")\n";break;case Template.modes.COMMENT:break;case Template.modes.LITERAL:this._addOutput(e)}}else this._addOutput(e)}this.opts.compileDebug&&l&&(this.currentLine+=l,this.source+="    ; __line = "+this.currentLine+"\n")}};var ejs=exports;global.sources={Charset:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{};let charSet=RemoveQuotes(PROJ.CharSet);if(!IsEmpty(charSet))write(`<meta charset="${charSet}">`);let __args={arguments:arguments[0],code:__output};Events.emit("Charset",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ConnectionString:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{db:db}=_arguments;let connection="";if(["ACCESS","SQLITE"].includes(db.DBType)){let relPath=db.DBPath;if(!IsEmpty(relPath)){relPath=relPath.replace(/\\//g,"\\\\");if(!relPath.endsWith("\\\\"))relPath+="\\\\"}let dbName=db.DBPhyPath.substr(db.DBPhyPath.lastIndexOf("\\\\")+1);if(db.DBType=="SQLITE"){connection=`["relpath" => "${Code.quote(relPath)}", "dbname" => "${Code.quote(dbName)}"]`}else{let isAccDb=dbName.toUpperCase().endsWith(".ACCDB"),provider=isAccDb?"Provider=Microsoft.ACE.OLEDB.12.0":"Provider=Microsoft.Jet.OLEDB.4.0";connection=`["provider" => "${provider}", "relpath" => "${Code.quote(relPath)}", "dbname" => "${Code.quote(dbName)}", "password" => "${Code.quote(db.DBPwd)}"]`}}else{if(!IsEmpty(db.DBConnstr)){let connStr=db.DBConnstr;if(ContainsText(connStr,"SQLNCLI")&&db.DBDataTypeCompat)connStr+=";DataTypeCompatibility=80";connection=`["connectionstring" => "${Code.quote(connStr)}"]`}else{connection=`["connectionstring" => "dsn=${Code.quote(db.DBName)};uid=${Code.quote(db.DBUID)};pwd=${Code.quote(db.DBPwd)}"]`}}write(connection);let __args={arguments:arguments[0],code:__output};Events.emit("ConnectionString",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',CrosstabSql:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl}=_arguments;let table=tbl||TABLE;let reportName=table.TblName,tableName=table.TblRptSrc,srcTable=GetTableObject(tableName),dbId=GetDbId(tableName),selectPart,fromPart,wherePart,groupByPart,havingPart,limitPart;if(srcTable.TblType=="CUSTOMVIEW"){limitPart=SqlPart(srcTable.TblCustomSQL,"LIMIT").trim();groupByPart=SqlPart(srcTable.TblCustomSQL,"GROUP BY").trim();havingPart=SqlPart(srcTable.TblCustomSQL,"HAVING").trim();if(!IsEmpty(limitPart)||!IsEmpty(groupByPart)&&!IsEmpty(havingPart)){selectPart="*";fromPart="("+srcTable.TblCustomSQL+") "+QuotedName("CV_"+table.TblVar,dbId);wherePart=""}else{fromPart=SqlPart(srcTable.TblCustomSQL,"FROM");wherePart=SqlPart(srcTable.TblCustomSQL,"WHERE")}}else{fromPart=SqlTableName(srcTable,dbId);let selectCustom=srcTable.Fields.filter((f=>f.FldGenerate&&f.FldIsCustom)).map((f=>(f.FldSQL==""?"\'\'":Quote(f.FldSQL))+" AS "+QuotedName(f.FldName,dbId))).join(", ");if(selectCustom!="")fromPart="(SELECT *, "+selectCustom+" FROM "+fromPart+") "+QuotedName("CV_"+table.TblVar,dbId);wherePart=""}let rowFields=table.Fields.filter((f=>f.FldRowID>0)).slice().sort(((f1,f2)=>f1.FldRowID-f2.FldRowID));let columnFields=table.Fields.filter((f=>f.FldColumnID>0)).slice();if(columnFields.length==0)throw new Error("No column field defined");let columnField=columnFields[0],columnDateType=GetFieldType(columnField.FldType)==2?columnField.FldColumnDateType:"",columnDateSelect=columnField.FldColumnDateSelect&&["q","m"].includes(columnDateType);let sqlRowFlds=rowFields.map((f=>FieldSqlName(f,dbId))).join(", "),sqlRowFlds2=rowFields.map((f=>FieldSqlName(f,dbId)+(!IsEmpty(f.FldSourceName)&&f.FldSourceName!=f.FldName?" AS "+QuotedName(f.FldName,dbId):""))).join(", "),sqlOrderFlds=rowFields.map((f=>FieldSqlName(f,dbId)+(!IsEmpty(f.FldOrder)?" "+f.FldOrder:""))).join(", ");let sqlColFld=FieldSqlName(columnField,dbId),sqlDistinctValues="",sqlColYearFld="",sqlColYearAlias="";if(["q","m"].includes(columnDateType)){sqlColYearFld=DbGroupSql("y",0,dbId);sqlColYearFld=sqlColYearFld.replace(/%s/g,sqlColFld);sqlColYearAlias="YEAR__"+columnField.FldParm}selectPart=sqlRowFlds2;let selectAggPart="";if(!IsEmpty(sqlColYearFld)){selectPart+=", "+sqlColYearFld;if(columnDateSelect)selectAggPart=sqlColYearFld;if(!IsEmpty(sqlColYearAlias)){selectPart+=" AS "+QuotedName(sqlColYearAlias,dbId);if(columnDateSelect)selectAggPart+=" AS "+QuotedName(sqlColYearAlias,dbId)}}groupByPart=sqlRowFlds;let groupByAggPart="";if(!IsEmpty(sqlColYearFld)){groupByPart+=", "+sqlColYearFld;if(columnDateSelect)groupByAggPart=sqlColYearFld}if(!IsEmpty(sqlColYearFld))sqlOrderFlds+=", "+sqlColYearFld;let orderByPart=sqlOrderFlds;return{TRANSFORM:"",SELECT:selectPart,"SELECT AGGREGATE":selectAggPart,FROM:fromPart,WHERE:wherePart,"GROUP BY":groupByPart,"GROUP BY AGGREGATE":groupByAggPart,"ORDER BY":orderByPart,PIVOT:""};let __args={arguments:arguments[0],code:__output};Events.emit("CrosstabSql",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',CrosstabYearSql:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl}=_arguments;let table=tbl||TABLE;let reportName=table.TblName,tableName=table.TblRptSrc,srcTable=GetTableObject(tableName),dbId=GetDbId(tableName),selectPart,fromPart,wherePart,groupByPart,havingPart,limitPart,orderByPart;if(srcTable.TblType=="CUSTOMVIEW"){limitPart=SqlPart(srcTable.TblCustomSQL,"LIMIT").trim();groupByPart=SqlPart(srcTable.TblCustomSQL,"GROUP BY").trim();havingPart=SqlPart(srcTable.TblCustomSQL,"HAVING").trim();if(!IsEmpty(limitPart)||!IsEmpty(groupByPart)&&!IsEmpty(havingPart)){selectPart="*";fromPart="("+srcTable.TblCustomSQL+") "+QuotedName("CV_"+table.TblVar,dbId);wherePart=""}else{fromPart=SqlPart(srcTable.TblCustomSQL,"FROM");wherePart=SqlPart(srcTable.TblCustomSQL,"WHERE")}}else{fromPart=SqlTableName(srcTable,dbId);let selectCustom=srcTable.Fields.filter((f=>f.FldGenerate&&f.FldIsCustom)).map((f=>(f.FldSQL==""?"\'\'":Quote(f.FldSQL))+" AS "+QuotedName(f.FldName,dbId))).join(", ");if(selectCustom!="")fromPart="(SELECT *, "+selectCustom+" FROM "+fromPart+") "+QuotedName("CV_"+table.TblVar,dbId);wherePart=""}let columnFields=table.Fields.filter((f=>f.FldColumnID>0)).slice();if(columnFields.length==0)throw new Error("No column field defined");let columnField=columnFields[0],columnDateType=GetFieldType(columnField.FldType)==2?columnField.FldColumnDateType:"",columnDateSelect=columnField.FldColumnDateSelect&&["q","m"].includes(columnDateType);let sqlColFld=FieldSqlName(columnField,dbId);let sqlColYearFld="";let sqlColYearAlias="";if(["q","m"].includes(columnDateType)){sqlColYearFld=DbGroupSql("y",0,dbId);sqlColYearFld=sqlColYearFld.replace(/%s/g,sqlColFld);sqlColYearAlias="YEAR__"+columnField.FldParm}if(!IsEmpty(sqlColYearFld)){selectPart=sqlColYearFld;if(!IsEmpty(sqlColYearAlias))selectPart+=" AS "+QuotedName(sqlColYearAlias,dbId);orderByPart=sqlColYearFld;let sql="SELECT DISTINCT "+selectPart+" FROM "+fromPart;if(!IsEmpty(wherePart))sql+=" WHERE "+wherePart;sql+=" ORDER BY "+orderByPart;return sql}else{return""}let __args={arguments:arguments[0],code:__output};Events.emit("CrosstabYearSql",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',DistinctColumnField:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{};let reportName=TABLE.TblName,tableName=TABLE.TblRptSrc,srcTable=GetTableObject(tableName),dbId=GetDbId(reportName),dbType=DbType(dbId),columnFldDateType=GetFieldType(columnField.FldType)==2?columnField.FldColumnDateType:"",fldName=FieldSqlName(columnField,dbId),columnFld="";if(columnFldDateType=="y"){columnFld=DbGroupSql("y",0,dbId);columnFld=columnFld.replace(/%s/g,fldName)}else if(["q","m"].includes(columnFldDateType)){columnFld=""}else if(columnFldDateType=="d"){if(dbType=="ACCESS"){columnFld="FORMAT(%s, \'yyyy-mm-dd\')";columnFld=columnFld.replace(/%s/g,fldName)}else if(dbType=="MSSQL"){columnFld="CONVERT(VARCHAR(10),%s,120)";columnFld=columnFld.replace(/%s/g,fldName)}else if(dbType=="MYSQL"){columnFld="DATE_FORMAT(%s,\'%Y-%m-%d\')";columnFld=columnFld.replace(/%s/g,fldName)}else if(dbType=="SQLITE"){columnFld="STRFTIME(\'%Y-%m-%d\',%s)";columnFld=columnFld.replace(/%s/g,fldName)}else{columnFld="(TO_CHAR(%s,\'YYYY\') || \'-\' || LPAD(TO_CHAR(%s,\'MM\'),2,\'0\') || \'-\' || LPAD(TO_CHAR(%s,\'DD\'),2,\'0\'))";columnFld=columnFld.replace(/%s/g,fldName)}}else if(columnFldDateType=="dt"){if(dbType=="ACCESS"){columnFld="FORMAT(%s, \'yyyy-mm-dd hh:nn:ss\')";columnFld=columnFld.replace(/%s/g,fldName)}else if(dbType=="MSSQL"){columnFld="CONVERT(VARCHAR,%s,120)";columnFld=columnFld.replace(/%s/g,fldName)}else if(dbType=="MYSQL"){columnFld="DATE_FORMAT("+fldName+",\'%Y-%m-%d %H:%i:%s\')"}else if(dbType=="SQLITE"){columnFld="STRFTIME(\'%Y-%m-%d %H:%M:%S\',%s)";columnFld=columnFld.replace(/%s/g,fldName)}else{columnFld="(TO_CHAR(%s,\'YYYY\') || \'-\' || LPAD(TO_CHAR(%s,\'MM\'),2,\'0\') || \'-\' || LPAD(TO_CHAR(%s,\'DD\'),2,\'0\') || \' \' || LPAD(TO_CHAR(%s,\'HH24\'),2,\'0\') || \':\' || LPAD(TO_CHAR(%s,\'MI\'),2,\'0\') || \':\' || LPAD(TO_CHAR(%s,\'SS\'),2,\'0\'))";columnFld=columnFld.replace(/%s/g,fldName)}}else{columnFld=fldName}return columnFld;let __args={arguments:arguments[0],code:__output};Events.emit("DistinctColumnField",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FavIcon:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{};let icon=PROJ.FavIcon;if(!IsEmpty(icon)&&FileExists(icon)){let path=GetPath(),file=path.basename(icon),ext=path.extname(icon),type="image/png";switch(ext.toLowerCase()){case".ico":type="image/x-icon";break;case".gif":type="image/gif";break}__append(\'\\n<link rel="shortcut icon" type="\');__append(type);__append(\'" href="<?= BasePath() ?>/\');__append(file);__append(\'">\\n<link rel="icon" type="\');__append(type);__append(\'" href="<?= BasePath() ?>/\');__append(file);__append(\'">\\n\')}let __args={arguments:arguments[0],code:__output};Events.emit("FavIcon",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldAdd:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld,parm:parm}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,ctlid="add",confirmPassword=ctrlId=="register"&&field.FldName==PROJ.SecPasswdFld&&parm=="confirm",fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control);if(["list","grid"].includes(ctrlId))fldVar=RowVar(fldVar);let ctl=confirmPassword?"c_"+fldParm:fldVar,cv=Code.getName(fldObj,Code.Field.CurrentValue),ev=Code.getName(fldObj,Code.Field.EditValue),ov=Code.getName(fldObj,Code.Field.OldValue),vv=Code.getName(fldObj,Code.Field.ViewValue),fv=Code.getName(fldObj,Code.Field.FormValue),octl=AddSquareBrackets("o"+ctl.substr(1),field),isConfirm=Code.getName(PageObject,Code.IsConfirm);FieldSpanTagStart="",FieldSpanTagEnd="";let spanId="",classId="";if(["add","register","list","grid"].includes(ctrlId)){if(["list","grid"].includes(ctrlId)){let rowCnt=Code.getName(PageObject,Code.RowCount);if(GenerateTemplateLine)spanId=`el$rowindex$_${tblVar}_${fldParm}`;else spanId=`el${Code.write(rowCnt)}_${tblVar}_${fldParm}`;let recPerRow=table.TblUseGlobal?PROJ.RecPerRow:table.TblRecPerRow;if(recPerRow<1)classId=`form-group ${tblVar}_${fldParm}`}else if(confirmPassword){spanId=`el_c_${tblVar}_${fldParm}`}else{spanId=`el_${tblVar}_${fldParm}`}FieldSpanTagStart=`<span id="${spanId}"`;if(classId!="")FieldSpanTagStart+=` class="${classId}"`;FieldSpanTagStart+=">";FieldSpanTagEnd="</span>"}if(UseCustomTemplate){let scriptType="value",confirmPassword=ctrlId=="register"&&ctl.startsWith("c"),templateId=confirmPassword?`${tblVar}_c_${fldParm}`:`${tblVar}_${fldParm}`,scriptIndex=ctrlId=="list"?CustomScriptRowCnt():"",scriptId=CustomScriptId(templateId,scriptType,scriptIndex);FieldSpanTagStart=`<template id="${scriptId}">`+FieldSpanTagStart;FieldSpanTagEnd+="</template>"}_arguments=Object.assign(_arguments,{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid});let argsv=Object.assign({},_arguments,{vv:vv,isedit:true});if(ctrlId=="add"&&table.TblAddConfirm||ctrlId=="register"&&PROJ.SecRegisterConfirm||ctrlId=="grid"){if(field.FldHtmlTag=="FILE"){__append("\\n");__append(FieldEditCall(_arguments));__append("\\n")}else{__append("\\n<?php if (!");__append(isConfirm);__append(") { ?>\\n");__append(FieldEditCall(_arguments));__append("\\n<?php } else { ?>\\n");if(field.FldHtmlTag!="HIDDEN"){__append("\\n");__append(FieldViewCall(argsv));__append("\\n")}__append("\\n");_arguments=Object.assign(_arguments,{cv:fv,ev:vv});__append("\\n");__append(FieldEditHidden(_arguments));__append("\\n<?php } ?>\\n")}}else{__append("\\n");__append(FieldEditCall(_arguments));__append("\\n")}__append("\\n");if(["list","grid"].includes(ctrlId)){__append("\\n");_arguments=Object.assign(_arguments,{ctl:octl,cv:ov,ev:ev});__append("\\n");__append(FieldEditHidden(_arguments));__append("\\n")}__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("FieldAdd",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldAggregate:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let table=tbl||TABLE,field=fld||FIELD,control=ctrl||CONTROL,tblVar=table.TblVar,fldObj=Code.fldObj(field,table,control),fldParm=field.FldParm,cv=Code.getName(fldObj,Code.Field.CurrentValue),vv=Code.getName(fldObj,Code.Field.ViewValue),att=Code.getName(fldObj,Code.Field.ViewAttributes),tooltipFld=field.FldTooltipFld,hrefFld=field.FldHrefFld;_arguments=Object.assign(_arguments,{cv:cv,vv:vv,isedit:false});let text=FieldViewText(_arguments);text=text.replace(/<div/gi,"<span").replace(/<\\/div>/gi,"</span>");let phrase=Code.raw(Code.languagePhrase(field.FldAggregate));text=`<span class="ew-aggregate">${phrase}</span><span class="ew-aggregate-value">${text}</span>`;if(UseCustomTemplate){let templateId=tblVar+"_"+fldParm;text=`<span${Code.write(att)}><span class="ew-aggregate-value">${text}</span></span>`;text=CustomScriptTag(templateId,"aggregate",ScriptTemplateClass)+text+"</template>"}__append("\\n");__append(text);let __args={arguments:arguments[0],code:__output};Events.emit("FieldAggregate",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldCaption:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld,parm:parm}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldObj=Code.fldObj(field,table,control),fldParm=FIELD.FldParm,fldCaption=Code.raw(Code.getName(fldObj,Code.Field.Caption)),confirmPassword=ctrlId=="register"&&field.FldName==PROJ.SecPasswdFld&&parm=="confirm";if(confirmPassword)fldCaption=Code.raw(Code.languagePhrase("Confirm"))+" "+fldCaption;if(["add","addopt","edit","register"].includes(ctrlId))fldCaption+=Code.raw(Code.getName(fldObj,Code.Field.Required)+" ? "+Code.languagePhrase("FieldRequiredIndicator")+" : "+\'""\');if(UseCustomTemplate){let templateId=confirmPassword?tblVar+"_c_"+fldParm:tblVar+"_"+fldParm;let scriptId=CustomScriptId(templateId,"header");fldCaption=`<template id="${scriptId}">${fldCaption}</template>`}write(fldCaption);let __args={arguments:arguments[0],code:__output};Events.emit("FieldCaption",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEdit:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,ctlid="edit",fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control);if(["grid"].includes(ctrlId))fldVar=RowVar(fldVar);let ctl=fldVar,cv=Code.getName(fldObj,Code.Field.CurrentValue),ev=Code.getName(fldObj,Code.Field.EditValue),vv=Code.getName(fldObj,Code.Field.ViewValue),fv=Code.getName(fldObj,Code.Field.FormValue),ctlDbValue=Code.getName(fldObj,Code.Field.Upload.DbValue),ov=Code.getName(fldObj,Code.Field.OldValue),isConfirm=Code.getName(PageObject,Code.IsConfirm);FieldSpanTagStart="",FieldSpanTagEnd="";let spanId="",classId="";if(["edit","update"].includes(ctrlId)){spanId=`el_${tblVar}_${fldParm}`;FieldSpanTagStart=`<span id="${spanId}">`;FieldSpanTagEnd="</span>"}else if(ctrlId=="grid"){let rowCnt=Code.getName(PageObject,Code.RowCount);spanId=`el${Code.write(rowCnt)}_${tblVar}_${fldParm}`;classId=`form-group ${tblVar}_${fldParm}`;FieldSpanTagStart=`<span id="${spanId}" class="${classId}">`;FieldSpanTagEnd="</span>"}if(UseCustomTemplate){let scriptType="value",templateId=`${tblVar}_${fldParm}`,scriptId=CustomScriptId(templateId,scriptType);FieldSpanTagStart=`<template id="${scriptId}">`+FieldSpanTagStart;FieldSpanTagEnd+="</template>"}_arguments=Object.assign(_arguments,{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid});let argsv=Object.assign({},_arguments,{vv:vv,isedit:true});if(ctrlId=="edit"&&table.TblEditConfirm||ctrlId=="update"&&table.TblMultiUpdateConfirm||ctrlId=="grid"){if(field.FldHtmlTag=="FILE"){__append("\\n");__append(FieldEditCall(_arguments));__append("\\n")}else{__append("\\n<?php if (!");__append(isConfirm);__append(") { ?>\\n");__append(FieldEditCall(_arguments));__append("\\n<?php } else { ?>\\n");if(field.FldHtmlTag!="HIDDEN"){__append("\\n");__append(FieldViewCall(argsv));__append("\\n")}__append("\\n");_arguments=Object.assign(_arguments,{cv:fv,ev:vv});__append("\\n");__append(FieldEditHidden(_arguments));__append("\\n");if(field.FldIsPrimaryKey&&!field.FldAutoIncrement){let octl=AddSquareBrackets("o"+ctl.substr(1),field),ov=Code.getName(fldObj,Code.Field.OldValue),keyCv=`${ov} ?? ${cv}`;__append("\\n");__append(FieldEditHidden(Object.assign({},_arguments,{ctl:octl,cv:keyCv})));__append("\\n")}__append("\\n<?php } ?>\\n")}}else{__append("\\n");__append(FieldEditCall(_arguments));__append("\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("FieldEdit",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditAjaxSelectAddOption:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld,useInputGroupAppend:useInputGroupAppend}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control);let isLinkTable=FieldIsLinkTable(table,field,ctlid),isSelectList=isLinkTable&&["TEXT","SELECT","RADIO","CHECKBOX"].includes(field.FldHtmlTag),isGrid=["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid),isAddOption=isSelectList&&field.FldSelectAllowAdd&&(["add","addopt","edit"].includes(ctrlId)||isGrid);if(isAddOption&&ctrlId=="addopt"&&table.TblName==field.FldTagLnkTbl)isAddOption=false;if(isGrid){fldVar=RowVar(fldVar)}else if(ctrlId=="list"&&ctlid=="extbs"||ctrlId=="search"){fldVar=ctl.replace(/\\[\\]$/,"")}if(isAddOption){let fldTagLnkTbl=field.FldTagLnkTbl,tbl=GetTableObject(fldTagLnkTbl),addOptFileName=GetRouteUrl("addopt",tbl),userTable=HasUserTable(),staticUserLevel=userTable&&!DB.UseDynamicUserLevel&&!IsEmpty(DB.SecUserLevelFld)&&!IsEmpty(table.TblSecurity),dynamicUserLevel=userTable&&DB.UseDynamicUserLevel&&!IsEmpty(DB.UserLevelTbl)&&!IsEmpty(DB.SecUserLevelFld),userLevel=staticUserLevel||dynamicUserLevel;let caption=Code.getName(fldObj,Code.Field.Caption),el=AddSquareBrackets(fldVar,field),title=Code.concat(Code.htmlTitle(Code.languagePhrase("AddLink")),\'"&nbsp;"\',caption),html=`<button type="button" class="btn btn-default ew-add-opt-btn" id="aol_${fldVar}" title="${Code.raw(title)}" data-title="${Code.raw(caption)}" onclick="ew.addOptionDialogShow({lnk:this,el:\'${el}\',url:\'<?= GetUrl("${addOptFileName}") ?>\'});"><i class="fas fa-plus ew-icon"></i></button>`,readOnly=Code.getName(fldObj,Code.Field.ReadOnly);if(useInputGroupAppend)html=`<div class="input-group-append">${html}</div>`;if(userLevel){__append(\'\\n<?php if (AllowAdd(CurrentProjectID() . "\');__append(Code.quote(fldTagLnkTbl));__append(\'") && !\');__append(readOnly);__append(") { ?>\\n");__append(html);__append("\\n<?php } ?>\\n")}else{__append("\\n");__append(html);__append("\\n")}}let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditAjaxSelectAddOption",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditAjaxSelectParamTag:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control);let isLinkTable=FieldIsLinkTable(table,field,ctlid),isSelectList=isLinkTable&&["TEXT","SELECT","RADIO","CHECKBOX"].includes(field.FldHtmlTag),isGrid=["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid);if(isGrid){fldVar=RowVarQuoted(fldVar).replace(Code.this,PageObject)}else if(ctrlId=="list"&&ctlid=="extbs"||ctrlId=="search"){fldVar=ctl.replace(/\\[\\]$/,"")}if(isSelectList){__append("\\n");__append(Code.raw(Code.getName(fldObj,Code.Field.Lookup,`getParamTag(${Code.getName(PageObject)}, "p_${fldVar}")`)));__append("\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditAjaxSelectParamTag",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditCall:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldHtmlTag=field.FldHtmlTag,oldFldHtmlTag=fldHtmlTag;if(["summary","crosstab"].includes(table.TblReportType)&&IsDateFilter(field)){ctlid="search";fldHtmlTag="SELECT"}if(["search","extbs"].includes(ctlid)&&(IsVirtualLookupField(field)&&field.FldVirtualLookupSearch||fldHtmlTag=="FILE"&&!IsBinaryField(field)||fldHtmlTag=="TEXTAREA"&&PROJ.ReplaceTextAreaByText||fldHtmlTag=="PASSWORD"))fldHtmlTag="TEXT";if(fldHtmlTag!="TEXT"&&field.FldModalLookup){if(FieldIsLinkTable(table,field,ctlid))fldHtmlTag="LOOKUP"}else if(field.FldDropdown){if(fldHtmlTag=="SELECT")fldHtmlTag=field.FldSelectMultiple?"CHECKBOX":"RADIO"}let tblName=table.TblName,fldName=field.FldName,fldParm=field.FldParm,fldObj=Code.fldObj(field,table,control),userTable=HasUserTable(),userID=userTable&&!IsEmpty(DB.SecuUserIDFld),tableHasUserIDFld=userID&&!IsEmpty(table.TblUserIDFld),parentUserID=tableHasUserIDFld&&!IsEmpty(DB.SecuParentUserIDFld),out="";JavaScriptString="";if(!IsEmpty(field.FldAutoUpdateValue)){if(ctrlId=="addopt")fldHtmlTag="HIDDEN";else if(!["extbs","search"].includes(ctlid))return""}if(field.FldAutoIncrement&&ctlid=="add"){return FieldSpanTagStart+FieldSpanTagEnd}switch(fldHtmlTag){case"NO":case"TEXT":out=FieldEditText(_arguments);break;case"PASSWORD":out=FieldEditPassword(_arguments);break;case"RADIO":out=FieldEditRadio(_arguments);break;case"CHECKBOX":out=FieldEditCheckbox(_arguments);break;case"SELECT":out=FieldEditSelect(_arguments);break;case"TEXTAREA":out=FieldEditTextarea(_arguments);break;case"HIDDEN":if(ctrlId=="addopt"||IsHiddenField(table,field,ctlid)){out=FieldEditHidden(_arguments)}else{out=FieldEditText(_arguments)}break;case"FILE":out=FieldEditFile(_arguments);break;case"LOOKUP":out=FieldEditLookup(_arguments);break}FieldOriginalTemplate="";let customEditTemplate=GetCustomEditTemplate(table,field,out,ctlid),useCustomEditTemplate=!IsEmpty(customEditTemplate)&&customEditTemplate.trim()!="";if(useCustomEditTemplate){if(UseCustomTemplate&&ctlid!="extbs"||UseCustomTemplateSearch&&ctlid=="extbs"){let name=`${tblVar}_${fldParm}`,idx=ctrlId=="list"&&ctlid!="extbs"?CustomScriptRowCnt():null,tagid=CustomScriptId(name,"value",idx);FieldOriginalTemplate+=CustomScriptTag(name,"value",ScriptTemplateClass,idx)+"\\n"+customEditTemplate+"\\n"+"</template>";out=`<slot name="${Quote(tagid)}"></slot>`}else{out=customEditTemplate}}let argsv=Object.assign({},_arguments,{vv:ev,isedit:true}),sv=Code.getName(fldObj,Code.Field.SessionValue);if((field.FldHtmlTagReadOnly||field.FldIsPrimaryKey)&&ctlid=="edit"&&field.FldHtmlTag!="HIDDEN"&&!(field.FldHtmlTag=="TEXTAREA"&&field.FldUseDHTMLEditor)){if(field.FldHtmlTagReadOnly||field.FldIsPrimaryKey&&field.FldAutoIncrement){out=FieldViewCall(argsv)+FieldEditHidden(_arguments)}else{if(IsDetailKeyField(table,field)){let argsv2=Object.assign({},_arguments,{vv:ev,isedit:true});out=`<?php if (${sv} != "") { ?>\\n${FieldViewCall(argsv2)}\\n<input type="hidden" id="${ctl}" name="${ctl}" value="${Code.write(Code.htmlEncode(cv))}" data-hidden="1">\\n<?php } else { ?>\\n${out}\\n<?php } ?>\\n`}let octl=AddSquareBrackets("o"+ctl.substr(1),field),ov=Code.getName(fldObj,Code.Field.OldValue),keyCv=`${ov} ?? ${cv}`;if(field.FldIsPrimaryKey&&!field.FldAutoIncrement)out+=FieldEditHidden(Object.assign({},_arguments,{ctl:octl,cv:keyCv}))}__append("\\n");__append(out);__append("\\n")}else{let firstCond=true,condStr;if(IsDetailKeyField(table,field)&&!["search","extbs"].includes(ctlid)&&ctrlId!="addopt"){condStr=firstCond?"if":"} elseif";firstCond=false;__append("\\n<?php ");__append(condStr);__append(" (");__append(sv);__append(\' != "") { ?>\\n\');if(field.FldHtmlTag!="HIDDEN"){let vv=Code.getName(fldObj,Code.Field.ViewValue),argsv2=Object.assign({},_arguments,{vv:vv,isedit:true});__append("\\n");__append(FieldViewCall(argsv2));__append("\\n")}if(GetFieldType(field.FldType)==2){cv="FormatDateTime("+cv+", "+field.FldDtFormat+")"}__append(\'\\n<input type="hidden" id="\');__append(ctl);__append(\'" name="\');__append(ctl);__append(\'" value="\');__append(Code.write(Code.htmlEncode(cv)));__append(\'" data-hidden="1">\\n\')}if(parentUserID&&table.TblName==PROJ.SecTbl&&field.FldName==DB.SecuParentUserIDFld&&ctrlId!="register"){condStr=firstCond?"if":"} elseif";firstCond=false;let userIdField=GetFieldObject(table,table.TblUserIDFld),userId=Code.getName(PageObject,userIdField?.FldParm,Code.Field.CurrentValue);__append("\\n<?php ");__append(condStr);__append(" (!$Security->isAdmin() && $Security->isLoggedIn()) { // Non system admin ?>\\n");if(field.FldHtmlTag!="HIDDEN"){__append("\\n    ");if(["extbs","search"].includes(ctlid)){__append("\\n<?php if (strval(");__append(cv);__append(\') == "") \');__append(cv);__append(" = CurrentUserID() ?>\\n    ")}__append("\\n    ");if(ctlid=="edit"){__append("\\n<?php if (SameString(");__append(userId);__append(", CurrentUserID())) { ?>\\n    ");__append(String(FieldViewCall(argsv)).replace(/\\n/g,"\\n    "));__append("\\n    ");__append(String(FieldEditHidden(_arguments)).replace(/\\n/g,"\\n    "));__append("\\n<?php } else { ?>\\n    ")}__append("\\n");__append(FieldSpanTagStart);__append("\\n");let userIdWrk="",isVirtualFld=IsVirtualLookupField(field),isVirtualSearch=["extbs","search"].includes(ctlid)&&isVirtualFld,isForceSelect=field.FldSelectForceSelection&&!isVirtualSearch;if(fldHtmlTag=="LOOKUP"){userIdWrk=FieldEditLookup(_arguments)}else if(fldHtmlTag=="RADIO"){userIdWrk=FieldEditRadio(_arguments)}else if(fldHtmlTag=="TEXT"&&isForceSelect){userIdWrk=FieldEditText(_arguments)}else{field.FldHtmlTag="SELECT";userIdWrk=FieldEditSelect(_arguments)}field.FldHtmlTag=oldFldHtmlTag;let javaScript="";__append("\\n");__append(userIdWrk);__append("\\n");__append(FieldSpanTagEnd);__append("\\n");__append(javaScript);__append("\\n    ");if(ctlid=="edit"){__append("\\n<?php } ?>\\n    ")}__append("\\n")}else{__append("\\n");__append(FieldEditHidden(_arguments));__append("\\n")}__append("\\n")}if(tableHasUserIDFld&&field.FldName==table.TblUserIDFld&&field.FldHtmlTag!="HIDDEN"&&ctrlId!="register"){condStr=firstCond?"if":"} elseif";firstCond=false;let userIdAllowId="";if(ctrlId=="list")userIdAllowId=Code.getName(PageObject,Code.CurrentAction);else userIdAllowId=`"${ctrlId}"`;__append("\\n<?php ");__append(condStr);__append(" (!$Security->isAdmin() && $Security->isLoggedIn() && !$");__append(pageObj);__append("->userIDAllow(");__append(userIdAllowId);__append(")) { // Non system admin ?>\\n");if(parentUserID){__append("\\n");__append(FieldSpanTagStart);__append("\\n");let userIdWrk="",isVirtualFld=IsVirtualLookupField(field),isVirtualSearch=["extbs","search"].includes(ctlid)&&isVirtualFld,isForceSelect=field.FldSelectForceSelection&&!isVirtualSearch;if(fldHtmlTag=="LOOKUP"){userIdWrk=FieldEditLookup(_arguments)}else if(fldHtmlTag=="RADIO"){userIdWrk=FieldEditRadio(_arguments)}else if(fldHtmlTag=="TEXT"&&isForceSelect){userIdWrk=FieldEditText(_arguments)}else{field.FldHtmlTag="SELECT";userIdWrk=FieldEditSelect(_arguments)}field.FldHtmlTag=oldFldHtmlTag;let javaScript="";__append("\\n");__append(userIdWrk);__append("\\n");__append(FieldSpanTagEnd);__append("\\n");__append(javaScript);__append("\\n")}else{__append("\\n    ");if(fldHtmlTag!="HIDDEN"){__append("\\n");__append(FieldViewCall(argsv));__append("\\n    ")}__append("\\n");__append(FieldEditHidden(_arguments));__append("\\n")}__append("\\n")}if(userTable&&PROJ.SecTbl==table.TblName&&DB.SecUserLevelFld==field.FldName){condStr=firstCond?"if":"} elseif";firstCond=false;__append("\\n<?php ");__append(condStr);__append(" (!$Security->isAdmin() && $Security->isLoggedIn()) { // Non system admin ?>\\n");__append(FieldSpanTagStart);__append("\\n");__append(FieldViewText(argsv));__append("\\n");__append(FieldSpanTagEnd);__append("\\n")}if(firstCond){__append("\\n");__append(FieldOriginalTemplate);__append("\\n");__append(FieldSpanTagStart);__append("\\n");__append(out);__append("\\n");__append(FieldSpanTagEnd);__append("\\n")}else{__append("\\n<?php } else { ?>\\n");__append(FieldOriginalTemplate);__append("\\n");__append(FieldSpanTagStart);__append("\\n");__append(out);__append("\\n");__append(FieldSpanTagEnd);__append("\\n<?php } ?>\\n")}}if(JavaScriptString.trim()!=""&&!["extbs","search"].includes(ctlid)){__append("\\n");__append(JavaScriptString);__append("\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditCall",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditCheckbox:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,out="",ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),sepAtt=Code.getName(fldObj,Code.Field.DisplayValueSeparatorAttribute),errorMsg=FieldEditErrorMessage(_arguments),customMsg=FieldEditCustomMessage(_arguments),describedBy=!IsEmpty(customMsg)?` aria-describedby="${fldVar}_help"`:"";let isLinkTable=FieldIsLinkTable(table,field,ctlid),isSelectList=isLinkTable&&["TEXT","SELECT","RADIO","CHECKBOX"].includes(field.FldHtmlTag),isGrid=["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid),isAddOption=isSelectList&&field.FldSelectAllowAdd&&(["add","addopt","edit"].includes(ctrlId)||isGrid);let att=Code.getName(fldObj,Code.Field.EditAttributes),pageAttr=MultiPageFieldAttribute(table,field),pageValue=MultiPageFieldAttributeValue(table,field);if(IsBooleanField(table,field)){let rand=RandomIntInclusive(1e5,999999);let chkClass=PROJ.UseBootstrapSwitch?"custom-switch":"custom-checkbox";__append(\'\\n<div class="custom-control \');__append(chkClass);__append(\' d-inline-block">\\n    <input type="checkbox" class="custom-control-input\');__append(Code.write(Code.getName(fldObj,Code.Field.IsInvalidClass)));__append(\'" data-table="\');__append(tblVar);__append(\'" data-field="\');__append(fldVar);__append(\'"\');__append(pageAttr);__append(\' name="\');__append(ctl);__append(\'[]" id="\');__append(ctl);__append("_");__append(rand);__append(\'" value="1"\');__append(Code.write(`ConvertToBool(${cv}) ? " checked" : ""`));__append(Code.write(att));__append(describedBy);__append(\'>\\n    <label class="custom-control-label" for="\');__append(ctl);__append("_");__append(rand);__append(\'"></label>\\n</div>\\n\');__append(customMsg);__append("\\n");__append(errorMsg);__append("\\n")}else{let fldHtmlTag=field.FldHtmlTag;if(field.FldDropdown&&fldHtmlTag=="SELECT")fldHtmlTag=field.FldSelectMultiple?"CHECKBOX":"RADIO";let selectTypeTable=fldHtmlTag=="CHECKBOX"&&field.FldSelectType=="Table"&&!IsEmpty(field.FldTagLnkTbl)&&!IsEmpty(field.FldTagLnkFld)&&!IsEmpty(field.FldTagLnkDisplay);let repeatColumns=field.FldRepeatColumns||0;if(repeatColumns<0)repeatColumns=0;let onChange="",childFlds=table.ChildFields,childTable,childField;for(let childFld of childFlds){if(childFld.FldName==field.FldName){childTable=childFld.Table?GetTableObject(childFld.Table):table;childField=GetFieldObject(childTable,childFld.ChildField);if(childField!=null&&FieldIsFirstCombo(table,field,childTable,childField,ctlid)){let secondComboFldVar=childField.FldVar,firstComboFldVar=field.FldVar;if(["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid)){secondComboFldVar=RowVarQuoted(secondComboFldVar)}let secondComboFldVar2=AddSquareBrackets(secondComboFldVar,childField);if(ctl.startsWith("x")){if(onChange!="")onChange+=",";onChange+=`\'${secondComboFldVar2}\'`}}}}let editAttrs=Code.getName(fldObj,Code.Field.EditAttrs);if(onChange!="")onChange="ew.updateOptions.call(this);";let readOnly=Code.getName(fldObj,Code.Field.ReadOnly);if(field.FldDropdown){let fldDropdownWidth=field.FldDropdownWidth;if(!IsNumber(fldDropdownWidth))fldDropdownWidth=0;let fldDropdownHeight=field.FldDropdownHeight;if(!IsNumber(fldDropdownHeight))fldDropdownHeight=0;let style="overflow-x: hidden;";if(fldDropdownWidth>0)style+=` min-width: ${fldDropdownWidth}px;`;if(fldDropdownHeight>0)style+=` max-height: ${fldDropdownHeight}px; overflow-y: auto;`;let vv=Code.getName(fldObj,Code.Field.ViewValue);if(["search","extbs"].includes(ctlid)){if(ctl.startsWith("x"))vv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.ViewValue);else vv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.ViewValue2)}__append("\\n");__append(FieldEditSelect({..._arguments,repeatColumns:repeatColumns,fldHtmlTag:fldHtmlTag,dropdown:true,dropdownWidth:fldDropdownWidth}));__append("\\n")}else{__append(\'\\n<template id="tp_\');__append(ctl);__append(\'">\\n    <div class="custom-control custom-checkbox">\\n        <input type="checkbox" class="custom-control-input" data-table="\');__append(tblVar);__append(\'" data-field="\');__append(fldVar);__append(\'" name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'"\');__append(Code.write(att));__append(\'>\\n        <label class="custom-control-label"></label>\\n    </div>\\n</template>\\n<div id="dsl_\');__append(ctl);__append(\'" class="ew-item-list"></div>\\n\');if(!IsEmpty(onChange)){__append("\\n<?php ");__append(editAttrs);__append(\'->prepend("onchange", "\');__append(onChange);__append(\'"); ?>\\n\')}__append(\'\\n<input type="hidden"\\n    is="selection-list"\\n    id="\');__append(ctl);__append(\'[]"\\n    name="\');__append(ctl);__append(\'[]"\\n    value="\');__append(Code.write(Code.htmlEncode(cv)));__append(\'"\\n    data-type="select-multiple"\\n    data-template="tp_\');__append(ctl);__append(\'"\\n    data-target="dsl_\');__append(ctl);__append(\'"\\n    data-repeatcolumn="\');__append(repeatColumns);__append(\'"\\n    class="form-control\');__append(Code.write(Code.getName(fldObj,Code.Field.IsInvalidClass)));__append(\'"\\n    data-table="\');__append(tblVar);__append(\'"\\n    data-field="\');__append(fldVar);__append(\'"\\n    \');__append(String(pageAttr.trim()).replace(/\\n/g,"\\n    "));__append(\'\\n    data-value-separator="\');__append(Code.write(sepAtt));__append(\'"\\n    \');__append(String(Code.write(att)).replace(/\\n/g,"\\n    "));__append(">\\n");__append(customMsg);__append("\\n");__append(errorMsg);__append("\\n");if(isAddOption){__append("\\n");__append(FieldEditAjaxSelectAddOption(Object.assign({},_arguments,{useInputGroupAppend:false})));__append("\\n")}__append("\\n");if(isSelectList){__append("\\n");__append(FieldEditAjaxSelectParamTag(_arguments));__append("\\n")}__append("\\n")}}let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditCheckbox",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditCustomMessage:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control);if(!["add","edit","update","register"].includes(ctrlId)){return""}__append("\\n");__append(Code.raw(Code.getName(fldObj,Code.Field.CustomMsg)));__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditCustomMessage",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditDetailKey:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld}=_arguments;let field=fld||FIELD,fldVar=field.FldVar,fldObj=Code.fldObj(field),ctl=fldVar,sv=Code.getName(fldObj,Code.Field.SessionValue);__append("\\n<?php if (");__append(Code.toString(sv));__append(\' != "") { ?>\\n<input type="hidden" name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'" value="\');__append(Code.write(Code.htmlEncode(Code.toString(sv))));__append(\'">\\n<?php } ?>\');let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditDetailKey",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditErrorMessage:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{msg:msg,ctrl:ctrl,ctlid:ctlid,tbl:tbl,fld:fld}=_arguments;if(!msg){let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control);msg=ctrlId=="list"&&ctlid=="extbs"||ctrlId=="search"?Code.getName(fldObj,Code.Field.SearchErrorMessage):Code.getName(fldObj,Code.Field.ErrorMessage)}__append(\'\\n<div class="invalid-feedback">\');__append(Code.raw(msg));__append("</div>\\n");let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditErrorMessage",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditFile:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),fldSize=field.FldSize,fldParm=field.FldParm,att=Code.getName(fldObj,Code.Field.EditAttributes),pageAttr=MultiPageFieldAttribute(table,field),ctlDbValue=Code.getName(fldObj,Code.Field.Upload.DbValue),ctlFileName=Code.getName(fldObj,Code.Field.Upload.FileName),fldUploadMultiple,multiple,label,errorMsg=FieldEditErrorMessage(_arguments),customMsg=FieldEditCustomMessage(_arguments),describedBy=!IsEmpty(customMsg)?` aria-describedby="${fldVar}_help"`:"";if(field.FldUploadMultiple&&!IsBinaryField(field)){fldUploadMultiple="1";multiple=" multiple";label="ChooseFiles"}else{fldUploadMultiple="0";multiple="";label="ChooseFile"}let wrkSize;if(field.FldTagSize>0){wrkSize=` size="${field.FldTagSize}"`}else{wrkSize=""}let fldCtl,fldCtl2;if(["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid)){fldCtl=RowVar(fldVar);fldCtl2=RowVarQuoted(fldVar)}else{fldCtl=ctl;fldCtl2=ctl}let name=fldCtl.substr(1),name2=fldCtl2.substr(1),fldVarAction="a"+name,fldVarAction2="a"+name2,fldVarWidth="wd"+name,fldVarHeight="ht"+name;let readOnly=Code.getName(fldObj,Code.Field.ReadOnly),disabled=Code.getName(fldObj,Code.Field.Disabled),input=`<input type="file" class="custom-file-input" title="${Code.write(Code.getName(fldObj,Code.Field.Title))}" data-table="${tblVar}" data-field="${fldVar}"${pageAttr} name="${fldCtl}" id="${fldCtl}" lang="${Code.write("CurrentLanguageID()")}"${multiple}${Code.raw(att)}<?= (${readOnly} || ${disabled}) ? " disabled" : "" ?>${describedBy}>`;__append(\'\\n<div id="fd_\');__append(fldCtl);__append(\'">\\n<div class="input-group">\\n    <div class="custom-file">\\n        \');__append(String(input).replace(/\\n/g,"\\n        "));__append(\'\\n        <label class="custom-file-label ew-file-label" for="\');__append(fldCtl);__append(\'">\');__append(Code.raw(Code.languagePhrase(label)));__append("</label>\\n    </div>\\n</div>\\n");__append(customMsg);__append("\\n");__append(errorMsg);__append(\'\\n<input type="hidden" name="fn_\');__append(fldCtl);__append(\'" id= "fn_\');__append(fldCtl);__append(\'" value="\');__append(Code.write(ctlFileName));__append(\'">\\n\');if(ctlid=="edit"){__append(\'\\n<input type="hidden" name="fa_\');__append(fldCtl);__append(\'" id= "fa_\');__append(fldCtl);__append(\'" value="<?= (Post("fa_\');__append(fldCtl);__append(\'") == "0") ? "0" : "1" ?>">\\n\')}else{__append(\'\\n<input type="hidden" name="fa_\');__append(fldCtl);__append(\'" id= "fa_\');__append(fldCtl);__append(\'" value="0">\\n\')}__append(\'\\n<input type="hidden" name="fs_\');__append(fldCtl);__append(\'" id= "fs_\');__append(fldCtl);__append(\'" value="\');__append(fldSize);__append(\'">\\n<input type="hidden" name="fx_\');__append(fldCtl);__append(\'" id= "fx_\');__append(fldCtl);__append(\'" value="\');__append(Code.write(Code.getName(fldObj,Code.Field.UploadAllowedFileExt)));__append(\'">\\n<input type="hidden" name="fm_\');__append(fldCtl);__append(\'" id= "fm_\');__append(fldCtl);__append(\'" value="\');__append(Code.write(Code.getName(fldObj,Code.Field.UploadMaxFileSize)));__append(\'">\\n\');if(field.FldUploadMultiple&&!IsBinaryField(field)){__append(\'\\n<input type="hidden" name="fc_\');__append(fldCtl);__append(\'" id= "fc_\');__append(fldCtl);__append(\'" value="\');__append(Code.write(Code.getName(fldObj,Code.Field.UploadMaxFileCount)));__append(\'">\\n\')}__append(\'\\n</div>\\n<table id="ft_\');__append(fldCtl);__append(\'" class="table table-sm float-left ew-upload-table"><tbody class="files"></tbody></table>\');let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditFile",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditHidden:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,tblVar=table.TblVar,fldVar=field.FldVar,pageAttr=MultiPageFieldAttribute(table,field),fldObj=Code.fldObj(field,table,control);ctl=ctl||fldVar;cv=cv||Code.getName(fldObj,Code.Field.CurrentValue);__append(\'\\n<input type="hidden" data-table="\');__append(tblVar);__append(\'" data-field="\');__append(fldVar);__append(\'" data-hidden="1"\');__append(pageAttr);__append(\' name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'" value="\');__append(Code.raw(Code.htmlEncode(cv)));__append(\'">\\n\');let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditHidden",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditLookup:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,out="",ctrlId=control.CtrlID.toLowerCase(),fldVar=field.FldVar,fldParm=field.FldParm,fldObj=Code.fldObj(field,table,control),errorMsg=FieldEditErrorMessage(_arguments),customMsg=FieldEditCustomMessage(_arguments),describedBy=!IsEmpty(customMsg)?` aria-describedby="${fldVar}_help"`:"";let isLinkTable=FieldIsLinkTable(table,field,ctlid),isSelectList=isLinkTable&&["TEXT","SELECT","RADIO","CHECKBOX"].includes(field.FldHtmlTag),isGrid=["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid),isAddOption=isSelectList&&field.FldSelectAllowAdd&&(["add","addopt","edit"].includes(ctrlId)||isGrid);let isAutoFill=isLinkTable&&!field.FldSelectMultiple&&field.FldHtmlTag!="CHECKBOX"&&IsAutofillMasterField(table,field,ctlid);let att=Code.getName(fldObj,Code.Field.EditAttributes),sepAtt=Code.getName(fldObj,Code.Field.DisplayValueSeparatorAttribute),pageAttr=MultiPageFieldAttribute(table,field),vv=Code.getName(fldObj,Code.Field.ViewValue);if(["search","extbs"].includes(ctlid)){if(cv.endsWith("2"))vv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.ViewValue2);else vv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.ViewValue)}let fldHtmlTag=field.FldHtmlTag;if(fldHtmlTag=="SELECT")fldHtmlTag=field.FldSelectMultiple?"CHECKBOX":"RADIO";else if(!["RADIO","CHECKBOX"].includes(fldHtmlTag))fldHtmlTag="RADIO";let selectType=fldHtmlTag=="CHECKBOX"?"1":"0",pageSize=field.FldModalLookupPageSize||10,selectTypeTable=fldHtmlTag=="RADIO"&&field.FldSelectType=="Table"&&!IsEmpty(field.FldTagLnkTbl)&&!IsEmpty(field.FldTagLnkFld)&&!IsEmpty(field.FldTagLnkDisplay)&&IsFieldGenerate(table,field,ctlid);isAutoFill=selectTypeTable&&IsAutofillMasterField(table,field,ctlid)&&fldHtmlTag=="RADIO";let onChange="",childFlds=table.ChildFields,childTable,childField;for(let childFld of childFlds){if(childFld.FldName==field.FldName){childTable=childFld.Table?GetTableObject(childFld.Table):table;childField=GetFieldObject(childTable,childFld.ChildField);if(childField!=null&&FieldIsFirstCombo(table,field,childTable,childField,ctlid)){let secondComboFldVar=childField.FldVar,firstComboFldVar=field.FldVar;if(["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid)){secondComboFldVar=RowVarQuoted(secondComboFldVar)}let secondComboFldVar2=AddSquareBrackets(secondComboFldVar,childField);if(ctl.startsWith("x")){if(onChange!="")onChange+=",";onChange+=`\'${secondComboFldVar2}\'`}}}}if(onChange!="")onChange="ew.updateOptions.call(this);";else if(isAutoFill)onChange+="ew.autoFill(this);";if(onChange){let editAttrs=Code.getName(fldObj,Code.Field.EditAttrs);__append("\\n<?php ");__append(editAttrs);__append(\'->prepend("onchange", "\');__append(onChange);__append(\'"); ?>\\n\')}let id=AddSquareBrackets(ctl,field),pleaseSelect=Code.languagePhrase("PleaseSelect");pleaseSelect=`${Code.emptyValue(Code.toString(vv))} ? ${pleaseSelect} : ${vv}`;let title=Code.languagePhrase("LookupLink",true),caption=Code.getName(fldObj,Code.Field.Caption);title=Code.htmlEncode(Code.replace(title,`"%s"`,Code.removeHtml(caption)));let readOnly=Code.getName(fldObj,Code.Field.ReadOnly),disabled=Code.getName(fldObj,Code.Field.Disabled);disabled=`(${readOnly} || ${disabled}) ? " disabled" : ""`;__append(\'\\n<div class="input-group ew-lookup-list"\');__append(describedBy);__append(\'>\\n    <div class="form-control ew-lookup-text" tabindex="-1" id="lu_\');__append(ctl);__append(\'">\');__append(Code.write(pleaseSelect));__append(\'</div>\\n    <div class="input-group-append">\\n        <button type="button" title="\');__append(Code.raw(title));__append(\'" class="ew-lookup-btn btn btn-default"\');__append(Code.write(disabled));__append(" onclick=\\"ew.modalLookupShow({lnk:this,el:\'");__append(id);__append("\',m:");__append(selectType);__append(",n:");__append(pageSize);__append(\'});"><i class="fas fa-search ew-icon"></i></button>\\n        \');if(isAddOption){__append("\\n        ");__append(String(FieldEditAjaxSelectAddOption(Object.assign({},_arguments,{useInputGroupAppend:false}))).replace(/\\n/g,"\\n        "));__append("\\n        ")}__append("\\n    </div>\\n</div>");__append(errorMsg);__append(customMsg);__append("\\n");if(isLinkTable){__append("\\n");__append(FieldEditAjaxSelectParamTag(_arguments));__append("\\n")}__append(\'\\n<input type="hidden" is="selection-list" data-table="\');__append(tblVar);__append(\'" data-field="\');__append(fldVar);__append(\'"\');__append(pageAttr);__append(\' data-type="text" data-multiple="\');__append(selectType);__append(\'" data-lookup="1" data-value-separator="\');__append(Code.write(sepAtt));__append(\'" name="\');__append(id);__append(\'" id="\');__append(id);__append(\'" value="\');__append(Code.write(cv));__append(\'"\');__append(Code.write(att));__append(">");let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditLookup",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditNo:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,tblVar=table.TblVar,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),att=Code.getName(fldObj,Code.Field.EditAttributes),pageAttr=MultiPageFieldAttribute(table,field),inputTextType=Code.write(Code.getName(fldObj,Code.Field.InputTextType)),errorMsg=FieldEditErrorMessage(_arguments),customMsg=FieldEditCustomMessage(_arguments),describedBy=!IsEmpty(customMsg)?` aria-describedby="${fldVar}_help"`:"";let input=`<input type="${inputTextType}" data-table="${tblVar}" data-field="${fldVar}"${pageAttr} name="${ctl}" id="${ctl}" value="${Code.write(ev)}"${Code.raw(att)}${describedBy}>`;input+=customMsg+errorMsg;__append("\\n");__append(input);__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditNo",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditPassword:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,parm:parm,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,fldObj=Code.fldObj(field,table,control),fldVar=field.FldVar,att=Code.getName(fldObj,Code.Field.EditAttributes),pageAttr=MultiPageFieldAttribute(table,field),size="",maxLength="",placeHolder="",getPlaceHolder=Code.getName(fldObj,Code.Field.GetPlaceHolder),errorMsg=FieldEditErrorMessage(_arguments),customMsg=FieldEditCustomMessage(_arguments),describedBy=!IsEmpty(customMsg)?` aria-describedby="${fldVar}_help"`:"",toggle=table.TblName==PROJ.SecTbl&&field.FldName==PROJ.SecPasswdFld&&!PROJ.MD5Password&&(PROJ.SecType=="Use Table"||PROJ.SecType=="Both");if(field.FldTagSize>0)size=` size="${field.FldTagSize}"`;if(field.FldTagMaxLength>0)maxLength=` maxlength="${field.FldTagMaxLength}"`;if(UsePlaceHolder!=""&&UsePlaceHolder!="None")placeHolder=` placeholder="${Code.write(Code.htmlEncode(getPlaceHolder))}"`;if((field.FldCheckPasswordStrength||field.FldGeneratePassword)&&parm!="confirm"){__append("\\n");__append(FieldEditUserTablePassword(_arguments));__append("\\n")}else{let value=ctlid=="edit"?` value="${Code.write(ev)}"`:"",input=`<input type="password" name="${ctl}" id="${ctl}" autocomplete="new-password" data-field="${fldVar}"${value}${size}${maxLength}${placeHolder}${Code.raw(att)}${describedBy}>`;__append(\'\\n<div class="input-group">\\n    \');__append(String(input).replace(/\\n/g,"\\n    "));__append(\'\\n    <div class="input-group-append">\');__append(TogglePasswordButton(true));__append("</div>\\n</div>\\n");__append(customMsg);__append("\\n");__append(errorMsg);__append("\\n")}__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditPassword",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditPrimaryKey:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{};__append("\\n");__append(FieldEditHidden(_arguments));__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditPrimaryKey",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditRadio:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,out="",tblVar=table.TblVar,fldObj=Code.fldObj(field,table,control),fldVar=field.FldVar,ctrlId=control.CtrlID.toLowerCase(),errorMsg=FieldEditErrorMessage(_arguments),customMsg=FieldEditCustomMessage(_arguments),describedBy=!IsEmpty(customMsg)?` aria-describedby="${fldVar}_help"`:"";let isLinkTable=FieldIsLinkTable(table,field,ctlid),isSelectList=isLinkTable&&["TEXT","SELECT","RADIO","CHECKBOX"].includes(field.FldHtmlTag),isGrid=["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid),isAddOption=isSelectList&&field.FldSelectAllowAdd&&(["add","addopt","edit"].includes(ctrlId)||isGrid);let att=Code.getName(fldObj,Code.Field.EditAttributes),sepAtt=Code.getName(fldObj,Code.Field.DisplayValueSeparatorAttribute),pageAttr=MultiPageFieldAttribute(table,field),pageValue=MultiPageFieldAttributeValue(table,field);let repeatColumns=field.FldRepeatColumns||0;if(repeatColumns<0)repeatColumns=0;let fldHtmlTag=field.FldHtmlTag;if(field.FldDropdown&&fldHtmlTag=="SELECT")fldHtmlTag=field.FldSelectMultiple?"CHECKBOX":"RADIO";let selectTypeTable=fldHtmlTag=="RADIO"&&field.FldSelectType=="Table"&&!IsEmpty(field.FldTagLnkTbl)&&!IsEmpty(field.FldTagLnkFld)&&!IsEmpty(field.FldTagLnkDisplay)&&IsFieldGenerate(table,field,ctlid);let isAutoFill=selectTypeTable&&IsAutofillMasterField(table,field,ctlid);let onChange="",childFlds=table.ChildFields,childTable,childField;for(let childFld of childFlds){if(childFld.FldName==field.FldName){childTable=childFld.Table?GetTableObject(childFld.Table):table;childField=GetFieldObject(childTable,childFld.ChildField);if(childField!=null&&FieldIsFirstCombo(table,field,childTable,childField,ctlid)){let secondComboFldVar=childField.FldVar,firstComboFldVar=field.FldVar;if(["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid)){secondComboFldVar=RowVarQuoted(secondComboFldVar)}let secondComboFldVar2=AddSquareBrackets(secondComboFldVar,childField);if(ctl.startsWith("x")){if(onChange!="")onChange+=",";onChange+="\'"+secondComboFldVar2+"\'"}}}}if(onChange!="")onChange="ew.updateOptions.call(this);";else if(isAutoFill)onChange+="ew.autoFill(this);";let editAttrs=Code.getName(fldObj,Code.Field.EditAttrs),readOnly=Code.getName(fldObj,Code.Field.ReadOnly);if(field.FldDropdown){let fldDropdownWidth=field.FldDropdownWidth;if(!IsNumber(fldDropdownWidth))fldDropdownWidth=0;let fldDropdownHeight=field.FldDropdownHeight;if(!IsNumber(fldDropdownHeight))fldDropdownHeight=0;let style="overflow-x: hidden;";if(fldDropdownWidth>0)style+=` min-width: ${fldDropdownWidth}px;`;if(fldDropdownHeight>0)style+=` max-height: ${fldDropdownHeight}px; overflow-y: auto;`;let vv=Code.getName(fldObj,Code.Field.ViewValue);if(["search","extbs"].includes(ctlid)){if(ctl.startsWith("x"))vv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.ViewValue);else vv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.ViewValue2)}__append("\\n");__append(FieldEditSelect({..._arguments,repeatColumns:repeatColumns,fldHtmlTag:fldHtmlTag,dropdown:true,dropdownWidth:fldDropdownWidth}));__append("\\n")}else{__append(\'\\n<template id="tp_\');__append(ctl);__append(\'">\\n    <div class="custom-control custom-radio">\\n        <input type="radio" class="custom-control-input" data-table="\');__append(tblVar);__append(\'" data-field="\');__append(fldVar);__append(\'" name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'"\');__append(Code.write(att));__append(\'>\\n        <label class="custom-control-label"></label>\\n    </div>\\n</template>\\n<div id="dsl_\');__append(ctl);__append(\'" class="ew-item-list"></div>\\n\');if(!IsEmpty(onChange)){__append("\\n<?php ");__append(editAttrs);__append(\'->prepend("onchange", "\');__append(onChange);__append(\'"); ?>\\n\')}__append(\'\\n<input type="hidden"\\n    is="selection-list"\\n    id="\');__append(ctl);__append(\'"\\n    name="\');__append(ctl);__append(\'"\\n    value="\');__append(Code.write(Code.htmlEncode(cv)));__append(\'"\\n    data-type="select-one"\\n    data-template="tp_\');__append(ctl);__append(\'"\\n    data-target="dsl_\');__append(ctl);__append(\'"\\n    data-repeatcolumn="\');__append(repeatColumns);__append(\'"\\n    class="form-control\');__append(Code.write(Code.getName(fldObj,Code.Field.IsInvalidClass)));__append(\'"\\n    data-table="\');__append(tblVar);__append(\'"\\n    data-field="\');__append(fldVar);__append(\'"\\n    \');__append(String(pageAttr.trim()).replace(/\\n/g,"\\n    "));__append(\'\\n    data-value-separator="\');__append(Code.write(sepAtt));__append(\'"\\n    \');__append(String(Code.write(att)).replace(/\\n/g,"\\n    "));__append(">\\n");__append(customMsg);__append("\\n");__append(errorMsg);__append("\\n");if(isAddOption){__append("\\n");__append(FieldEditAjaxSelectAddOption(Object.assign({},_arguments,{useInputGroupAppend:false})));__append("\\n")}__append("\\n");if(isSelectList){__append("\\n");__append(FieldEditAjaxSelectParamTag(_arguments));__append("\\n")}__append("\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditRadio",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditSelect:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld,dropdown:dropdown,repeatColumns:repeatColumns,fldHtmlTag:fldHtmlTag,dropdownWidth:dropdownWidth}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,tblVar=table.TblVar,formName=GetFormObject(ctlid),fldObj=Code.fldObj(field,table,control),fldVar=field.FldVar,fldParm=field.FldParm,ctrlId=control.CtrlID.toLowerCase(),errorMsg=FieldEditErrorMessage(_arguments),customMsg=FieldEditCustomMessage(_arguments),describedBy=!IsEmpty(customMsg)?` aria-describedby="${fldVar}_help"`:"";if(field.FldHtmlTag=="SELECT")dropdown=false;let isDateFilter=["summary","crosstab"].includes(table.TblReportType)&&IsDateFilter(field);let isLinkTable=FieldIsLinkTable(table,field,ctlid)||isDateFilter,isSelectList=isLinkTable&&["TEXT","SELECT","RADIO","CHECKBOX"].includes(field.FldHtmlTag),isGrid=["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid),isAddOption=isSelectList&&field.FldSelectAllowAdd&&(["add","addopt","edit"].includes(ctrlId)||isGrid);let isAutoFill=isLinkTable&&!field.FldSelectMultiple&&IsAutofillMasterField(table,field,ctlid);let att=Code.getName(fldObj,Code.Field.EditAttributes),sepAtt=Code.getName(fldObj,Code.Field.DisplayValueSeparatorAttribute),pageAttr=MultiPageFieldAttribute(table,field),multiple=false;if((fldHtmlTag=="CHECKBOX"||field.FldSelectMultiple)&&!isDateFilter){ctl=AddSquareBrackets(ctl,field);multiple=true}let onChange="",childFlds=table.ChildFields,childTable,childField;for(let childFld of childFlds){if(childFld.FldName==field.FldName){childTable=childFld.Table?GetTableObject(childFld.Table):table;childField=GetFieldObject(childTable,childFld.ChildField);if(childField!=null&&FieldIsFirstCombo(table,field,childTable,childField,ctlid)){let secondComboFldVar=childField.FldVar,firstComboFldVar=field.FldVar;if(isGrid){secondComboFldVar=RowVarQuoted(secondComboFldVar)}let secondComboFldVar2=AddSquareBrackets(secondComboFldVar,childField);if(ctl.startsWith("x")){if(onChange!="")onChange+=",";onChange+=`\'${secondComboFldVar2}\'`}}}}if(onChange!="")onChange="ew.updateOptions.call(this);";else if(isAutoFill)onChange+="ew.autoFill(this);";let placeHolder="",dataPlaceHolder="",getPlaceHolder=Code.getName(fldObj,Code.Field.GetPlaceHolder);if(UsePlaceHolder!=""&&UsePlaceHolder!="None"){placeHolder=` placeholder="${Code.write(Code.htmlEncode(getPlaceHolder))}"`;dataPlaceHolder=placeHolder.replace("placeholder=","data-placeholder=")}let selectId=tblVar+"_"+ctl;__append("\\n");if(onChange){__append("\\n<?php ");__append(Code.getName(fldObj,Code.Field.EditAttrs));__append(\'->prepend("onchange", "\');__append(onChange);__append(\'"); ?>\\n\')}__append("\\n");if(isAddOption){__append(\'\\n<div class="input-group flex-nowrap">\\n\')}__append(\'\\n    <select\\n        id="\');__append(ctl);__append(\'"\\n        name="\');__append(ctl);__append(\'"\\n        class="form-control ew-select\');__append(Code.write(Code.getName(fldObj,Code.Field.IsInvalidClass)));__append(\'"\\n        data-select2-id="\');__append(selectId);__append(\'"\\n        data-table="\');__append(tblVar);__append(\'"\\n        data-field="\');__append(fldVar);__append(\'"\\n        \');if(dropdown){__append("\\n        data-dropdown\\n        ")}__append("\\n        ");if(multiple){__append(\'\\n        multiple\\n        size="1"\\n        \')}__append("\\n        ");__append(String(pageAttr.trim()).replace(/\\n/g,"\\n        "));__append(\'\\n        data-value-separator="\');__append(Code.write(sepAtt));__append(\'"\\n        \');__append(String(dataPlaceHolder.trim()).replace(/\\n/g,"\\n        "));__append("\\n        ");__append(String(Code.write(att)).replace(/\\n/g,"\\n        "));__append(">\\n        ");__append(String(Code.write(`${Code.getName(fldObj,Code.Field.SelectOptionListHtml)}("${RowVarToQuoted(ctl)}")`)).replace(/\\n/g,"\\n        "));__append("\\n    </select>\\n    ");if(!isAddOption){__append("\\n    ");__append(String(customMsg).replace(/\\n/g,"\\n    "));__append("\\n    ");__append(String(errorMsg).replace(/\\n/g,"\\n    "));__append("\\n    ")}__append("\\n");if(isAddOption){__append("\\n    ");__append(String(FieldEditAjaxSelectAddOption(Object.assign({},_arguments,{useInputGroupAppend:true}))).replace(/\\n/g,"\\n    "));__append("\\n</div>\\n");__append(customMsg);__append("\\n");__append(errorMsg);__append("\\n")}__append("\\n");if(isLinkTable){__append("\\n");__append(FieldEditAjaxSelectParamTag(_arguments));__append("\\n")}__append(\'\\n<script>\\nloadjs.ready("head", function() {\\n    var el = document.querySelector("select[data-select2-id=\\\'\');__append(selectId);__append(\'\\\']"),\\n        options = { name: "\');__append(ctl);__append(\'", selectId: "\');__append(selectId);__append(\'", language: ew.LANGUAGE_ID, dir: ew.IS_RTL ? "rtl" : "ltr" };\\n    \');if(multiple){__append("\\n    options.multiple = true;\\n    options.closeOnSelect = false;\\n    ")}__append("\\n    ");if(field.FldSelectType!="Table"&&!IsEmpty(FieldTagValues(field))){__append("\\n    options.data = ew.vars.tables.");__append(tblVar);__append(".fields.");__append(fldParm);__append(".lookupOptions;\\n    ")}__append("\\n    ");if(dropdown){__append("\\n    options.columns = el.dataset.repeatcolumn || ");__append(repeatColumns||5);__append(\';\\n    options.dropdown = !ew.IS_MOBILE && options.columns > 0; // Use custom dropdown\\n    if (options.dropdown) {\\n        options.dropdownAutoWidth = true;\\n        options.dropdownCssClass = "ew-select-dropdown ew-select-\');__append(multiple?"multiple":"one");__append(\'";\\n        if (options.columns > 1)\\n            options.dropdownCssClass += " ew-repeat-column";\\n    }\\n    \')}__append(\'\\n    options.dropdownParent = $(el).closest("#ew-modal-dialog, #ew-add-opt-dialog")[0];\\n    \');if(field.FldSelectSearch){__append(\'\\n    options.ajax = { id: "\');__append(ctl);__append(\'", form: "\');__append(ctlid=="extbs"?formNameSearch:formName);__append(\'", limit: ew.AUTO_SUGGEST_MAX_ENTRIES };\\n    options.minimumInputLength = 1;\\n    \')}__append("\\n    Object.assign(options, ew.vars.tables.");__append(tblVar);__append(".fields.");__append(fldParm);__append(".selectOptions);\\n    ew.createSelect(options);\\n});\\n<\\/script>");let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditSelect",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditText:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,formName=GetFormObject(ctlid),ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldObj=Code.fldObj(field,table,control),fldVar=field.FldVar,fldParm=field.FldParm,isUserID=["Both","Use Table"].includes(PROJ.SecType)&&!IsEmpty(DB.SecuUserIDFld),isVirtualFld=IsVirtualLookupField(field),errorMsg=FieldEditErrorMessage(_arguments),customMsg=FieldEditCustomMessage(_arguments),describedBy=!IsEmpty(customMsg)?` aria-describedby="${fldVar}_help"`:"";let isLinkTable=FieldIsLinkTable(table,field,ctlid),isSelectList=isLinkTable,isGrid=["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid),isAddOption=isSelectList&&field.FldSelectAllowAdd&&(["add","addopt","edit"].includes(ctrlId)||isGrid);if(isAddOption&&ctrlId=="addopt"&&table.TblName==field.FldTagLnkTbl)isAddOption=false;let isAutoFill=isLinkTable&&IsAutofillMasterField(table,field,ctlid)&&field.FldSelectForceSelection;let att=Code.getName(fldObj,Code.Field.EditAttributes),sepAtt=Code.getName(fldObj,Code.Field.DisplayValueSeparatorAttribute),pageAttr=MultiPageFieldAttribute(table,field);let size="",maxLength="",tagSize=field.FldTagSize,placeHolder="",dataPlaceHolder="",getPlaceHolder=Code.getName(fldObj,Code.Field.GetPlaceHolder),inputTextType=Code.write(Code.getName(fldObj,Code.Field.InputTextType));if(field.FldHtmlTag=="TEXTAREA"&&PROJ.ReplaceTextAreaByText)tagSize=field.FldTagCols;if(tagSize>0)size=` size="${tagSize}"`;if(field.FldTagMaxLength>0&&!isVirtualFld)maxLength=` maxlength="${field.FldTagMaxLength}"`;if(UsePlaceHolder!=""&&UsePlaceHolder!="None"){placeHolder=` placeholder="${Code.write(Code.htmlEncode(getPlaceHolder))}"`;dataPlaceHolder=placeHolder.replace("placeholder=","data-placeholder=")}if(IsAutoSuggest(field)){let linkTable=GetTableObject(field.FldTagLnkTbl),linkDBID=linkTable.LinkDBID,linkTblVar=linkTable.TblVar,dbid=GetDbId(field.FldTagLnkTbl);let onChange="",childTable,childField;if(isLinkTable){let childFlds=table.ChildFields;for(let childFld of childFlds){if(childFld.FldName==field.FldName){childTable=childFld.Table?GetTableObject(childFld.Table):table;childField=GetFieldObject(childTable,childFld.ChildField);if(childField!=null&&FieldIsFirstCombo(table,field,childTable,childField,ctlid)){let secondComboFldVar=childField.FldVar,firstComboFldVar=field.FldVar;if(["list","grid"].includes(ctrlId)&&["edit","add"].includes(ctlid)){secondComboFldVar=RowVarQuoted(secondComboFldVar)}let secondComboFldVar2=AddSquareBrackets(secondComboFldVar,childField);if(ctl.startsWith("x")){if(onChange!="")onChange+=",";onChange+=`\'${secondComboFldVar2}\'`}}}}}if(onChange!="")onChange="ew.updateOptions.call(this);";if(isAutoFill)onChange+="ew.autoFill(this);";let pageId=ctlid=="extbs"?\', "extbs"\':"",dataModalLookup=field.FldModalLookup?\' data-type="text" data-multiple="0" data-lookup="1"\':"",pageSize=field.FldModalLookupPageSize||10;let isVirtualSearch=["extbs","search"].includes(ctlid)&&isVirtualFld,isForceSelect=field.FldSelectForceSelection&&!isVirtualSearch;let fldDropdownWidth=field.FldDropdownWidth;if(!IsNumber(fldDropdownWidth))fldDropdownWidth=0;let fldDropdownHeight=field.FldDropdownHeight;if(!IsNumber(fldDropdownHeight))fldDropdownHeight=0;let settings={id:ctl,forceSelect:isForceSelect};if(fldDropdownWidth>0)settings.minWidth=`${fldDropdownWidth}px`;if(fldDropdownHeight>0)settings.maxHeight=`${fldDropdownHeight}px`;let input=`<input type="${inputTextType}" class="form-control" name="sv_${ctl}" id="sv_${ctl}" value="${Code.write(Code.removeHtml(ev))}"${size}${maxLength}${placeHolder}${dataPlaceHolder}${Code.write(att)}${describedBy}>`,title=Code.htmlEncode(Code.replace(Code.languagePhrase("LookupLink",true),`"%s"`,Code.removeHtml(Code.getName(fldObj,Code.Field.Caption)))),readOnly=Code.getName(fldObj,Code.Field.ReadOnly),disabled=Code.getName(fldObj,Code.Field.Disabled),editAttrs=Code.getName(fldObj,Code.Field.EditAttrs);disabled=`(${readOnly} || ${disabled}) ? " disabled" : ""`;__append("\\n<?php\\n$onchange = ");__append(editAttrs);__append(\'->prepend("onchange", "\');__append(onChange);__append("\\");\\n$onchange = ($onchange) ? \' onchange=\\"\' . JsEncode($onchange) . \'\\"\' : \'\';\\n");__append(editAttrs);__append(\'["onchange"] = "";\\n?>\\n<span id="as_\');__append(ctl);__append(\'" class="ew-auto-suggest">\\n    \');if(field.FldModalLookup){__append(\'\\n    <div class="input-group flex-nowrap">\\n        \');__append(String(input).replace(/\\n/g,"\\n        "));__append(\'\\n        <div class="input-group-append">\\n            <button type="button" title="\');__append(Code.write(title));__append(\'" onclick="ew.modalLookupShow({lnk:this,el:\\\'\');__append(ctl);__append("\',m:0,n:");__append(pageSize);__append(",srch:");__append(!isForceSelect);__append(\'});" class="ew-lookup-btn btn btn-default"\');__append(Code.write(disabled));__append(\'><i class="fas fa-search ew-icon"></i></button>\\n            \');if(isAddOption){__append("\\n            ");__append(String(FieldEditAjaxSelectAddOption(Object.assign({},_arguments,{useInputGroupAppend:false}))).replace(/\\n/g,"\\n            "));__append("\\n            ")}__append("\\n        </div>\\n    </div>\\n    ")}else if(isAddOption){__append(\'\\n    <div class="input-group">\\n        \');__append(String(input).replace(/\\n/g,"\\n        "));__append("\\n        ");__append(String(FieldEditAjaxSelectAddOption(Object.assign({},_arguments,{useInputGroupAppend:true}))).replace(/\\n/g,"\\n        "));__append("\\n    </div>\\n    ")}else{__append("\\n    ");__append(String(input).replace(/\\n/g,"\\n    "));__append("\\n    ")}__append(\'\\n</span>\\n<input type="hidden" is="selection-list" class="form-control" data-table="\');__append(tblVar);__append(\'" data-field="\');__append(fldVar);__append(\'" data-input="sv_\');__append(ctl);__append(\'"\');__append(pageAttr);__append(dataModalLookup);__append(\' data-value-separator="\');__append(Code.write(sepAtt));__append(\'" name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'" value="\');__append(Code.write(Code.htmlEncode(cv)));__append(\'"\');__append(Code.write("$onchange"));__append(">\\n");__append(customMsg);__append("\\n");__append(errorMsg);__append(\'\\n<script>\\nloadjs.ready(["\');__append(formName);__append(\'"], function() {\\n    \');__append(String(formName).replace(/\\n/g,"\\n    "));__append(".createAutoSuggest(Object.assign(");__append(JSON.stringify(settings));__append(", ew.vars.tables.");__append(tblVar);__append(".fields.");__append(fldParm);__append(".autoSuggestOptions));\\n});\\n<\\/script>\\n")}else{if((field.FldCheckPasswordStrength||field.FldGeneratePassword)&&!["extbs","search"].includes(ctlid)&&fldVar.startsWith("x")){__append("\\n");__append(FieldEditUserTablePassword(_arguments));__append("\\n")}else{let value=` value="${Code.write(ev)}"`,dataFormat=GetFieldType(field.FldType)==2&&field.FldDtFormat>0?` data-format="${field.FldDtFormat}"`:"",input=`<input type="${inputTextType}" data-table="${tblVar}" data-field="${fldVar}"${pageAttr}${dataFormat} name="${ctl}" id="${ctl}"${size}${maxLength}${placeHolder}${value}${Code.write(att)}${describedBy}>`;input+=customMsg+errorMsg;__append("\\n");__append(input);__append("\\n")}}__append("\\n");if(isSelectList){__append("\\n");__append(FieldEditAjaxSelectParamTag(_arguments));__append("\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditText",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditTextarea:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,tblVar=table.TblVar,fldObj=Code.fldObj(field,table,control),fldVar=field.FldVar,att=Code.getName(fldObj,Code.Field.EditAttributes),pageAttr=MultiPageFieldAttribute(table,field),rows=field.FldTagRows?field.FldTagRows:4,cols=field.FldTagCols?field.FldTagCols:35,errorMsg=FieldEditErrorMessage(_arguments),customMsg=FieldEditCustomMessage(_arguments),describedBy=!IsEmpty(customMsg)?` aria-describedby="${fldVar}_help"`:"";let placeHolder="",getPlaceHolder=Code.getName(fldObj,Code.Field.GetPlaceHolder),editAttrs=Code.getName(fldObj,Code.Field.EditAttrs);if(UsePlaceHolder!=""&&UsePlaceHolder!="None"){placeHolder=` placeholder="${Code.write(Code.htmlEncode(getPlaceHolder))}"`}if(field.FldUseDHTMLEditor){__append("\\n<?php ");__append(editAttrs);__append(\'->appendClass("editor"); ?>\\n\')}let html=`<textarea data-table="${tblVar}" data-field="${fldVar}"${pageAttr} name="${ctl}" id="${ctl}" cols="${cols}" rows="${rows}"${placeHolder}${Code.raw(att)}${describedBy}>${Code.write(ev)}</textarea>`;html+=customMsg+errorMsg;__append("\\n");__append(html);__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditTextarea",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldEditUserTablePassword:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,tblVar=table.TblVar,fldObj=Code.fldObj(field,table,control),fldVar=field.FldVar,att=Code.getName(fldObj,Code.Field.EditAttributes),pageAttr=MultiPageFieldAttribute(table,field),size="",maxLength="",placeHolder="",getPlaceHolder=Code.getName(fldObj,Code.Field.GetPlaceHolder),errorMsg=FieldEditErrorMessage(_arguments),customMsg=FieldEditCustomMessage(_arguments),describedBy=!IsEmpty(customMsg)?` aria-describedby="${fldVar}_help"`:"",toggle=table.TblName==PROJ.SecTbl&&field.FldName==PROJ.SecPasswdFld&&!PROJ.MD5Password&&(PROJ.SecType=="Use Table"||PROJ.SecType=="Both");if(field.FldTagSize>0)size=` size="${field.FldTagSize}"`;if(field.FldTagMaxLength>0)maxLength=` maxlength="${field.FldTagMaxLength}"`;if(UsePlaceHolder!=""&&UsePlaceHolder!="None")placeHolder=` placeholder="${Code.write(Code.htmlEncode(getPlaceHolder))}"`;let checkPasswordStrength=field.FldCheckPasswordStrength&&fldVar.startsWith("x"),generatePassword=field.FldGeneratePassword&&fldVar.startsWith("x"),passwordStrengthId="",passwordStrengthTag="";if(checkPasswordStrength){passwordStrengthId=ctl.replace(/^x/,"pst");passwordStrengthTag=` data-password-strength="${passwordStrengthId}"`}let type=field.FldHtmlTag=="PASSWORD"?"password":"text",autocomplete=type=="password"?` autocomplete="new-password"`:"",value=type!="password"||ctlid=="edit"?` value="${Code.write(ev)}"`:"",input=`<input type="${type}"${autocomplete}${passwordStrengthTag} data-table="${tblVar}" data-field="${fldVar}"${pageAttr} name="${ctl}" id="${ctl}"${value}${size}${maxLength}${placeHolder}${Code.raw(att)}${describedBy}>`;__append(\'\\n<div class="input-group" id="\');__append(ctl.replace(/^x/,"ig"));__append(\'">\\n    \');__append(String(input).replace(/\\n/g,"\\n    "));__append(\'\\n    <div class="input-group-append">\\n        \');__append(String(TogglePasswordButton(!generatePassword)).replace(/\\n/g,"\\n        "));__append("\\n    ");if(generatePassword){__append(\'\\n        <button type="button" class="btn btn-default ew-password-generator rounded-right" title="\');__append(Code.write(Code.htmlTitle(Code.languagePhrase("GeneratePassword"))));__append(\'" data-password-field="\');__append(ctl);__append(\'" data-password-confirm="\');__append(ctl.replace(/^x/,"c"));__append(\'"\');__append(passwordStrengthTag);__append(">");__append(Code.raw(Code.languagePhrase("GeneratePassword")));__append("</button>\\n    ")}__append("\\n    </div>\\n</div>\\n");if(checkPasswordStrength){__append(\'\\n<div class="progress ew-password-strength-bar form-text mt-1 d-none" id="\');__append(passwordStrengthId);__append(\'">\\n    <div class="progress-bar" role="progressbar"></div>\\n</div>\\n\')}__append("\\n");__append(customMsg);__append("\\n");__append(errorMsg);let __args={arguments:arguments[0],code:__output};Events.emit("FieldEditUserTablePassword",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldGroupView:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),gv=Code.getName(fldObj,"GroupViewValue"),att=Code.getName(fldObj,Code.Field.ViewAttributes),scriptId=CustomScriptId(tblVar+"_"+fldParm,"value",CustomScriptGroupIndex(field,groupFields.length,true));let ctl=Code.write(gv);if(!IsEmpty(field.FldHrefFld)||IsFieldDrillDown(field))ctl=FieldViewHref({ctl:ctl,val:gv,ctrl:ctrl,tbl:tbl,fld:fld});let html=`<span${Code.raw(att)}>${ctl}</span>`;if(UseCustomTemplate)html=`<template id="${scriptId}">${html}</template>`;write(html);let __args={arguments:arguments[0],code:__output};Events.emit("FieldGroupView",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldList:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctl,ctrlId=control.CtrlID.toLowerCase(),isInlineEdit=table.TblInlineEdit&&ctrlId=="list",isGridEdit=table.TblGridEdit&&ctrlId=="list"||ctrlId=="grid",isGridAdd=table.TblGridAdd&&ctrlId=="list"||ctrlId=="grid",tblVar=table.TblVar,fldVar=field.FldVar,fldParm=field.FldParm,fldObj=Code.fldObj(field,table,control),hasUserTable=HasUserTable(),hasUserID=hasUserTable&&!IsEmpty(DB.SecuUserIDFld),isUserIDField=hasUserID&&table.TblUserIDFld==field.FldName;if(isInlineEdit||isGridEdit||isGridAdd){ctl=RowVar(fldVar)}else{ctl=fldVar}FieldSpanTagStart="";FieldSpanTagEnd="";if(ctrlId=="list"||ctrlId=="grid"){let recPerRow=table.TblUseGlobal?PROJ.RecPerRow:table.TblRecPerRow,rowCnt=Code.getName(PageObject,Code.RowCount),spanId=`el${Code.write(rowCnt)}_${tblVar}_${fldParm}`,classId="",viewClassId="";if(recPerRow<1){classId="form-group";viewClassId=`${tblVar}_${fldParm}`}FieldSpanTagStart=`<span id="${spanId}"`;if(classId!="")FieldSpanTagStart+=` class="${classId}"`;FieldSpanTagStart+=">";FieldSpanTagEnd="</span>"}if(UseCustomTemplate){let templateId=`${tblVar}_${fldParm}`,scriptIndex=CustomScriptRowCnt(),scriptType="value",scriptId=CustomScriptId(templateId,scriptType,scriptIndex);FieldSpanTagStart=`<template id="${scriptId}">`+FieldSpanTagStart;FieldSpanTagEnd+="</template>"}let cv=Code.getName(fldObj,Code.Field.CurrentValue),vv=Code.getName(fldObj,Code.Field.ViewValue),ev=Code.getName(fldObj,Code.Field.EditValue),ov=Code.getName(fldObj,Code.Field.OldValue),fv=Code.getName(fldObj,Code.Field.FormValue),ctlid="edit",ctlDbValue=Code.getName(fldObj,Code.Field.Upload.DbValue),rowAction=Code.getName(PageObject,Code.RowAction),rowType=Code.getName(PageObject,Code.RowType),isConfirm=Code.getName(PageObject,Code.IsConfirm),currentMode=Code.getName(PageObject,Code.CurrentMode);let octl="o"+ctl.substr(1);octl=AddSquareBrackets("o"+ctl.substr(1),field);let argse=Object.assign({},_arguments,{ctl:ctl,cv:cv,ev:ev});if(isInlineEdit||isGridEdit||isGridAdd){if(field.FldList){if(ctrlId=="grid"&&field.FldHtmlTag=="FILE"){__append("\\n<?php if (");__append(rowAction);__append(\' == "insert") { // Add record ?>\\n\');__append(FieldAdd(_arguments));__append("\\n<?php } elseif (");__append(rowType);__append(" == ROWTYPE_VIEW) { // View record ?>\\n");__append(FieldView(_arguments));__append("\\n<?php } else  { // Edit record ?>\\n");__append(FieldEdit(_arguments));__append("\\n<?php } ?>\\n")}else{__append("\\n");if(isGridAdd||isGridEdit){__append("\\n<?php if (");__append(rowType);__append(" == ROWTYPE_ADD) { // Add record ?>\\n");__append(FieldEditCall(Object.assign({},argse,{ctlid:"add"})));__append("\\n");__append(FieldEditHidden(Object.assign({},argse,{ctl:octl,cv:ov,ctlid:"add"})));__append("\\n<?php } ?>\\n")}__append("\\n");if(isInlineEdit||isGridEdit){__append("\\n<?php if (");__append(rowType);__append(" == ROWTYPE_EDIT) { // Edit record ?>\\n");__append(FieldEditCall(Object.assign({},argse,{ctlid:"edit"})));__append("\\n<?php } ?>\\n")}__append("\\n<?php if (");__append(rowType);__append(" == ROWTYPE_VIEW) { // View record ?>\\n");__append(FieldView(_arguments));__append("\\n");if(ctrlId=="grid"){__append("\\n<?php if (");__append(isConfirm);__append(") { ?>\\n");__append(FieldEditHidden(Object.assign({},argse,{ctlid:"add",ctl:GetFormObject(ctlid)+"$"+ctl,cv:fv})));__append("\\n");__append(FieldEditHidden(Object.assign({},argse,{ctlid:"add",ctl:GetFormObject(ctlid)+"$"+octl,cv:ov})));__append("\\n<?php } ?>\\n")}__append("\\n<?php } ?>\\n")}}else if(field.FldIsPrimaryKey){__append("\\n");if(isGridAdd||isGridEdit){__append("\\n<?php if (");__append(rowType);__append(" == ROWTYPE_ADD) { // Add record ?>\\n");if(isUserIDField){__append("\\n<?php\\n    ");__append(String(ov).replace(/\\n/g,"\\n    "));__append(" = CurrentUserID();\\n    ");__append(String(cv).replace(/\\n/g,"\\n    "));__append(" = CurrentUserID();\\n?>\\n")}__append("\\n");__append(FieldEditHidden(Object.assign({},argse,{ctlid:"add"})));__append("\\n");__append(FieldEditHidden(Object.assign({},argse,{ctlid:"add",ctl:octl,cv:ov})));__append("\\n<?php } ?>\\n")}__append("\\n");if(isInlineEdit||isGridEdit){__append("\\n<?php if (");__append(rowType);__append(" == ROWTYPE_EDIT || ");__append(currentMode);__append(\' == "edit") { ?>\\n\');if(isUserIDField){__append("\\n<?php ");__append(cv);__append(" = CurrentUserID(); ?>\\n")}__append("\\n");__append(FieldEditHidden(Object.assign({},argse,{ctlid:"edit"})));__append("\\n<?php } ?>\\n")}__append("\\n")}}else{__append("\\n");__append(FieldView(_arguments));__append("\\n")}__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("FieldList",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldOperator:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,fldParm=field.FldParm,fldObj=Code.fldObj(field,table,control),fldOpr=field.FldSrchOpr,ctl="z_"+fldParm,val=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchOperator),opr=fldOpr;__append("\\n");__append(FieldOperatorCall({ctl:ctl,val:val,opr:opr,ctrl:ctrl,tbl:tbl,fld:fld}));let __args={arguments:arguments[0],code:__output};Events.emit("FieldOperator",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldOperator2:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,fldParm=field.FldParm,fldObj=Code.fldObj(field,table,control),fldOpr=field.FldSrchOpr,ctl="w_"+fldParm,val=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchOperator2);if(fldOpr=="BETWEEN"){fldOpr="AND"}else{fldOpr=FIELD.FldSrchOpr2}__append("\\n");__append(FieldOperatorCall({ctl:ctl,val:val,opr:fldOpr,ctrl:ctrl,tbl:tbl,fld:fld}));let __args={arguments:arguments[0],code:__output};Events.emit("FieldOperator2",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldOperatorCall:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,val:val,opr:opr,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,ctrlId=control.CtrlID.toLowerCase(),table=tbl||TABLE,field=fld||FIELD;if(opr=="USER SELECT"){let oprList=["=","<>"],oprList2=["<","<=",">",">="],strList=["LIKE","NOT LIKE","STARTS WITH","ENDS WITH"],nullList=["IS NULL","IS NOT NULL"];if(GetFieldType(field.FldType)==4){}else if(GetFieldType(field.FldType)==3||IsVirtualLookupField(field)&&(field.FldHtmlTag=="TEXT"||field.FldVirtualLookupSearch)){oprList=oprList.concat(oprList2,strList)}else{oprList=oprList.concat(oprList2)}if(!field.FldReq){oprList=oprList.concat(nullList)}let formName=GetFormObject(ctrlId=="list"?"extbs":ctrlId);let event="";if(ctl.startsWith("z")&&GetFieldType(field.FldType)!=4){oprList.push("BETWEEN");event=` onchange="ew.searchOperatorChanged(this);"`}else if(ctl.startsWith("w")&&GetFieldType(field.FldType)!=4){event=` onchange="ew.searchOperatorChanged(this);"`}__append(\'\\n<select name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'" class="custom-select"\');__append(event);__append(">\\n");for(let value of oprList){let phrase=value=="="?"EQUAL":value,selected=`${val} == "${value}" ? " selected" : ""`;__append(\'\\n<option value="\');__append(value.replace(/</g,"&lt;").replace(/>/g,"&gt;"));__append(\'"\');__append(Code.write(selected));__append(">");__append(Code.raw(Code.languagePhrase(phrase)));__append("</option>\\n")}__append("\\n</select>\\n")}else{if(!["IS NULL","IS NOT NULL"].includes(opr)){__append("\\n");__append(Code.raw(Code.languagePhrase(opr)));__append(\'\\n<input type="hidden" name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'" value="\');__append(opr.replace(/</g,"&lt;").replace(/>/g,"&gt;"));__append(\'">\\n\')}}let __args={arguments:arguments[0],code:__output};Events.emit("FieldOperatorCall",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldSearch:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),ctl=fldVar,cv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchValue),ev=Code.getName(fldObj,Code.Field.EditValue),ctlid=ctrlId=="list"?"extbs":"search",att=Code.getName(fldObj,Code.Field.EditAttributes);FieldSpanTagStart="";FieldSpanTagEnd="";if(field.FldSrchOpr=="IS NULL"||field.FldSrchOpr=="IS NOT NULL"){ctl="z_"+fldParm;cv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchOperator);let fldVal=field.FldSrchOpr;__append("\\n<?php\\n$selwrk = (");__append(cv);__append(\' == "\');__append(fldVal);__append(\'") ? " checked" : "";\\n?>\\n<input type="hidden" name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'" value="\');__append(Code.write(cv));__append(\'">\\n<div class="custom-control custom-checkbox custom-control-inline"><input type="checkbox" class="custom-control-input" id="n_\');__append(ctl);__append(\'" onclick="ew.toggleSearchOperator.call(this, \\\'\');__append(ctl);__append("\', \'");__append(fldVal);__append("\');\\"");__append(Code.write("$selwrk"));__append(\'><label class="custom-control-label" for="n_\');__append(ctl);__append(\'">\');__append(Code.raw(Code.languagePhrase(fldVal)));__append("</label></div>\\n")}else{__append("\\n");__append(FieldEditCall({ctl:ctl,cv:cv,ev:ev,ctlid:ctlid}));__append("\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("FieldSearch",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldSearch2:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),ctl="y_"+fldParm,cv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchValue2),ev=Code.getName(fldObj,Code.Field.EditValue2),ctlid=ctrlId=="list"?"extbs":"search",att=Code.getName(fldObj,Code.Field.EditAttributes);FieldSpanTagStart="";FieldSpanTagEnd="";if(field.FldSrchOpr2=="IS NULL"||field.FldSrchOpr2=="IS NOT NULL"){ctl="w_"+fldParm;cv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchOperator2);let fldVal=field.FldSrchOpr2;__append("\\n<?php\\n$selwrk = (");__append(cv);__append(\' == "\');__append(fldVal);__append(\'") ? " checked" : "";\\n?>\\n<input type="hidden" name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'" value="\');__append(Code.write(cv));__append(\'">\\n<div class="custom-control custom-checkbox custom-control-inline"><input type="checkbox" class="custom-control-input" id="n_\');__append(ctl);__append(\'" onclick="ew.toggleSearchOperator.call(this, \\\'\');__append(ctl);__append("\', \'");__append(fldVal);__append("\');\\"");__append(Code.write("$selwrk"));__append(\'><label class="custom-control-label" for="n_\');__append(ctl);__append(\'">\');__append(Code.raw(Code.languagePhrase(fldVal)));__append("</label></div>\\n")}else{__append("\\n");__append(FieldEditCall({ctl:ctl,cv:cv,ev:ev,ctlid:ctlid}));__append("\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("FieldSearch2",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldSearchCaption:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let field=fld||FIELD,control=ctrl||CONTROL,table=tbl||TABLE,fldObj=Code.fldObj(field,table,control);write(Code.raw(Code.getName(fldObj,Code.Field.Caption)));let __args={arguments:arguments[0],code:__output};Events.emit("FieldSearchCaption",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldSearchCondition:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld}=_arguments;let field=fld||FIELD,fldParm=field.FldParm,fldObj=Code.fldObj(field),fldCond="v_"+fldParm,ctl=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchCondition);__append(\'\\n<div class="custom-control custom-radio custom-control-inline"><input class="custom-control-input" type="radio" id="\');__append(fldCond);__append(\'_1" name="\');__append(fldCond);__append(\'" value="AND"<?= (\');__append(ctl);__append(\' != "OR") ? " checked" : "" ?>><label class="custom-control-label" for="\');__append(fldCond);__append(\'_1">\');__append(Code.raw(Code.languagePhrase("AND")));__append(\'</label></div>\\n<div class="custom-control custom-radio custom-control-inline"><input class="custom-control-input" type="radio" id="\');__append(fldCond);__append(\'_2" name="\');__append(fldCond);__append(\'" value="OR"<?= (\');__append(ctl);__append(\' == "OR") ? " checked" : "" ?>><label class="custom-control-label" for="\');__append(fldCond);__append(\'_2">\');__append(Code.raw(Code.languagePhrase("OR")));__append("</label></div>");let __args={arguments:arguments[0],code:__output};Events.emit("FieldSearchCondition",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldSummaryGroupView:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{id:id,lvl:lvl,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),gv=Code.getName(fldObj,"GroupViewValue"),att=Code.getName(fldObj,Code.Field.ViewAttributes);let ctl=Code.raw(gv);if(!IsEmpty(field.FldHrefFld)||IsFieldDrillDown(field)){ctl=FieldViewHref({ctl:ctl,val:gv,ctrl:ctrl,tbl:tbl,fld:fld})}__append("\\n<span");__append(Code.raw(att));__append(">");__append(ctl);__append("</span>");let __args={arguments:arguments[0],code:__output};Events.emit("FieldSummaryGroupView",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldSummaryView:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{smry:smry,id:id,lvl:lvl,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),cv=Code.getName(fldObj,SummaryValueName(id)),vv=Code.getName(fldObj,SummaryViewValueName(id));_arguments=Object.assign(_arguments,{cv:cv,vv:vv});FieldSpanTagStart="";FieldSpanTagEnd="";if(UseCustomTemplate){let wrkid=((smry||"")+(id||"")).toLowerCase(),typ=wrkid!=""?wrkid:"value",idx="";if(wrkid.startsWith("page")||wrkid.startsWith("grand"))idx="";else if(["sum","avg","min","max","cnt"].includes(wrkid))idx=CustomScriptGroupIndex(field,lvl,true);else if(groupFields.length==0)idx="<?= $Page->RecordCount ?>_<?= $Page->RecordCount ?>";else idx=CustomScriptGroupIndex(field,groupFields.length);let scriptId=CustomScriptId(tblVar+"_"+fldParm,typ,idx);FieldSpanTagStart=`<template id="${scriptId}">`+FieldSpanTagStart;FieldSpanTagEnd="</template>"}__append("\\n");__append(FieldViewCall(_arguments));let __args={arguments:arguments[0],code:__output};Events.emit("FieldSummaryView",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldUpdate:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,tblVar=table.TblVar,fldParm=field.FldParm,fldObj=Code.fldObj(field,table,control),ctl="u_"+fldParm,multiUpdate=Code.getName(fldObj,Code.Field.MultiUpdate),multiUpdateSelected=Code.getName(fldObj,Code.Field.MultiUpdateSelected),checked=`${multiUpdateSelected} ? " checked" : ""`,caption=Code.getName(fldObj,Code.Field.Caption),isConfirm=Code.getName(PageObject,Code.IsConfirm);if(table.TblMultiUpdateConfirm){__append("\\n<?php if (!");__append(isConfirm);__append(\') { ?>\\n<div class="custom-control custom-checkbox">\\n    <input type="checkbox" name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'" class="custom-control-input ew-multi-select" value="1"\');__append(Code.write(checked));__append(\'>\\n    <label class="custom-control-label" for="u_\');__append(fldParm);__append(\'">\');__append(Code.raw(caption));__append(\'</label>\\n</div>\\n<?php } else { ?>\\n<input type="hidden" name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'" value="\');__append(Code.write(multiUpdate));__append(\'">\\n\');__append(Code.raw(caption));__append("\\n<?php } ?>\\n")}else{__append(\'\\n<div class="custom-control custom-checkbox">\\n    <input type="checkbox" name="\');__append(ctl);__append(\'" id="\');__append(ctl);__append(\'" class="custom-control-input ew-multi-select" value="1"\');__append(Code.write(checked));__append(\'>\\n    <label class="custom-control-label" for="u_\');__append(fldParm);__append(\'">\');__append(Code.raw(caption));__append("</label>\\n</div>\\n")}__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("FieldUpdate",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldView:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),cv=Code.getName(fldObj,Code.Field.CurrentValue),vv=Code.getName(fldObj,Code.Field.GetViewValue),pageAttr=ctrlId=="view"?MultiPageFieldAttribute(table,field):"";FieldSpanTagStart="";FieldSpanTagEnd="";if(ctrlId=="list"||ctrlId=="grid"){let recPerRow=table.TblUseGlobal?PROJ.RecPerRow:table.TblRecPerRow,rowCnt=Code.getName(PageObject,Code.RowCount),spanId=`el${Code.write(rowCnt)}_${tblVar}_${fldParm}`,classId="",viewClassId="";if(recPerRow<1){viewClassId=`${tblVar}_${fldParm}`}FieldSpanTagStart=`<span id="${spanId}"`;if(classId!="")FieldSpanTagStart+=` class="${classId}"`;FieldSpanTagStart+=">";FieldSpanTagEnd="</span>"}let spanId="",classId="";if(["view","delete","master"].includes(ctrlId)){if(ctrlId=="delete"){let rowCnt=Code.getName(PageObject,Code.RowCount);spanId=`el${Code.write(rowCnt)}_${tblVar}_${fldParm}`;classId=`${tblVar}_${fldParm}`}else{spanId=`el_${tblVar}_${fldParm}`}FieldSpanTagStart=`<span id="${spanId}"`;if(classId!="")FieldSpanTagStart+=` class="${classId}"`;FieldSpanTagStart+=pageAttr+">";FieldSpanTagEnd="</span>"}if(UseCustomTemplate){let scriptType="value",templateId=`${tblVar}_${fldParm}`,scriptIndex="";if(["list","delete"].includes(ctrlId)){scriptIndex=CustomScriptRowCnt()}else if(ctrlId=="summary"){if(groupFields.length==0)scriptIndex="<?= $Page->RecordCount ?>_<?= $Page->RecordCount ?>";else scriptIndex=CustomScriptGroupIndex(field,groupFields.length)}let scriptId=CustomScriptId(templateId,scriptType,scriptIndex);FieldSpanTagStart=`<template id="${scriptId}">`+FieldSpanTagStart;FieldSpanTagEnd+="</template>"}__append("\\n");__append(FieldViewCall({cv:cv,vv:vv,isedit:false,ctrl:ctrl,tbl:tbl,fld:fld}));let __args={arguments:arguments[0],code:__output};Events.emit("FieldView",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldViewCall:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,isedit:isedit,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),out="";switch(field.FldHtmlTag){case"NO":case"TEXT":case"PASSWORD":case"RADIO":case"SELECT":case"TEXTAREA":case"HIDDEN":out=FieldViewText(_arguments);break;case"CHECKBOX":if(IsBooleanField(table,field)){out=FieldViewCheckbox(_arguments)}else{out=FieldViewText(_arguments)}break;case"FILE":out=FieldViewFile({cv:cv,vv:vv,href:true,isedit:isedit,ctrl:ctrl,tbl:tbl,fld:fld});break}let att=Code.getName(fldObj,Code.Field.ViewAttributes),templateId=`${tblVar}_${fldParm}`,scriptIndex=null;if(["list","grid","delete"].includes(ctrlId)){scriptIndex=CustomScriptRowCnt()}FieldOriginalTemplate="";let customViewTemplate=GetCustomViewTemplate(table,field,out);UseCustomViewTemplate=!IsEmpty(customViewTemplate)&&customViewTemplate.trim()!=""&&!isedit;if(UseCustomViewTemplate){let name=`${tblVar}_${fldParm}`;if(UseCustomTemplate){let tagid=CustomScriptId(name,"value",scriptIndex);FieldOriginalTemplate+=CustomScriptTag(name,"value",ScriptTemplateClass,scriptIndex)+"\\n"+customViewTemplate+"\\n"+"</template>";out=`<slot name="${Quote(tagid)}"></slot>`}else{out=customViewTemplate}}__append("\\n");__append(FieldOriginalTemplate);__append("\\n");__append(FieldSpanTagStart);__append("\\n");if(field.FldViewTag=="IMAGE"){__append("\\n<span>");__append(out);__append("</span>\\n")}else{__append("\\n<span");__append(Code.raw(att));__append(">");__append(out);__append("</span>\\n")}__append("\\n");__append(FieldSpanTagEnd);__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("FieldViewCall",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldViewCheckbox:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,isedit:isedit,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldVar=field.FldVar,id=fldVar;if(["list","grid"].includes(ctrlId))fldVar=RowVar(fldVar);let chkClass=PROJ.UseBootstrapSwitch?"custom-switch":"custom-checkbox";__append(\'\\n<div class="custom-control \');__append(chkClass);__append(\' d-inline-block">\\n    <input type="checkbox" id="\');__append(id);__append("_");__append(Code.write(Code.getName(PageObject,Code.RowCount)));__append(\'" class="custom-control-input" value="\');__append(Code.write(vv));__append(\'" disabled<?php if (ConvertToBool(\');__append(cv);__append(\')) { ?> checked<?php } ?>>\\n    <label class="custom-control-label" for="\');__append(id);__append("_");__append(Code.write(Code.getName(PageObject,Code.RowCount)));__append(\'"></label>\\n</div>\');let __args={arguments:arguments[0],code:__output};Events.emit("FieldViewCheckbox",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldViewFile:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,href:href,isedit:isedit,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;href=IsUndefined(href)?true:href;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),ctlDbValue=Code.getName(fldObj,Code.Field.Upload.DbValue),att=Code.getName(fldObj,Code.Field.ViewAttributes),fldViewValue=Code.getName(fldObj,Code.Field.ViewValue),fldHrefValue=Code.getName(fldObj,Code.Field.HrefValue),fldUploadPath=Code.getName(fldObj,Code.Field.UploadPath),isUploadMultiple=field.FldUploadMultiple&&!IsBinaryField(field),fldHrefFld=href?field.FldHrefFld:"",fldTooltipFld=href?field.FldTooltipFld:"",out="",url="",imageWidthVar,imageHeightVar;out=Code.write("GetFileViewTag("+Code.getName(fldObj)+", "+vv+", "+Code.bool(!href)+")");if(!IsEmpty(out)){if(["list","grid"].includes(ctrlId)){fldVar=RowCountVar(fldVar)}if(IsUndefined(fld)&&!IsEmpty(fldTooltipFld)){let tooltipFld=GetFieldObject(table,fldTooltipFld),tooltipFldObj=Code.fldObj(tooltipFld,table,control),tooltipCv=Code.getName(fldObj,Code.Field.TooltipValue),tooltipVv=Code.getName(fldObj,Code.Field.TooltipValue),tooltipFieldView;if(tooltipFld.FldHtmlTag=="FILE"){_arguments=Object.assign(_arguments,{cv:tooltipCv,vv:tooltipVv,href:false,isedit:false,fld:tooltipFld});tooltipFieldView=FieldViewFile(_arguments)}else{_arguments=Object.assign(_arguments,{cv:tooltipCv,vv:tooltipVv,href:false,isedit:false,fld:tooltipFld});tooltipFieldView=FieldViewText(_arguments)}out+=`<div id="tt_${tblVar}_${fldVar}" class="d-none">\\n${tooltipFieldView}\\n</div>`}__append("\\n");__append(out);__append("\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("FieldViewFile",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldViewHref:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctl:ctl,val:val,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldObj=Code.fldObj(field,table,control),linkAtt=Code.getName(fldObj,Code.Field.LinkAttributes),fldHrefFld=field.FldHrefFld,fldTooltipFld=field.FldTooltipFld,dbValue=Code.getName(fldObj,Code.Field.Upload.DbValue),currentAction=Code.getName(PageObject,Code.CurrentAction),tooltipValue=Code.getName(fldObj,Code.Field.TooltipValue),exportHrefValue=Code.getName(fldObj,Code.Field.ExportHrefValue),fullUrl=`FullUrl(${exportHrefValue}, "href")`,isExportWord=Code.getName(PageObject,Code.IsExportWord),isExportExcel=Code.getName(PageObject,Code.IsExportExcel);if(field.FldHtmlTag=="FILE"){if(field.FldViewTag!="IMAGE"){if(fldHrefFld!=""&&fldHrefFld!=field.FldName)fldHrefFld=field.FldName}else if(field.FldViewTag=="IMAGE"&&PROJ.UseColorbox){if(fldHrefFld=="")fldHrefFld=field.FldName}}let prefix="",suffix="";if(!IsEmpty(fldHrefFld)||!IsEmpty(fldTooltipFld)||IsFieldDrillDown(field)){prefix=`<a${Code.write(linkAtt)}>`;suffix="</a>"}if(field.FldHtmlTag=="FILE"){__append("\\n<?php if (");__append(linkAtt);__append(\' != "") { ?>\\n<?php if (!empty(\');__append(dbValue);__append(")) { ?>\\n");__append(prefix);__append(ctl);__append(suffix);__append("\\n<?php } elseif (!in_array(");__append(currentAction);__append(\', ["show", "edit", "gridedit"])) { ?>\\n&nbsp;\\n<?php } ?>\\n<?php } else { ?>\\n<?php if (!empty(\');__append(dbValue);__append(")) { ?>\\n");__append(ctl);__append("\\n<?php } elseif (!in_array(");__append(currentAction);__append(\', ["show", "edit", "gridedit"])) { ?>\\n&nbsp;\\n<?php } ?>\\n<?php } ?>\\n\')}else{let checkVal="";if(!IsEmpty(fldHrefFld)&&!IsEmpty(fldTooltipFld)){checkVal=`(!${Code.emptyString(val)} || !${Code.emptyString(tooltipValue)}) && `}else if(!IsEmpty(fldHrefFld)){checkVal=`!${Code.emptyString(val)} && `}else if(!IsEmpty(fldTooltipFld)){checkVal=`!${Code.emptyString(tooltipValue)} && `}__append("\\n<?php if (");__append(checkVal);__append(linkAtt);__append(\' != "") { ?>\\n\');__append(prefix);__append(ctl);__append(suffix);__append("\\n<?php } else { ?>\\n");__append(ctl);__append("\\n<?php } ?>\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("FieldViewHref",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',FieldViewText:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,href:href,isedit:isedit,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;href=IsUndefined(href)?true:href;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),fldVar=field.FldVar,fldHrefFld=href?field.FldHrefFld:"",fldTooltipFld=href?field.FldTooltipFld:"",out="";switch(field.FldViewTag){case"IMAGE":out=Code.write("GetImageViewTag("+Code.getName(fldObj)+", "+vv+")");break;default:let thisvv=Code.write(vv);if(isedit&&field.FldHtmlTag!="TEXTAREA"){let dv=`${Code.getName(fldObj,Code.Field.getDisplayValue)}(${vv})`;thisvv=`<input type="text" readonly class="form-control-plaintext" value="${Code.raw(Code.htmlEncode(Code.removeHtml(dv)))}">`}if(!IsEmpty(fldHrefFld)||!IsEmpty(fldTooltipFld)||IsFieldDrillDown(field)){out=FieldViewHref({ctl:thisvv,val:vv,ctrl:ctrl,tbl:tbl,fld:fld})}else{out=thisvv}}if(["list","preview","grid"].includes(ctrlId)){fldVar=RowCountVar(fldVar)}if(IsUndefined(fld)&&!IsEmpty(fldTooltipFld)){let tooltipFld=GetFieldObject(table,fldTooltipFld),tooltipFldObj=Code.fldObj(tooltipFld,table,control),tooltipCv=Code.getName(fldObj,Code.Field.TooltipValue),tooltipVv=Code.getName(fldObj,Code.Field.TooltipValue),tooltipFieldView;if(tooltipFld.FldHtmlTag=="FILE"){tooltipFieldView=FieldViewFile({cv:tooltipCv,vv:tooltipVv,href:false,isedit:false,ctrl:ctrl,tbl:tbl,fld:tooltipFld})}else{tooltipFieldView=FieldViewText({cv:tooltipCv,vv:tooltipVv,href:false,isedit:false,ctrl:ctrl,tbl:tbl,fld:tooltipFld})}out+=`<span id="tt_${tblVar}_${fldVar}" class="d-none">\\n${tooltipFieldView}\\n</span>`}__append("\\n");__append(out);let __args={arguments:arguments[0],code:__output};Events.emit("FieldViewText",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',HeaderLogo:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{};let imageFolder=IncludeTrailingSlash(FolderPath("_images"));if(!IsEmpty(PROJ.HeaderLogo)){let logo=PROJ.HeaderLogo.trim();if(logo.match(/\\.(gif|png|jpe?g|bmp|ico|svg)$/i)){logo=logo.substr(logo.lastIndexOf("\\\\")+1);logo=imageFolder+logo;__append(\'\\n<img src="<?= GetUrl("\');__append(logo);__append(\'") ?>" alt="" class="brand-image ew-brand-image">\\n\')}else if(logo.startsWith("<")&&logo.endsWith(">")){__append("\\n");__append(logo);__append("\\n")}else{__append(\'\\n<span class="brand-text">\');__append(logo);__append("</span>\\n")}}let __args={arguments:arguments[0],code:__output};Events.emit("HeaderLogo",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',LookupSettings:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,fld:fld,lang:lang,ctrl:ctrl}=_arguments;let table=tbl||TABLE,field=fld||FIELD,control=ctrl||CONTROL,ctrlId=control.CtrlID.toLowerCase(),flds=table.Fields,parentFlds=table.ParentFields,childFlds=table.ChildFields,_fldVars={},linkTable,lnkTblVar="";if(!IsEmpty(field.FldTagLnkTbl)){linkTable=GetTableObject(field.FldTagLnkTbl);lnkTblVar=linkTable.TblVar;for(let f of linkTable.Fields){_fldVars[f.FldName]=f.FldVar}}else{linkTable=table;lnkTblVar=table.TblVar}function getFldVar(name){return name in _fldVars?_fldVars[name]:""}let fldTagLnkDisplay=GetLanguageFieldProperty(lang,table,field,"FldTagLnkDisplay"),fldTagLnkDisp2=GetLanguageFieldProperty(lang,table,field,"FldTagLnkDisp2"),fldTagLnkDisp3=GetLanguageFieldProperty(lang,table,field,"FldTagLnkDisp3"),fldTagLnkDisp4=GetLanguageFieldProperty(lang,table,field,"FldTagLnkDisp4");let f={LinkTable:lnkTblVar,LinkField:field.FldTagLnkFld,Distinct:field.FldTagLnkDistinct,DisplayFields:[fldTagLnkDisplay,fldTagLnkDisp2,fldTagLnkDisp3,fldTagLnkDisp4],ParentFields:[],ChildFields:[],FilterFields:[],FilterFieldVars:[],AutoFillSourceFields:[],AutoFillTargetFields:[],Template:null};f.Template=field.FldOptionTemplate.trim();if(f.Template!=""&&(!f.Template.startsWith("<")||!f.Template.endsWith(">")))f.Template="<div>"+f.Template+"</div>";let orderBy="",srcTable=linkTable;if(linkTable.TblType=="REPORT"&&!IsEmpty(linkTable.TblRptSrc))srcTable=GetTableObject(linkTable.TblRptSrc);if(!IsEmpty(field.FldTagLnkOrderBy)){let dbId=GetDbId(srcTable.TblName),orderByField=GetFieldObject(srcTable,field.FldTagLnkOrderBy);orderBy=FieldSqlName(orderByField,dbId)+" "+field.FldTagLnkOrderType;orderBy=orderBy.trim()}f.OrderBy=orderBy;let parentTable,parentField,parentFldVar;for(let parentFld of parentFlds){if(parentFld.FldName==field.FldName){if(parentFld.ParentTable&&parentFld.ParentTable!=table.TblName){parentTable=GetTableObject(parentFld.ParentTable);parentField=GetFieldObject(parentTable,parentFld.ParentField);parentFldVar=parentTable.TblVar+" "+parentField.FldVar}else{parentTable=table;parentField=GetFieldObject(parentTable,parentFld.ParentField);parentFldVar=AddSquareBrackets(parentField.FldVar,parentField)}if(ctrlId!="info"&&parentTable.TblName!=table.TblName)continue;if(parentField){f.ParentFields.push(parentFldVar);let filterField=GetFieldObject(linkTable,GetSelectFilter(field,parentFld.ParentField));if(filterField){f.FilterFields.push(filterField.FldName);let filterFldVar=AddSquareBrackets(filterField.FldVar,filterField);f.FilterFieldVars.push(filterFldVar)}}}}let childTable,childField,childFldVar;for(let childFld of childFlds){if(childFld.FldName==field.FldName){if(childFld.Table){childTable=GetTableObject(childFld.Table);childField=GetFieldObject(childTable,childFld.ChildField);childFldVar=childTable.TblVar+" "+AddSquareBrackets(childField.FldVar,childField)}else{childTable=table;childField=GetFieldObject(childTable,childFld.ChildField);childFldVar=AddSquareBrackets(childField.FldVar,childField)}f.ChildFields.push(childFldVar)}}if(field.FldAutoFillSourceFields&&field.FldAutoFillTargetFields){let sourceFlds=field.FldAutoFillSourceFields.split("||"),targetFlds=field.FldAutoFillTargetFields.split("||");targetFlds.forEach((function(targetFld,i){let targetField=GetFieldObject(table,targetFld);let sourceField=GetFieldObject(linkTable,sourceFlds[i]);if(targetField&&sourceField){f.AutoFillTargetFields.push(AddSquareBrackets(targetField.FldVar,targetField));f.AutoFillSourceFields.push(sourceField.FldName)}}))}return`new Lookup(\'${SingleQuote(field.FldName)}\', \'${SingleQuote(f.LinkTable)}\', ${Code.bool(f.Distinct)}, \'${SingleQuote(f.LinkField)}\', ${JSON.stringify(f.DisplayFields)}, ${JSON.stringify(f.ParentFields)}, ${JSON.stringify(f.ChildFields)}, ${JSON.stringify(f.FilterFields)}, ${JSON.stringify(f.FilterFieldVars)}, ${JSON.stringify(f.AutoFillSourceFields)}, ${JSON.stringify(f.AutoFillTargetFields)}, \'${SingleQuote(f.OrderBy)}\', \'${SingleQuote(f.Template)}\')`;let __args={arguments:arguments[0],code:__output};Events.emit("LookupSettings",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ParseFieldTemplate:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{template:template,source:source,ctlid:ctlid,tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let table=tbl||TABLE,field=fld||FIELD,control=ctrl||CONTROL,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control);let re=/\\{{3}(\\w+?)\\}{3}/gi,tmpl=template,matches=tmpl.matchAll(re);for(let ar of matches){let tag=ar[1],tagValue="";if(tag=="old_tag"){tagValue=source}else if(tag=="tag_id"){let name=tblVar+"_"+fldParm,idx=ctrlId=="list"&&ctlid!="extbs"||["grid","delete"].includes(ctrlId)?CustomScriptRowCnt():null;tagValue=CustomScriptId(name,"oldvalue",idx)}else if(tag=="value"){tagValue=Code.write(Code.getName(fldObj,Code.Field.CurrentValue))}else if(tag=="view_value"){tagValue=Code.write(Code.getName(fldObj,Code.Field.ViewValue))}else if(tag=="edit_value"){tagValue=Code.write(Code.getName(fldObj,Code.Field.EditValue))}else if(tag=="tblvar"){tagValue=tblVar}else if(tag=="id"||tag=="name"||tag=="fldvar"){tagValue=fldVar;if(ctrlId=="list"&&ctlid!="extbs")tagValue=RowVar(fldVar)}tmpl=tmpl.replace(ar[0],tagValue)}return tmpl;let __args={arguments:arguments[0],code:__output};Events.emit("ParseFieldTemplate",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ParseTemplate:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{template:template,id:id,tbl:tbl,ctrl:ctrl}=_arguments;let table=tbl||TABLE,control=ctrl||CONTROL,ctrlId=control.CtrlID.toLowerCase(),ctrlType=control.CtrlType.toLowerCase(),tblVar=table.TblVar;let re=/\\{{3}((caption|cp|header|hd|value|vl|value2|v2|operator|op|operator2|o2|condition|cn|list_options|list_option|cell_attrs|dbvalue|sum|avg|min|max|cnt|pagesum|pageavg|pagemin|pagemax|pagecnt|grandsum|grandavg|grandmin|grandmax|grandcnt|pagebreak|current_filters)?\\s+)?(\\w+?)\\}{3}/gi,tmpl=template,htmlTag="slot",tagName,index=CustomScriptVar(),scriptIndex=Code.write(index),scriptRowCnt=CustomScriptRowCnt(),groupIndex=CustomScriptGroupVar(),scriptGroupIndex=Code.write(groupIndex),rowIndex=ctrlId=="summary"?CustomScriptDetailRowVar():CustomScriptRowVar(),scriptRowIndex=Code.write(rowIndex),scriptHeaderRowSpan=1,scriptBodyRowSpan=1,scriptFooterRowSpan=1;let getTag=(tag,name,rowSpan)=>`<${tag} class="ew-slot" ${tag=="slot"?"name":"id"}="${name}"${tag=="th"||tag=="td"?\' data-rowspan="\'+rowSpan+\'"\':""}></${tag}>`;let matches=tmpl.matchAll(re);for(let ar of matches){let tag=ar[2]||"",fldName=ar[3],origFldName=fldName;switch(tag){case"cp ":tag="caption ";break;case"hd ":tag="header ";break;case"vl ":tag="value ";break;case"v2 ":tag="value2 ";break;case"op ":tag="operator ";break;case"o2 ":tag="operator2 ";break;case"cn ":tag="condition ";break;default:break}tagName=tag+fldName;tag=tag.trim();let repTag="";if(tagName=="current_filters"){tagName=CustomScriptId("","current_filters","");let repTag=getTag(htmlTag,tagName);tmpl=tmpl.replace(ar[0],repTag);continue}if(tagName=="row_cnt"||tagName=="row_index"||tagName=="i"){let tagValue="";if(["list","delete"].includes(ctrlId))tagValue=Code.write(CustomScriptVar());else{if(id.startsWith("groupheader")||id.startsWith("groupfooter")){let grpidx=id.substr(11);grpidx=grpidx==""?"":parseInt(grpidx)-1;tagValue=Code.write(CustomScriptGroupVar()+grpidx)}else if(id=="header"||id=="footer"){tagValue="1"}else{tagValue=Code.write(CustomScriptDetailRowVar())}}tmpl=tmpl.replace(ar[0],tagValue);continue}if(tagName=="count"){let tagValue="";if(id.startsWith("groupheader")||id.startsWith("groupfooter")){let grpidx=id.substr(11);grpidx=grpidx==""?1:parseInt(grpidx);let parm=groupIndex;for(let i=2;i<=grpidx;i++)parm+=", "+groupIndex+(i-1);tagValue="<?= $Page->getGroupCount("+parm+") ?>"}else if(id=="header"||id=="footer"){tagValue="<?= $Page->getGroupCount(0) ?>"}else{let grpidx=groupFields.length,parm=groupIndex;for(let i=2;i<=grpidx;i++)parm+=", "+groupIndex+(i-1);tagValue="<?= $Page->getGroupCount("+parm+") ?>"}tmpl=tmpl.replace(ar[0],tagValue);continue}if(tagName=="pagebreak"){tagName=CustomScriptId(tblVar,"pagebreak",scriptGroupIndex);let repTag=getTag(htmlTag,tagName);tmpl=tmpl.replace(ar[0],repTag);continue}if(tag=="dbvalue"){let tagValue="";if(["list","delete"].includes(ctrlId))tagValue="~root.rows["+Code.write(CustomScriptVar()+" - 1")+"]."+fldName;else if(ctrlId=="summary")tagValue="~root.rows["+Code.write(CustomScriptDetailVar()+" - 1")+"]."+fldName;else tagValue=fldName;tmpl=tmpl.replace(ar[0],tagValue);continue}if(tagName=="row_attrs"){let tagValue="";if(ctrlId=="list")tagValue=Code.write("@"+Code.getName(PageObject,"Attrs["+CustomScriptVar()+"][\'"+tagName+"\']"));tmpl=tmpl.replace(ar[0],tagValue);continue}if(tag=="cell_attrs"){let tagValue="";if(ctrlId=="list")tagValue=Code.write("@"+Code.getName(PageObject,"Attrs["+CustomScriptVar()+"][\'"+tag+"\'][\'"+fldName+"\']"));tmpl=tmpl.replace(ar[0],tagValue);continue}if(ctrlId=="list"&&(tag=="list_options"||tagName=="list_options"||tagName=="list_options_2")){if(tag=="list_options"&&!isNaN(parseInt(fldName))){if(id=="header")scriptHeaderRowSpan=parseInt(fldName);else if(id=="body")scriptBodyRowSpan=parseInt(fldName);else if(id=="footer")scriptFooterRowSpan=parseInt(fldName)}fldName="";let wrkTag=htmlTag;if(id=="header")if(tagName=="list_options_2"){tagName=CustomScriptId(tblVar,"o2h");repTag=getTag(wrkTag,tagName)}else{tagName=CustomScriptId(tblVar,"oh");repTag=getTag("th",tagName,scriptHeaderRowSpan)}else if(id=="body")if(tagName=="list_options_2"){tagName=CustomScriptId(tblVar,"o2b",scriptIndex);repTag=getTag(wrkTag,tagName)}else{tagName=CustomScriptId(tblVar,"ob",scriptIndex);repTag=getTag("td",tagName,scriptBodyRowSpan)}else if(id=="footer")if(tagName=="list_options_2"){tagName=CustomScriptId(tblVar,"o2f");repTag=getTag(wrkTag,tagName)}else{tagName=CustomScriptId(tblVar,"of");repTag=getTag("td",tagName,scriptFooterRowSpan)}}else if(ctrlId=="list"&&tag=="list_option"){if(id=="header")tagName=CustomScriptId(tblVar+"_"+fldName,"oh");else if(id=="body")tagName=CustomScriptId(tblVar+"_"+fldName,"ob",scriptIndex);else if(id=="footer")tagName=CustomScriptId(tblVar+"_"+fldName,"of");repTag=getTag(htmlTag,tagName)}else if(ctrlId=="summary"){let field=table.Fields.find((f=>f.FldParm==fldName));if(field){let scriptIndex="",isGroupSummaryTag=["sum","avg","min","max","cnt"].includes(tag),name=tblVar+"_"+field.FldParm;if(id=="footer"&&isGroupSummaryTag){tag="grand"+tag;isGroupSummaryTag=false}let isPageGrandSummaryTag=["pagesum","pageavg","pagemin","pagemax","pagecnt","grandsum","grandavg","grandmin","grandmax","grandcnt"].includes(tag);let grpidx=groupFields.length;if(id.startsWith("groupheader")||id.startsWith("groupfooter")){grpidx=id.substr(11);grpidx=grpidx==""?1:parseInt(grpidx)}if(field.FldGroupBy>0)grpidx=grpidx<field.FldGroupBy?grpidx:field.FldGroupBy;if(isPageGrandSummaryTag){scriptIndex=""}else if(id=="header"&&["","header"].includes(tag)){tag="header"}else if(id=="header"||id=="footer"){scriptIndex="1";for(let i=1;i<groupFields.length;i++)scriptIndex+=i<field.FldGroupBy||field.FldGroupBy==0?"_1":""}else{if(groupFields.length==0)scriptIndex=scriptRowIndex;else scriptIndex=scriptGroupIndex;for(let i=1;i<groupFields.length;i++)scriptIndex+=i<grpidx?"_<?= "+groupIndex+i+" ?>":"";if(isGroupSummaryTag){}else if(field.FldGroupBy>0){}else if(id.startsWith("groupheader")||id.startsWith("groupfooter")){scriptIndex+="_1"}else{scriptIndex+="_"+scriptRowIndex}}tagName=CustomScriptId(name,tag,scriptIndex);if(tag=="caption"){repTag="<?= $"+PageObject+"->"+field.FldParm+"->caption() ?>"}else{repTag+=getTag(htmlTag,tagName)}}}else{if(ctrlId=="register"&&(tagName=="confirm_password"||origFldName=="confirm_password"))fldName=PROJ.SecPasswdFld;if(tag==""&&id=="header")tag="header";if(tag==""&&id=="view")tag="oldvalue";if(tag==""&&id=="footer")tag="aggregate";let field=fldName&&(ctrlType=="table"||ctrlId=="register")?table.Fields.find((f=>f.FldParm==fldName)):undefined;if(field){let fldObj=Code.fldObj(field,table,control),fldParm=field.FldParm,fldCaption=Code.getName(fldObj,Code.Field.Caption);if(ctrlId=="register"&&(tagName=="confirm_password"||origFldName=="confirm_password")){if(tagName=="confirm_password"||tag=="caption")repTag+=Code.raw(Code.languagePhrase("Confirm"))+"&nbsp;"+Code.raw(fldCaption);if(tagName=="confirm_password"||tag=="value"){let name=tblVar+"_c_"+fldParm;tagName=CustomScriptId(name,"value");repTag+=getTag(htmlTag,tagName)}}else{let name=tblVar+"_"+fldParm;if(["list","delete"].includes(ctrlId)&&id=="body"){if(tag=="header")tagName=CustomScriptId(name,tag);else tagName=CustomScriptId(name,tag,scriptIndex)}else if(["list","delete"].includes(ctrlId)&&id=="view"){tagName=CustomScriptId(name,tag,scriptRowCnt)}else{tagName=CustomScriptId(name,tag)}if(tag=="caption"){repTag=Code.write(fldCaption)}else{if(tag==""&&(ctrlId=="search"||id=="search")){repTag=Code.write(fldCaption)+"&nbsp;";tagName=CustomScriptId(name,"operator");repTag+=getTag(htmlTag,tagName);tagName=CustomScriptId(name,"value");repTag+="&nbsp;"+getTag(htmlTag,tagName);if(field.FldSrchOpr=="USER SELECT"&&GetFieldType(field.FldType)!=4||field.FldSrchOpr=="BETWEEN"||!IsEmpty(field.FldSrchOpr2)){tagName=CustomScriptId(name,"condition");repTag+="&nbsp;"+getTag(htmlTag,tagName);if(!IsEmpty(field.FldSrchOpr2)){tagName=CustomScriptId(name,"operator2");repTag+="&nbsp;"+getTag(htmlTag,tagName)}tagName=CustomScriptId(name,"value2");repTag+="&nbsp;"+getTag(htmlTag,tagName)}}else if(tag==""&&!["list","delete"].includes(ctrlId)){var captionTagName=CustomScriptId(name,"header");if(!IsHiddenField(table,field,ctrlId))repTag+=getTag(htmlTag,captionTagName)+"&nbsp;";repTag+=getTag(htmlTag,tagName)}else{repTag+=getTag(htmlTag,tagName)}}}}else{tagName=CustomScriptId(fldName,tag);repTag=getTag(htmlTag,tagName)}}tmpl=tmpl.replace(ar[0],repTag)}return tmpl;let __args={arguments:arguments[0],code:__output};Events.emit("ParseTemplate",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',RenderCustomTemplate:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,ctrl:ctrl}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,ctrlId=control.CtrlID.toLowerCase(),ctrlType=CONTROL.CtrlType.toLowerCase(),tblVar=table.TblVar,divName,scriptName,templateData,isTemplateExist=CustomTemplateExist();if(isTemplateExist){__append(\'\\n<script class="ew-apply-template">\\nloadjs.ready(["jsrender", "makerjs"], function() {\\n    ew.templateData = { rows: \');__append(Code.write(Code.jsonEncode(Code.getName(PageObject,Code.Rows))));__append(" };\\n    ");if(["list","delete","summary"].includes(ctrlId))templateData="ew.templateData";else templateData="ew.templateData.rows[0]";if(UseCustomMultiPageTemplate&&MultiPageIndex>0){for(let i=1;i<=MultiPageIndex;i++){if(ctrlType=="table"||ctrlId=="register"){divName=CustomScriptId(tblVar+ctrlId+i,"div");scriptName=CustomScriptId(tblVar+ctrlId+i,"template")}else{divName=CustomScriptId(ctrlId+i,"div");scriptName=CustomScriptId(ctrlId+i,"template")}__append(\'\\n    ew.applyTemplate("\');__append(divName);__append(\'", "\');__append(scriptName);__append(\'", null, null, \');__append(templateData);__append(");\\n    ")}}let customTemplate=GetCustomTemplate(),classId=tblVar+ctrlId;if(UseCustomTemplate&&!IsEmpty(customTemplate)){if(["table","report"].includes(ctrlType)||ctrlId=="register"){divName=CustomScriptId(tblVar+ctrlId,"div");scriptName=CustomScriptId(tblVar+ctrlId,"template")}else{divName=CustomScriptId(ctrlId,"div");scriptName=CustomScriptId(ctrlId,"template")}__append(\'\\n    ew.applyTemplate("\');__append(divName);__append(\'", "\');__append(scriptName);__append(\'", "\');__append(classId);__append(\'", "\');__append(Code.write(Code.getName(PageObject,Code.CustomExport)));__append(\'", \');__append(templateData);__append(");\\n    ")}__append(\'\\n    loadjs.done("customtemplate");\\n});\\n<\\/script>\\n\')}let __args={arguments:arguments[0],code:__output};Events.emit("RenderCustomTemplate",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',RenderCustomTemplateSearch:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,ctrl:ctrl}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,isTemplateExist=CustomTemplateSearchExist();if(isTemplateExist){let divName=CustomScriptId(tblVar+ctrlId,"searchdiv"),scriptName=CustomScriptId(tblVar+ctrlId,"searchscript"),className=tblVar+"extendedsearch_js";__append(\'\\n<script>\\nloadjs.ready(["jsrender", "makerjs"], function() {\\n    ew.applyTemplate("\');__append(divName);__append(\'", "\');__append(scriptName);__append(\'");\\n});\\n<\\/script>\\n\')}let __args={arguments:arguments[0],code:__output};Events.emit("RenderCustomTemplateSearch",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ReportSql:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl}=_arguments;let table=tbl||TABLE;let reportName=table.TblName,tableName=table.TblRptSrc,srcTable=GetTableObject(tableName),dbId=GetDbId(tableName),dbType=DbType(dbId),selectPart,fromPart,wherePart,groupByPart,havingPart,orderByPart,limitPart;if(srcTable.TblType=="CUSTOMVIEW"){limitPart=SqlPart(srcTable.TblCustomSQL,"LIMIT").trim();groupByPart=SqlPart(srcTable.TblCustomSQL,"GROUP BY").trim();havingPart=SqlPart(srcTable.TblCustomSQL,"HAVING").trim();if(!IsEmpty(limitPart)||!IsEmpty(groupByPart)&&!IsEmpty(havingPart)){selectPart="*";fromPart="("+srcTable.TblCustomSQL+") "+QuotedName("CV_"+table.TblVar,dbId);wherePart="";groupByPart="";havingPart="";orderByPart=""}else{selectPart=SqlPart(srcTable.TblCustomSQL,"SELECT");fromPart=SqlPart(srcTable.TblCustomSQL,"FROM");wherePart=SqlPart(srcTable.TblCustomSQL,"WHERE");groupByPart=SqlPart(srcTable.TblCustomSQL,"GROUP BY");havingPart=SqlPart(srcTable.TblCustomSQL,"HAVING");orderByPart=""}}else{selectPart="*";fromPart=SqlTableName(srcTable,dbId);if(dbType=="ORACLE")selectPart=fromPart+"."+selectPart;let selectCustom=srcTable.Fields.filter((f=>f.FldGenerate&&f.FldIsCustom)).map((f=>(f.FldSQL==""?"\'\'":Quote(f.FldSQL))+" AS "+QuotedName(f.FldName,dbId))).join(", ");if(selectCustom!="")selectPart+=", "+selectCustom;wherePart="";groupByPart="";havingPart="";orderByPart="";limitPart=""}let groupFields=table.Fields.filter((f=>f.FldGroupBy>0)).slice().sort(((f1,f2)=>f1.FldGroupBy-f2.FldGroupBy));let sqlGrpFlds="",sqlOrderFlds="",fldSql="";for(let gf of groupFields){fldSql=FieldSqlName(gf,dbId);if(IsDbGroupField(gf.FldGroupByType)){let dbGrpSql=DbGroupSql(gf.FldGroupByType,gf.FldGroupByInterval,dbId);fldSql=dbGrpSql.replace(/%s/g,fldSql)}if(!IsEmpty(sqlGrpFlds))sqlGrpFlds+=", ";sqlGrpFlds+=fldSql;if(!IsEmpty(sqlOrderFlds))sqlOrderFlds+=", ";sqlOrderFlds+=fldSql;if(!IsEmpty(gf.FldOrder))sqlOrderFlds+=" "+gf.FldOrder;else sqlOrderFlds+=" ASC"}if(!IsEmpty(sqlOrderFlds)){if(!IsEmpty(orderByPart))orderByPart=sqlOrderFlds+", "+orderByPart;else orderByPart=sqlOrderFlds}let isAggFld=table.Fields.some((f=>{let fldSql=FieldSqlName(f,dbId),aggChk=fldSql.toUpperCase();return f.FldList&&(f.FldRptAggSum||f.FldRptAggAvg||f.FldRptAggMin||f.FldRptAggMax||f.FldRptAggCnt)&&(aggChk.startsWith("SUM(")||aggChk.startsWith("AVG(")||aggChk.startsWith("MIN(")||aggChk.startsWith("MAX(")||aggChk.startsWith("COUNT("))}));let selectAggPart="";let aggPfxPart="";for(let f of table.Fields){if(f.FldList){let fldSql=FieldSqlName(f,dbId),fldSqlAgg=fldSql,fldParm=f.FldParm.toLowerCase(),isFldAggPart=false,tmpFld=QuotedName("tmp_"+fldParm,dbId),sumFld=QuotedName("sum_"+fldParm,dbId),avgFld=QuotedName("avg_"+fldParm,dbId),minFld=QuotedName("min_"+fldParm,dbId),maxFld=QuotedName("max_"+fldParm,dbId),cntFld=QuotedName("cnt_"+fldParm,dbId);if(f.FldRptAggSum){if(isAggFld){if(!isFldAggPart){selectAggPart+=fldSqlAgg+" AS "+tmpFld+", ";isFldAggPart=true}aggPfxPart+="SUM("+tmpFld+") AS "+sumFld+", "}else{selectAggPart+="SUM("+fldSqlAgg+") AS "+sumFld+", "}}if(f.FldRptAggAvg){if(isAggFld){if(!isFldAggPart){selectAggPart+=fldSqlAgg+" AS "+tmpFld+", ";isFldAggPart=true}aggPfxPart+="AVG("+tmpFld+") AS "+avgFld+", "}else{selectAggPart+="AVG("+fldSqlAgg+") AS "+avgFld+", "}}let isAggNull=f.FldRptSkipNull;if(isAggNull&&GetFieldType(f.FldType)==1)fldSqlAgg=NullIfFunction(fldSqlAgg,dbId);if(f.FldRptAggMin){if(isAggFld){if(!isFldAggPart){selectAggPart+=fldSqlAgg+" AS "+tmpFld+", ";isFldAggPart=true}aggPfxPart+="MIN("+tmpFld+") AS "+minFld+", "}else{if(dbType=="ACCESS")selectAggPart+="MIN("+fldSql+") AS "+minFld+", ";else selectAggPart+="MIN("+fldSqlAgg+") AS "+minFld+", "}}if(f.FldRptAggMax){if(isAggFld){if(!isFldAggPart){selectAggPart+=fldSqlAgg+" AS "+tmpFld+", ";isFldAggPart=true}aggPfxPart+="MAX("+tmpFld+") AS "+maxFld+", "}else{selectAggPart+="MAX("+fldSqlAgg+") AS "+maxFld+", "}}if(f.FldRptAggCnt){if(isAggFld){if(!isFldAggPart){selectAggPart+=fldSqlAgg+" AS "+tmpFld+", ";isFldAggPart=true}aggPfxPart+="COUNT("+tmpFld+") AS "+cntFld+", "}else{if(isAggNull){if(dbType=="ACCESS")selectAggPart+="COUNT("+fldSql+") AS "+cntFld+", ";else selectAggPart+="COUNT("+fldSqlAgg+") AS "+cntFld+", "}else{selectAggPart+="COUNT(*) AS "+cntFld+", "}}}}}if(!IsEmpty(selectAggPart)){selectAggPart=selectAggPart.substr(0,selectAggPart.length-2)}else{selectAggPart="*"}if(!IsEmpty(aggPfxPart)){aggPfxPart=aggPfxPart.substr(0,aggPfxPart.length-2)}return{SELECT:selectPart,"SELECT AGGREGATE":selectAggPart,"AGGREGATE PREFIX":aggPfxPart,FROM:fromPart,WHERE:wherePart,"GROUP BY":groupByPart,HAVING:havingPart,"ORDER BY":orderByPart};let __args={arguments:arguments[0],code:__output};Events.emit("ReportSql",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',Script:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctlid:ctlid,tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let table=tbl||TABLE,field=fld||FIELD,control=ctrl||CONTROL,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldName=field.FldName,fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),fldType=GetFieldType(field.FldType),isUserTable=HasUserTable(),isNullable=(field.FldAttribute&32)==32,skipUpdate=Code.false,sessionValue=Code.getName(fldObj,Code.Field.SessionValue),readOnly=Code.getName(fldObj,Code.Field.ReadOnly),fileCheck=Code.getName(fldObj,Code.Field.Visible),currentValue=Code.getName(fldObj,Code.Field.CurrentValue),imageWidth=Code.getName(fldObj,Code.Field.ImageWidth),imageHeight=Code.getName(fldObj,Code.Field.ImageHeight),dbValue=Code.getName(fldObj,Code.Field.DbValue),multiUpdate=Code.getName(fldObj,Code.Field.MultiUpdate),uploadFileName=Code.getName(fldObj,Code.Field.Upload.FileName),uploadFileSize=Code.getName(fldObj,Code.Field.Upload.FileSize),uploadContentType=Code.getName(fldObj,Code.Field.Upload.ContentType),uploadImageWidth=Code.getName(fldObj,Code.Field.Upload.ImageWidth),uploadImageHeight=Code.getName(fldObj,Code.Field.Upload.ImageHeight),uploadValue=Code.getName(fldObj,Code.Field.Upload.Value),uploadDbValue=Code.getName(fldObj,Code.Field.Upload.DbValue),uploadKeepFile=Code.getName(fldObj,Code.Field.Upload.KeepFile),uploadResize=Code.getName(fldObj,Code.Field.Upload.Resize),rsnew=Code.getName("rsnew"),rsold=Code.getName("rsold"),rsoldFields=Code.getName("rsold","fields"),setDbValueDef=Code.getName(fldObj,Code.Field.SetDbValueDef),resizeWidth,resizeHeight,interpolation,fileNameField,fileTypeField,fileSizeField,imageWidthField,imageHeightField,tmpDefValue,tmpSetDbValueDef;if(!IsEmpty(field.FldDbDefault)&&ctlid=="insert"){skipUpdate=`${Code.toString(currentValue)} == ""`}else if(ctlid=="update"){skipUpdate=readOnly;fileCheck+=` && !${skipUpdate}`;if(ctrlId=="update"){skipUpdate+=` || ${multiUpdate} != "1"`;fileCheck+=` && ${Code.toString(multiUpdate)} == "1"`}if(isUserTable&&PROJ.SecTbl==table.TblName&&PROJ.SecPasswdFld==fldName){skipUpdate+=` || Config("ENCRYPTED_PASSWORD") && $rsold[\'${SingleQuote(fldName)}\'] == ${currentValue}`}}else{skipUpdate=Code.false}let defaultValue=Code.null;if(IsBooleanField(table,field))fldType=4;if(IsDetailKeyField(table,field)&&ctlid=="update"){__append("\\nif (");__append(sessionValue);__append(\' != "") {\\n    \');__append(String(readOnly).replace(/\\n/g,"\\n    "));__append(" = true;\\n}\\n")}switch(fldType){case 1:if(!isNullable)defaultValue="0";break;case 2:if(!isNullable)defaultValue="CurrentDate()";break;case 7:if(!isNullable)defaultValue="CurrentTime()";break;case 3:if(!isNullable)defaultValue=`""`;break;case 4:if(!isNullable)defaultValue=FalseValue;break;case 5:if(!isNullable)defaultValue=`"{00000000-0000-0000-0000-000000000000}"`;break;default:defaultValue=Code.null;break}if(!IsEmpty(field.FldAutoUpdateValue)){__append("\\n");__append(currentValue);__append(" = ");__append(field.FldAutoUpdateValue);__append(";\\n");__append(setDbValueDef);__append("(");__append(rsnew);__append(", ");__append(currentValue);__append(", ");__append(defaultValue);__append(");\\n")}else{if(!field.FldAutoIncrement){if(IsFileRelatedField(table,field)){return""}if(field.FldHtmlTag=="FILE"){let skipUpdateCheckStart="",skipUpdateCheckEnd="";if(fileCheck==""){skipUpdateCheckStart=`if (!${uploadKeepFile}) {`;skipUpdateCheckEnd="}"}else{skipUpdateCheckStart=`if (${fileCheck} && !${uploadKeepFile}) {`;skipUpdateCheckEnd="}"}__append("\\n");__append(skipUpdateCheckStart);__append("\\n");if(IsBinaryField(field)){let dbId=GetDbId(table.TblName),dbType=DbType(dbId),fldTypeName=field.FldTypeName.toUpperCase();__append("\\n    if (");__append(uploadValue);__append(" === null) {\\n        ");__append(String(rsnew).replace(/\\n/g,"\\n        "));__append("[\'");__append(SingleQuote(fldName));__append("\'] = null;\\n    } else {\\n");if(field.FldUploadResize){resizeWidth=field.FldResizeWidth;resizeHeight=field.FldResizeHeight;if(resizeWidth<=0&&resizeHeight<=0){resizeWidth=Code.Config.ThumbnailDefaultWidth;resizeHeight=Code.Config.ThumbnailDefaultHeight}__append("\\n        ");__append(String(uploadResize).replace(/\\n/g,"\\n        "));__append("(");__append(resizeWidth);__append(", ");__append(resizeHeight);__append(");\\n        ");__append(String(imageWidth).replace(/\\n/g,"\\n        "));__append(" = ");__append(resizeWidth);__append("; // Resize width\\n        ");__append(String(imageHeight).replace(/\\n/g,"\\n        "));__append(" = ");__append(resizeHeight);__append("; // Resize height\\n")}__append("\\n        ");__append(String(rsnew).replace(/\\n/g,"\\n        "));__append("[\'");__append(SingleQuote(fldName));__append("\'] = ");__append(uploadValue);__append(";\\n    }\\n");if(!IsEmpty(field.FileNameFld)){fileNameField=GetFieldObject(table,field.FileNameFld);let fileNameFldVar=fileNameField.FldVar,fileNameFldParm=fileNameField.FldParm;if((fileNameField.FldAttribute&32)==32){tmpDefValue=Code.null}else{tmpDefValue=`""`}tmpSetDbValueDef=Code.getName(Code.this,fileNameFldParm,Code.Field.SetDbValueDef);__append("\\n    ");__append(String(tmpSetDbValueDef).replace(/\\n/g,"\\n    "));__append("(");__append(rsnew);__append(", ");__append(uploadFileName);__append(", ");__append(tmpDefValue);__append(", ");__append(Code.false);__append(");\\n")}}else{__append("\\n");if(ctlid=="update"){__append("\\n    ");__append(String(uploadDbValue).replace(/\\n/g,"\\n    "));__append(" = ");__append(rsold);__append("[\'");__append(SingleQuote(fldName));__append("\']; // Get original value\\n")}else{__append("\\n    ");__append(String(uploadDbValue).replace(/\\n/g,"\\n    "));__append(\' = ""; // No need to delete old file\\n\')}__append("\\n    if (");__append(uploadFileName);__append(\' == "") {\\n        \');__append(String(rsnew).replace(/\\n/g,"\\n        "));__append("[\'");__append(SingleQuote(fldName));__append("\'] = null;\\n    } else {\\n");if(ctlid=="insert"&&PROJ.CreateUploadFileOnCopy){__append("\\n        if (");__append(rsold);__append(" && ");__append(rsoldFields);__append("[\'");__append(SingleQuote(fldName));__append(\'\\\'] != "" && \');__append(uploadFileName);__append(\' != "") {\\n    \');if(!field.FldUploadMultiple){__append("\\n            $oldFiles = [");__append(rsoldFields);__append("[\'");__append(SingleQuote(fldName));__append("\']];\\n            $newFiles = [");__append(uploadFileName);__append("];\\n    ")}else{__append(\'\\n            $oldFiles = explode(Config("MULTIPLE_UPLOAD_SEPARATOR"), \');__append(rsoldFields);__append("[\'");__append(SingleQuote(fldName));__append(\'\\\']);\\n            $newFiles = explode(Config("MULTIPLE_UPLOAD_SEPARATOR"), \');__append(uploadFileName);__append(");\\n    ")}__append(\'\\n            $newFileCount = count($newFiles);\\n            for ($i = 0; $i < $newFileCount; $i++) {\\n                if ($newFiles[$i] != "" && in_array($newFiles[$i], $oldFiles)) {\\n                    $tempFile = UniqueFilename($\');__append(fldObj);__append("->physicalUploadPath(), $newFiles[$i]);\\n                    rename(UploadTempPath($");__append(fldObj);__append(", $");__append(fldObj);__append("->Upload->Index) . $newFiles[$i], UploadTempPath($");__append(fldObj);__append(", $");__append(fldObj);__append("->Upload->Index) . $tempFile);\\n                    $newFiles[$i] = $tempFile;\\n                }\\n            }\\n            ");__append(String(uploadFileName).replace(/\\n/g,"\\n            "));__append(\' = implode(Config("MULTIPLE_UPLOAD_SEPARATOR"), $newFiles);\\n        }\\n\')}__append("\\n        ");__append(String(rsnew).replace(/\\n/g,"\\n        "));__append("[\'");__append(SingleQuote(fldName));__append("\'] = ");__append(uploadFileName);__append(";\\n    }\\n");if(field.FldUploadResize){resizeWidth=field.FldResizeWidth;resizeHeight=field.FldResizeHeight;if(resizeWidth<0)resizeWidth=0;if(resizeHeight<0)resizeHeight=0;if(resizeWidth==0&&resizeHeight==0){resizeWidth=Code.Config.ThumbnailDefaultWidth;resizeHeight=Code.Config.ThumbnailDefaultHeight}__append("\\n    ");__append(String(imageWidth).replace(/\\n/g,"\\n    "));__append(" = ");__append(resizeWidth);__append("; // Resize width\\n    ");__append(String(imageHeight).replace(/\\n/g,"\\n    "));__append(" = ");__append(resizeHeight);__append("; // Resize height\\n")}}if(!IsEmpty(field.FileTypeFld)){fileTypeField=GetFieldObject(table,field.FileTypeFld);let fileTypeFldVar=fileTypeField.FldVar,fileTypeFldParm=fileTypeField.FldParm;if((fileTypeField.FldAttribute&32)==32){tmpDefValue=Code.null}else{tmpDefValue=`""`}tmpSetDbValueDef=Code.getName(Code.this,fileTypeFldParm,Code.Field.SetDbValueDef);__append("\\n    ");__append(String(tmpSetDbValueDef).replace(/\\n/g,"\\n    "));__append("(");__append(rsnew);__append(", trim(");__append(uploadContentType);__append("), ");__append(tmpDefValue);__append(", ");__append(Code.false);__append(");\\n")}if(!IsEmpty(field.FileSizeFld)){fileSizeField=GetFieldObject(table,field.FileSizeFld);let fileSizeFldVar=fileSizeField.FldVar,fileSizeFldParm=fileSizeField.FldParm;if((fileSizeField.FldAttribute&32)==32){tmpDefValue=Code.null}else{tmpDefValue="0"}tmpSetDbValueDef=Code.getName(Code.this,fileSizeFldParm,Code.Field.SetDbValueDef);__append("\\n    ");__append(String(tmpSetDbValueDef).replace(/\\n/g,"\\n    "));__append("(");__append(rsnew);__append(", ");__append(uploadFileSize);__append(", ");__append(tmpDefValue);__append(", ");__append(Code.false);__append(");\\n")}if(!IsEmpty(field.ImageWidthFld)&&!IsEmpty(field.ImageHeightFld)){if(!IsBinaryField(field)&&!field.FldUploadMultiple){__append("\\n    if (!EmptyValue(");__append(uploadValue);__append(")) { // Get resize dimensions\\n        $tmpValue = ");__append(uploadValue);__append(";\\n        ");__append(String(uploadResize).replace(/\\n/g,"\\n        "));__append("(");__append(imageWidth);__append(", ");__append(imageHeight);__append(");\\n        ");__append(String(uploadValue).replace(/\\n/g,"\\n        "));__append(" = $tmpValue;\\n    }\\n")}imageWidthField=GetFieldObject(table,field.ImageWidthFld);let imageWidthFldVar=imageWidthField.FldVar,imageWidthFldParm=imageWidthField.FldParm;if((imageWidthField.FldAttribute&32)==32){tmpDefValue=Code.null}else{tmpDefValue="0"}tmpSetDbValueDef=Code.getName(Code.this,imageWidthFldParm,Code.Field.SetDbValueDef);__append("\\n    ");__append(String(tmpSetDbValueDef).replace(/\\n/g,"\\n    "));__append("(");__append(rsnew);__append(", ");__append(uploadImageWidth);__append(", ");__append(tmpDefValue);__append(", ");__append(Code.false);__append(");\\n");imageHeightField=GetFieldObject(table,field.ImageHeightFld);let imageHeightFldVar=imageHeightField.FldVar,imageHeightFldParm=imageHeightField.FldParm;if((imageHeightField.FldAttribute&32)==32){tmpDefValue=Code.null}else{tmpDefValue="0"}tmpSetDbValueDef=Code.getName(Code.this,imageHeightFldParm,Code.Field.SetDbValueDef);__append("\\n    ");__append(String(tmpSetDbValueDef).replace(/\\n/g,"\\n    "));__append("(");__append(rsnew);__append(", ");__append(uploadImageHeight);__append(", ");__append(tmpDefValue);__append(", ");__append(Code.false);__append(");\\n")}__append("\\n");__append(skipUpdateCheckEnd);__append("\\n")}else{let fldType=field.FldType;if(IsBooleanField(table,field))fldType=11;switch(fldType){case 7:case 133:case 135:case 145:case 146:if(field.FldViewTag=="FORMATTED TEXT"&&field.FldFmtType=="Date/Time"){__append("\\n");__append(setDbValueDef);__append("(");__append(rsnew);__append(", UnFormatDateTime(");__append(currentValue);__append(", ");__append(field.FldDtFormat);__append("), ");__append(defaultValue);__append(", ");__append(skipUpdate);__append(");\\n")}else{__append("\\n");__append(setDbValueDef);__append("(");__append(rsnew);__append(", ");__append(currentValue);__append(", ");__append(defaultValue);__append(", ");__append(skipUpdate);__append(");\\n")}break;case 134:;__append("\\n");__append(setDbValueDef);__append("(");__append(rsnew);__append(", ");__append(currentValue);__append(", ");__append(defaultValue);__append(", ");__append(skipUpdate);__append(");\\n");break;case 11:if(/^[yn]$/i.test(defaultValue))defaultValue=`"${defaultValue}"`;if(field.FldHtmlTag=="CHECKBOX"){__append("\\n$tmpBool = ");__append(currentValue);__append(\';\\nif ($tmpBool != "\');__append(TrueValue);__append(\'" && $tmpBool != "\');__append(FalseValue);__append(\'") {\\n    $tmpBool = !empty($tmpBool) ? "\');__append(TrueValue);__append(\'" : "\');__append(FalseValue);__append(\'";\\n}\\n\');__append(setDbValueDef);__append("(");__append(rsnew);__append(", $tmpBool, ");__append(defaultValue);__append(", ");__append(skipUpdate);__append(");\\n")}else{__append("\\n");__append(setDbValueDef);__append("(");__append(rsnew);__append(", ");__append(Code.toString(currentValue));__append(\' == "\');__append(TrueValue);__append(\'" ? "\');__append(TrueValue);__append(\'" : "\');__append(FalseValue);__append(\'", \');__append(defaultValue);__append(", ");__append(skipUpdate);__append(");\\n")}break;default:if(field.FldHtmlTag=="PASSWORD"){__append("\\nif (!IsMaskedPassword(");__append(currentValue);__append(")) {\\n    ");__append(String(setDbValueDef).replace(/\\n/g,"\\n    "));__append("(");__append(rsnew);__append(", ");__append(currentValue);__append(", ");__append(defaultValue);__append(", ");__append(skipUpdate);__append(");\\n}\\n")}else{__append("\\n");__append(setDbValueDef);__append("(");__append(rsnew);__append(", ");__append(currentValue);__append(", ");__append(defaultValue);__append(", ");__append(skipUpdate);__append(");\\n")}break}}if(__output.length&&isUserTable&&PROJ.SecTbl==table.TblName&&DB.SecUserLevelFld==field.FldName){return`\\nif ($Security->canAdmin()) { // System admin\\n    ${__output.replace(/\\n/g,"\\n    ")}\\n}\\n`}}}let __args={arguments:arguments[0],code:__output};Events.emit("Script",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptAdd:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let field=fld||FIELD,table=tbl||TABLE,control=ctrl||CONTROL,fldObj=Code.fldObj(field,table,control),ctlid="add",cv=Code.getName(fldObj,Code.Field.CurrentValue),ev=Code.getName(fldObj,Code.Field.EditValue);_arguments=Object.assign(_arguments,{cv:cv,ev:ev,ctlid:ctlid});__append("\\n");__append(ScriptEditCall(_arguments));let __args={arguments:arguments[0],code:__output};Events.emit("ScriptAdd",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptAddRefer:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let field=fld||FIELD,table=tbl||TABLE,control=ctrl||CONTROL,fldObj=Code.fldObj(field,table,control),ctlid="add",cv=Code.getName(fldObj,Code.Field.CurrentValue),ev=Code.getName(fldObj,Code.Field.EditValue);_arguments=Object.assign(_arguments,{cv:cv,ev:ev,ctlid:ctlid});__append("\\n");__append(ScriptReferCall(_arguments));let __args={arguments:arguments[0],code:__output};Events.emit("ScriptAddRefer",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptAggregate:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let table=tbl||TABLE,field=fld||FIELD,control=ctrl||CONTROL,fldObj=Code.fldObj(field,table,control),fldAggregate=field.FldAggregate.toLowerCase(),ctlid="aggregate",cv=Code.getName(fldObj,Code.Field.CurrentValue),vv=Code.getName(fldObj,Code.Field.ViewValue),hv=Code.getName(fldObj,Code.Field.HrefValue),tt=Code.getName(fldObj,Code.Field.Total),cnt=Code.getName(fldObj,Code.Field.Count);if(fldAggregate=="total"){__append("\\n");__append(cv);__append(" = ");__append(tt);__append(";\\n")}else if(fldAggregate=="average"){__append("\\nif (");__append(cnt);__append(" > 0) {\\n    ");__append(String(cv).replace(/\\n/g,"\\n    "));__append(" = ");__append(tt);__append(" / ");__append(cnt);__append(";\\n}\\n")}else if(fldAggregate=="count"){__append("\\n");__append(cv);__append(" = ");__append(cnt);__append(";\\n")}let argsv=Object.assign({},_arguments,{cv:cv,vv:vv,ctlid:ctlid});__append("\\n");__append(ScriptViewCall(argsv));__append("\\n");__append(hv);__append(\' = ""; // Clear href value\');let __args={arguments:arguments[0],code:__output};Events.emit("ScriptAggregate",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptCommon:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),style="";switch(ctrlId){case"list":case"grid":case"delete":case"info":case"summary":case"crosstab":style=FieldStyle(field);break}if(style!=""){__append("\\n");__append(Code.getName(fldObj,Code.Field.CellCssStyle));__append(\' = "\');__append(style);__append(\'";\\n\')}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptCommon",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEdit:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let field=fld||FIELD,table=tbl||TABLE,control=ctrl||CONTROL,fldObj=Code.fldObj(field,table,control),ctlid="edit",cv=Code.getName(fldObj,Code.Field.CurrentValue),ev=Code.getName(fldObj,Code.Field.EditValue);_arguments=Object.assign(_arguments,{cv:cv,ev:ev,ctlid:ctlid});__append("\\n");__append(ScriptEditCall(_arguments));let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEdit",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditCall:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldName=field.FldName,fldObj=Code.fldObj(field,table,control),ov=Code.getName(fldObj,Code.Field.OldValue),fldHtmlTag=field.FldHtmlTag,userTable=HasUserTable(),userID=userTable&&!IsEmpty(DB.SecuUserIDFld),tableHasUserIDFld=userID&&!IsEmpty(table.TblUserIDFld),parentUserID=userID&&!IsEmpty(DB.SecuParentUserIDFld),out="";if(!IsEmpty(field.FldAutoUpdateValue)){if(ctrlId=="addopt")fldHtmlTag="HIDDEN";else if(!["extbs","search"].includes(ctlid))return""}if(["search","extbs"].includes(ctlid)&&(IsVirtualLookupField(field)&&field.FldVirtualLookupSearch||fldHtmlTag=="FILE"&&!IsBinaryField(field)))fldHtmlTag="TEXT";if(["summary","crosstab"].includes(table.TblReportType)&&IsDateFilter(field)){ctlid="search";fldHtmlTag="DATEFILTER"}if(fldHtmlTag!="TEXT"&&field.FldModalLookup){if(FieldIsLinkTable(table,field,ctlid))fldHtmlTag="LOOKUP"}else if(field.FldDropdown){if(fldHtmlTag=="SELECT")fldHtmlTag=field.FldSelectMultiple?"CHECKBOX":"RADIO"}if(field.FldAutoIncrement&&ctlid=="add"){return""}if((field.FldHtmlTagReadOnly||field.FldIsPrimaryKey&&field.FldAutoIncrement)&&ctlid=="edit")fldHtmlTag="HIDDEN";switch(fldHtmlTag){case"NO":out=ScriptEditText(_arguments);break;case"TEXT":out=ScriptEditText(_arguments);break;case"PASSWORD":out=ScriptEditPassword(_arguments);break;case"RADIO":out=ScriptEditRadio(_arguments);break;case"CHECKBOX":out=ScriptEditCheckbox(_arguments);break;case"SELECT":out=ScriptEditSelect(_arguments);break;case"TEXTAREA":out=ScriptEditTextarea(_arguments);break;case"HIDDEN":if(ctrlId=="addopt"||ctlid=="add"&&(!IsEmpty(field.FldDefault)||tableHasUserIDFld&&table.TblUserIDFld==fldName)||ctlid=="edit"){out=ScriptEditHidden(_arguments)}else{out=ScriptEditText(_arguments)}break;case"FILE":out=ScriptEditFile(_arguments);break;case"LOOKUP":out=ScriptEditTable(_arguments);break;case"DATEFILTER":out=ScriptEditDateFilter(_arguments);break}let formatWrk="";if(!["extbs","search"].includes(ctlid))formatWrk=ScriptEditFormat(_arguments);if(!IsEmpty(formatWrk)){if((ctrlId=="list"&&table.TblGridAdd||ctrlId=="grid")&&fldHtmlTag=="TEXT"){formatWrk=`if (strval(${ev}) != "" && is_numeric(${ev})) {\\n    ${ev} = ${formatWrk};\\n    ${ov} = ${ev};\\n}\\n`}else{formatWrk=`if (strval(${ev}) != "" && is_numeric(${ev})) {\\n    ${ev} = ${formatWrk};\\n}`}}if(table.TblReportType=="summary"&&!IsEmpty(field.FldFilterName)){formatWrk+=`${ev} = $${fldObj}->FormatAdvancedFilters(${ev});\\n`}if(!["RADIO","CHECKBOX","LOOKUP"].includes(fldHtmlTag)){let className="";if(field.FldCheckPasswordStrength)className="form-control ew-password-strength";else className="form-control";__append("\\n");__append(Code.getName(fldObj,Code.Field.EditAttrs));__append(\'["class"] = "\');__append(className);__append(\'";\\n\')}if(fldHtmlTag=="FILE"){if(!IsEmpty(field.FileAccept)){__append("\\n");__append(Code.getName(fldObj,Code.Field.EditAttrs));__append(\'["accept"] = "\');__append(Quote(field.FileAccept));__append(\'";\\n\')}if(!IsEmpty(field.FileCapture)){__append("\\n");__append(Code.getName(fldObj,Code.Field.EditAttrs));__append(\'["capture"] = "\');__append(Quote(field.FileCapture));__append(\'";\\n\')}}let fldEditCustomAttributes=field.FldEditCustomAttributes;if(IsEmpty(fldEditCustomAttributes))fldEditCustomAttributes=`""`;__append("\\n");__append(Code.getName(fldObj,Code.Field.EditCustomAttributes));__append(" = ");__append(fldEditCustomAttributes);__append(";\\n");let argsv=Object.assign({},_arguments,{vv:ev}),argsu=Object.assign({},_arguments,{userid:""});if((field.FldHtmlTagReadOnly||field.FldIsPrimaryKey)&&ctlid=="edit"&&!IsHiddenField(TABLE,field,ctlid)){if(field.FldHtmlTagReadOnly||field.FldIsPrimaryKey&&field.FldAutoIncrement)out=ScriptViewCall(argsv);__append("\\n");__append(out);__append("\\n")}else{let firstCond=true,condStr;if(IsDetailKeyField(TABLE,field)&&!["search","extbs"].includes(ctlid)&&ctrlId!="addopt"){condStr=firstCond?"if":"} elseif";firstCond=false;let sv=Code.getName(fldObj,Code.Field.SessionValue);__append("\\n");__append(condStr);__append(" (");__append(sv);__append(\' != "") {\\n    \');__append(String(cv).replace(/\\n/g,"\\n    "));__append(" = GetForeignKeyValue(");__append(sv);__append(");\\n    ");if(ctrlId=="list"&&table.TblGridAdd||ctrlId=="grid"){__append("\\n    ");__append(String(Code.getName(fldObj,Code.Field.OldValue)).replace(/\\n/g,"\\n    "));__append(" = ");__append(cv);__append(";\\n    ")}__append("\\n    ");__append(String(ScriptView(_arguments)).replace(/\\n/g,"\\n    "));__append("\\n")}if(parentUserID&&table.TblName==PROJ.SecTbl&&field.FldName==DB.SecuParentUserIDFld&&ctrlId!="register"){condStr=firstCond?"if":"} elseif";firstCond=false;let userIdField=GetFieldObject(table,table.TblUserIDFld),userId=Code.getName(Code.this,userIdField?.FldParm,Code.Field.CurrentValue);argsu=Object.assign(argsu,{userid:userId});__append("\\n");__append(condStr);__append(" (!$Security->isAdmin() && $Security->isLoggedIn()) { // Non system admin\\n");if(field.FldHtmlTag!="HIDDEN"){__append("\\n    ");if(ctlid=="edit"){__append("\\n    if (SameString(");__append(userId);__append(", CurrentUserID())) {\\n        ");__append(String(ScriptViewCall(argsv)).replace(/\\n/g,"\\n        "));__append("\\n    } else {\\n    ")}__append("\\n    ");__append(String(ScriptEditUserId(argsu)).replace(/\\n/g,"\\n    "));__append("\\n    ");if(ctlid=="edit"){__append("\\n    }\\n    ")}__append("\\n")}else{__append("\\n    ");__append(String(cv).replace(/\\n/g,"\\n    "));__append(" = CurrentUserID();\\n    ");__append(String(ScriptViewCall(argsv)).replace(/\\n/g,"\\n    "));__append("\\n")}__append("\\n")}if(tableHasUserIDFld&&field.FldName==table.TblUserIDFld&&field.FldHtmlTag!="HIDDEN"&&ctrlId!="register"){condStr=firstCond?"if":"} elseif";firstCond=false;let userIdAllowId="";if(ctrlId=="list")userIdAllowId=Code.getName(Code.this,Code.CurrentAction);else userIdAllowId=`"${ctrlId}"`;argsu=Object.assign(argsu,{userid:""});__append("\\n");__append(condStr);__append(" (!$Security->isAdmin() && $Security->isLoggedIn() && !$this->userIDAllow(");__append(userIdAllowId);__append(")) { // Non system admin\\n");if(parentUserID){__append("\\n    ");__append(String(ScriptEditUserId(argsu)).replace(/\\n/g,"\\n    "));__append("\\n")}else{__append("\\n    ");__append(String(cv).replace(/\\n/g,"\\n    "));__append(" = CurrentUserID();\\n    ");__append(String(ScriptViewCall(argsv)).replace(/\\n/g,"\\n    "));__append("\\n")}__append("\\n")}if(userTable&&PROJ.SecTbl==table.TblName&&DB.SecUserLevelFld==field.FldName){condStr=firstCond?"if":"} elseif";firstCond=false;__append("\\n");__append(condStr);__append(" (!$Security->canAdmin()) { // System admin\\n    ");__append(String(ScriptViewPassword(argsv)).replace(/\\n/g,"\\n    "));__append("\\n")}if(firstCond){__append("\\n");__append(out);__append("\\n");__append(formatWrk);__append("\\n")}else{__append("\\n} else {\\n    ");__append(String(out).replace(/\\n/g,"\\n    "));__append("\\n    ");__append(String(formatWrk).replace(/\\n/g,"\\n    "));__append("\\n}\\n")}}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditCall",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditCheckbox:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld}=_arguments;let field=fld||FIELD;if(field.FldSelectType=="Table"){return ScriptEditTable(_arguments)}else{return ScriptEditValues(_arguments)}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditCheckbox",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditDateFilter:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,field=fld||FIELD,table=tbl||TABLE,fldObj=Code.fldObj(field,table,control);__append("\\n");__append(ev);__append(" = GetDropDownEditValue($");__append(fldObj);__append(", ");__append(cv);__append(");");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditDateFilter",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditDefaultValue:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let table=tbl||TABLE,field=fld||FIELD,control=ctrl||CONTROL,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldName=field.FldName,fldObj=Code.fldObj(field,table,control),currentValue=Code.getName(fldObj,Code.Field.CurrentValue),oldValue=Code.getName(fldObj,Code.Field.OldValue),fldVal=field.FldHtmlTag=="FILE"?Code.getName(fldObj,Code.Field.Upload.DbValue):currentValue,userTable=HasUserTable(),userID=userTable&&!IsEmpty(DB.SecuUserIDFld),userIDFld=userID&&table.TblUserIDFld==field.FldName,parentUserID=userID&&!IsEmpty(DB.SecuParentUserIDFld);if(["list","grid","add","addopt","register"].includes(ctrlId)){if(userIDFld&&table.TblName!=PROJ.SecTbl){__append("\\n");__append(currentValue);__append(" = CurrentUserID();\\n");if(ctrlId=="list"&&(table.TblGridAdd||table.TblGridEdit)||ctrlId=="grid"){__append("\\n");__append(oldValue);__append(" = ");__append(currentValue);__append(";\\n")}__append("\\n")}else if(!IsEmpty(field.FldDefault)&&!["NO","FILE"].includes(field.FldHtmlTag)){__append("\\n");__append(currentValue);__append(" = ");__append(field.FldDefault);__append(";\\n");if(ctrlId=="list"&&(table.TblGridAdd||table.TblGridEdit)||ctrlId=="grid"){__append("\\n");__append(oldValue);__append(" = ");__append(currentValue);__append(";\\n")}__append("\\n")}else{__append("\\n");__append(fldVal);__append(" = null;\\n");__append(oldValue);__append(" = ");__append(fldVal);__append(";\\n")}}if(["add","addopt"].includes(ctrlId)&&table.Fields.some((f=>f.FldHtmlTag=="FILE"&&[f.FileTypeFld,f.FileNameFld,f.FileSizeFld,f.ImageWidthFld,f.ImageHeightFld].includes(fldName)))){__append("\\n");__append(currentValue);__append(" = null; // Clear file related field\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditDefaultValue",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditFile:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),uploadObj=Code.getName(fldObj),rowIndex=Code.getName(Code.this,Code.RowIndex),eventCancelled=Code.getName(Code.this,Code.EventCancelled),isShow=Code.getName(Code.this,Code.IsShow),isCopy=Code.getName(Code.this,Code.IsCopy),fileName=Code.getName(fldObj,Code.Field.Upload.FileName);let argsv=Object.assign({},_arguments,{vv:ev});__append("\\n");__append(ScriptViewFile(argsv));__append("\\n");if(!IsEmpty(field.FileNameFld)){let fileNameField=GetFieldObject(table,field.FileNameFld),fileNameFldObj=Code.fldObj(fileNameField,table,control),fileNameCurrentValue=Code.getName(fileNameFldObj,Code.Field.CurrentValue);__append("\\nif (!EmptyValue(");__append(fileNameCurrentValue);__append(")) {\\n    ");if(ctrlId=="list"&&ctlid!="extbs"||ctrlId=="grid"){__append("\\n    if (");__append(rowIndex);__append(" == \'$rowindex$\') {\\n        ");__append(String(fileName).replace(/\\n/g,"\\n        "));__append(\' = "";\\n    } else {\\n        \');__append(String(fileName).replace(/\\n/g,"\\n        "));__append(" = ");__append(fileNameCurrentValue);__append(";\\n    }\\n    ")}else{__append("\\n    ");__append(String(fileName).replace(/\\n/g,"\\n    "));__append(" = ");__append(fileNameCurrentValue);__append(";\\n    ")}__append("\\n}\\n")}__append("\\n");if(ctrlId=="list"&&ctlid!="extbs"||ctrlId=="grid"){__append("\\nif (is_numeric(");__append(rowIndex);__append(")) {\\n    RenderUploadField(");__append(uploadObj);__append(", ");__append(rowIndex);__append(");\\n}\\n")}else if(ctrlId=="add"){__append("\\nif (");__append(isShow);__append(" || ");__append(isCopy);__append(") {\\n    RenderUploadField(");__append(uploadObj);__append(");\\n}\\n")}else if(["addopt","register","edit"].includes(ctrlId)){__append("\\nif (");__append(isShow);__append(") {\\n    RenderUploadField(");__append(uploadObj);__append(");\\n}\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditFile",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditFormat:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld,ev:ev}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,fldFmtType=field.FldFmtType,fldObj=Code.fldObj(field,table,control),defaultDecimalPrecision=Code.getName(fldObj,Code.Field.DefaultDecimalPrecision),fldNumDigits=PROJ.UseViewTagNumDigits?defaultDecimalPrecision:-2;if(IsFloatFormatField(field)){switch(fldFmtType){case"Currency":case"Number":return`FormatNumber(${ev}, ${fldNumDigits}, ${field.FldIncLeadDigit}, -2, ${field.FldGpDigits})`;break;default:return`FormatNumber(${ev}, -2, -1, -2, 0)`;break}}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditFormat",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditHidden:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),value="";if(ctrlId=="addopt"&&!IsEmpty(field.FldAutoUpdateValue)){value=field.FldAutoUpdateValue}else if(ctlid=="add"){if(!IsEmpty(field.FldDefault)){value=field.FldDefault}}else if(ctlid=="edit"){if(!IsEmpty(field.FldTagHiddenValue)){value=field.FldTagHiddenValue}}if(field.FldViewTag=="FORMATTED TEXT"&&field.FldFmtType=="Date/Time"){var fldDtFormat=field.FldDtFormat;if([0,1].includes(fldDtFormat)){fldDtFormat=8}if(value=="")value=cv;value=`FormatDateTime(${value}, ${fldDtFormat})`}if(value!=""){__append("\\n");__append(cv);__append(" = ");__append(value);__append(";\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditHidden",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditNo:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,ctrlId=control.CtrlID.toLowerCase();if(ctrlId!="info")cv=Code.htmlEncode(cv);__append("\\n");__append(ev);__append(" = ");__append(cv);__append(";");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditNo",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditPassword:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),fldCaption=Code.getName(fldObj,Code.Field.Caption),fldTitle=Code.getName(fldObj,Code.Field.Title),placeHolder=Code.getName(fldObj,Code.Field.PlaceHolder);if(ctrlId!="info")cv=Code.htmlEncode(cv);__append("\\n");if(ctlid=="edit"){__append("\\n");__append(ev);__append(" = ");__append(Code.languagePhrase("PasswordMask"));__append("; // Show as masked password\\n")}__append("\\n");if(UsePlaceHolder=="Caption"){__append("\\n");__append(placeHolder);__append(" = RemoveHtml(");__append(fldCaption);__append(");\\n")}else if(UsePlaceHolder=="Title"){__append("\\n");__append(placeHolder);__append(" = RemoveHtml(");__append(fldTitle);__append(");\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditPassword",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditRadio:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let field=fld||FIELD;if(field.FldSelectType=="Table"){return ScriptEditTable(_arguments)}else{return ScriptEditValues(_arguments)}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditRadio",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditRefer:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let field=fld||FIELD,table=tbl||TABLE,control=ctrl||CONTROL,fldObj=Code.fldObj(field,table,control),ctlid="edit",cv=Code.getName(fldObj,Code.Field.CurrentValue),ev=Code.getName(fldObj,Code.Field.EditValue);_arguments=Object.assign(_arguments,{cv:cv,ev:ev,ctlid:ctlid});__append("\\n");__append(ScriptReferCall(_arguments));let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditRefer",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditSelect:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let field=fld||FIELD;if(field.FldSelectType=="Table"){write(ScriptEditTable(_arguments))}else{write(ScriptEditValues(_arguments))}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditSelect",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditTable:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),ctrlType=control.CtrlType.toLowerCase(),fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),userID=["Both","Use Table"].includes(PROJ.SecType)&&!IsEmpty(DB.SecuUserIDFld),isTableUserIdFld=userID&&table.TblUserIDFld==field.FldName,tblVar=table.TblVar,linkTypeTable=FieldIsLinkTable(table,field,ctlid),isLinkTable=linkTypeTable&&["TEXT","SELECT","RADIO","CHECKBOX"].includes(field.FldHtmlTag),fldHtmlTag=field.FldHtmlTag,multiple=fldHtmlTag=="CHECKBOX"||fldHtmlTag=="SELECT"&&field.FldSelectMultiple,vv=Code.getName(fldObj,Code.Field.ViewValue),lookup=Code.getName(fldObj,Code.Field.Lookup),lookupGetSql=Code.getName(fldObj,Code.Field.LookupGetSql),lookupOptions=Code.getName(fldObj,Code.Field.LookupOptions),displayValue=Code.getName(fldObj,Code.Field.DisplayValue);if(field.FldModalLookup){if(fldHtmlTag=="SELECT")fldHtmlTag=field.FldSelectMultiple?"CHECKBOX":"RADIO";else if(!["RADIO","CHECKBOX"].includes(fldHtmlTag))fldHtmlTag="RADIO"}else if(field.FldDropdown){if(fldHtmlTag=="SELECT")fldHtmlTag=field.FldSelectMultiple?"CHECKBOX":"RADIO"}let fldDropdown=(field.FldDropdown||field.FldModalLookup)&&["RADIO","CHECKBOX"].includes(fldHtmlTag);if(["search","extbs"].includes(ctlid))vv=cv.endsWith("2")?Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.ViewValue2):Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.ViewValue);let prefix="HtmlEncode(",suffix=")";if(linkTypeTable){let dbId=GetDbId(field.FldTagLnkTbl),linkTable=GetTableObject(field.FldTagLnkTbl),linkDBID=linkTable.LinkDBID,fldSelectFilter=field.FldSelectFilter.trim(),lnkTblVar=linkTable.TblVar,formatDisplayFields=false;let dispField=GetFieldObject(linkTable,field.FldTagLnkDisplay),formatWrk1=ScriptViewFormat({fld:dispField,parm:"%fld%",islookup:true});if(IsEmpty(formatWrk1))formatWrk1="%fld%";else formatDisplayFields=true;let formatWrk2="%fld%";if(!IsEmpty(field.FldTagLnkDisp2)){dispField=GetFieldObject(linkTable,field.FldTagLnkDisp2);formatWrk2=ScriptViewFormat({fld:dispField,parm:"%fld%",islookup:true});if(IsEmpty(formatWrk2))formatWrk2="%fld%";else formatDisplayFields=true}let formatWrk3="%fld%";if(!IsEmpty(field.FldTagLnkDisp3)){dispField=GetFieldObject(linkTable,field.FldTagLnkDisp3);formatWrk3=ScriptViewFormat({fld:dispField,parm:"%fld%",islookup:true});if(IsEmpty(formatWrk3))formatWrk3="%fld%";else formatDisplayFields=true}let formatWrk4="%fld%";if(!IsEmpty(field.FldTagLnkDisp4)){dispField=GetFieldObject(linkTable,field.FldTagLnkDisp4);formatWrk4=ScriptViewFormat({fld:dispField,parm:"%fld%",islookup:true});if(IsEmpty(formatWrk4))formatWrk4="%fld%";else formatDisplayFields=true}let linkField=GetFieldObject(linkTable,field.FldTagLnkFld),lnkFldWhere=Code.quote(FieldSqlName(linkField,dbId));if(ctrlType=="report"){__append("\\n$curVal = ");__append(cv);__append(\' == INIT_VALUE ? "" : trim(strval(\');__append(cv);__append("));\\n")}else{__append("\\n$curVal = trim(strval(");__append(cv);__append("));\\n")}__append(\'\\nif ($curVal != "") {\\n    \');__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(Code.getName(fldObj,Code.Field.LookupCacheOption));__append("($curVal);\\n} else {\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(lookup);__append(" !== null && is_array(");__append(lookupOptions);__append(") ? $curVal : null;\\n}\\nif (");__append(vv);__append(" !== null) { // Load from cache\\n    ");__append(String(ev).replace(/\\n/g,"\\n    "));__append(" = array_values(");__append(lookupOptions);__append(");\\n");if(fldDropdown){__append("\\n    if (");__append(vv);__append(\' == "") {\\n        \');__append(String(vv).replace(/\\n/g,"\\n        "));__append(" = ");__append(Code.languagePhrase("PleaseSelect"));__append(";\\n    }\\n")}__append("\\n} else { // Lookup from database\\n");if(isLinkTable){__append(\'\\n    if ($curVal == "") {\\n        $filterWrk = "0=1";\\n    } else {\\n    \');if(field.FldHtmlTag=="SELECT"&&field.FldSelectMultiple||field.FldHtmlTag=="CHECKBOX"){__append(\'\\n        $arwrk = explode(",", $curVal);\\n        $filterWrk = "";\\n        foreach ($arwrk as $wrk) {\\n            if ($filterWrk != "") {\\n                $filterWrk .= " OR ";\\n            }\\n            $filterWrk .= "\');__append(lnkFldWhere);__append(\'" . SearchString("=", trim($wrk), \');__append(GetFieldTypeName(linkField.FldType));__append(\', "\');__append(Quote(linkDBID));__append(\'");\\n        }\\n    \')}else{__append(\'\\n        $filterWrk = "\');__append(lnkFldWhere);__append(\'" . SearchString("=", \');__append(cv);__append(", ");__append(GetFieldTypeName(linkField.FldType));__append(\', "\');__append(Quote(linkDBID));__append(\'");\\n    \')}__append("\\n    }\\n")}else{__append(\'\\n    $filterWrk = "";\\n\')}let connObj=linkDBID=="DB"||linkDBID==""?"Conn()":`Conn("${Quote(linkDBID)}")`;__append("\\n    ");if(fldSelectFilter!=""){__append("\\n    $lookupFilter = function() {\\n        return ");__append(fldSelectFilter);__append(";\\n    };\\n    $lookupFilter = $lookupFilter->bindTo($this);\\n    $sqlWrk = ");__append(lookupGetSql);__append("(true, $filterWrk, $lookupFilter, $this, false, true);\\n    ")}else{__append("\\n    $sqlWrk = ");__append(lookupGetSql);__append("(true, $filterWrk, \'\', $this, false, true);\\n    ")}__append("\\n    $rswrk = ");__append(connObj);__append("->executeQuery($sqlWrk)->fetchAll(\\\\PDO::FETCH_BOTH);\\n    $ari = count($rswrk);\\n");if(fldDropdown){__append("\\n    if ($ari > 0) { // Lookup values found\\n");if(multiple){__append("\\n        ");__append(String(vv).replace(/\\n/g,"\\n        "));__append(" = new OptionValues();\\n        foreach ($rswrk as $row) {\\n            $arwrk = ");__append(lookup);__append("->renderViewRow($row);\\n            ");__append(String(vv).replace(/\\n/g,"\\n            "));__append("->add(");__append(displayValue);__append("($arwrk));\\n            $ari++;\\n        }\\n")}else{__append("\\n        $arwrk = ");__append(lookup);__append("->renderViewRow($rswrk[0]);\\n        ");__append(String(vv).replace(/\\n/g,"\\n        "));__append(" = ");__append(displayValue);__append("($arwrk);\\n")}__append("\\n    } else {\\n        ");__append(String(vv).replace(/\\n/g,"\\n        "));__append(" = ");__append(Code.languagePhrase("PleaseSelect"));__append(";\\n    }\\n")}__append("\\n    $arwrk = $rswrk;\\n");if(formatDisplayFields){__append("\\n    foreach ($arwrk as &$row)\\n        $row = ");__append(lookup);__append("->renderViewRow($row);\\n")}__append("\\n    ");__append(String(ev).replace(/\\n/g,"\\n    "));__append(" = $arwrk;\\n}\\n")}let placeHolder=Code.getName(fldObj,Code.Field.PlaceHolder),fldCaption=Code.getName(fldObj,Code.Field.Caption),fldTitle=Code.getName(fldObj,Code.Field.Title);__append("\\n");if(UsePlaceHolder=="Caption"){__append("\\n");__append(placeHolder);__append(" = RemoveHtml(");__append(fldCaption);__append(");\\n")}else if(UsePlaceHolder=="Title"){__append("\\n");__append(placeHolder);__append(" = RemoveHtml(");__append(fldTitle);__append(");\\n")}__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditTable",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditText:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),encodePrefix="",encodeSuffix="";if(ctrlId!="info"){encodePrefix="HtmlEncode(";encodeSuffix=")"}if(GetFieldType(field.FldType)==3){__append("\\nif (!");__append(Code.getName(fldObj,Code.Field.Raw));__append(") {\\n    ");__append(String(cv).replace(/\\n/g,"\\n    "));__append(" = HtmlDecode(");__append(cv);__append(");\\n}\\n");__append(ev);__append(" = ");__append(encodePrefix);__append(cv);__append(encodeSuffix);__append(";\\n")}else if(!IsCrosstabYearField(table,field)&&GetFieldType(field.FldType)==2&&field.FldViewTag=="FORMATTED TEXT"&&field.FldFmtType=="Date/Time"){let fldDtFormat=field.FldDtFormat;if([0,1].includes(fldDtFormat))fldDtFormat=8;__append("\\n");__append(ev);__append(" = ");__append(encodePrefix);__append("FormatDateTime(");__append(cv);__append(", ");__append(fldDtFormat);__append(")");__append(encodeSuffix);__append(";\\n")}else if(field.FldFmtType=="Date/Time"&&field.FldDtFormat==4){__append("\\n");__append(ev);__append(" = ");__append(encodePrefix);__append("FormatDateTime(");__append(cv);__append(", 4)");__append(encodeSuffix);__append(";\\n")}else{__append("\\n");__append(ev);__append(" = ");__append(encodePrefix);__append(cv);__append(encodeSuffix);__append(";\\n")}if(ctlid=="edit"&&DB.UseDynamicUserLevel&&table.TblName==DB.UserLevelTbl&&field.FldName==DB.UserLevelNameFld){let userLevelIdField=GetFieldObject(table,DB.UserLevelIdFld),userLevelIdFldObj=Code.fldObj(userLevelIdField,table,control);__append("\\nif (in_array(");__append(Code.getName(userLevelIdFldObj,Code.Field.CurrentValue));__append(", [-2, -1, 0])) {\\n    ");__append(String(Code.getName(fldObj,Code.Field.ReadOnly)).replace(/\\n/g,"\\n    "));__append(" = true;\\n}\\n")}let virtualFld=IsVirtualLookupField(field),virtualSearch=["extbs","search"].includes(ctlid)&&virtualFld,forceSelect=field.FldSelectForceSelection&&!virtualSearch,argsv=Object.assign({},_arguments,{vv:ev,isedit:true}),placeHolder=Code.getName(fldObj,Code.Field.PlaceHolder),fldCaption=Code.getName(fldObj,Code.Field.Caption),fldTitle=Code.getName(fldObj,Code.Field.Title);__append("\\n");if((!virtualFld||virtualFld&&forceSelect)&&FieldIsLinkTable(table,field,ctlid)){__append("\\n");__append(ScriptViewTable(argsv));__append("\\n")}__append("\\n");if(UsePlaceHolder=="Caption"){__append("\\n");__append(placeHolder);__append(" = RemoveHtml(");__append(fldCaption);__append(");\\n")}else if(UsePlaceHolder=="Title"){__append("\\n");__append(placeHolder);__append(" = RemoveHtml(");__append(fldTitle);__append(");\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditText",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditTextarea:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),placeHolder=Code.getName(fldObj,Code.Field.PlaceHolder),fldCaption=Code.getName(fldObj,Code.Field.Caption),fldTitle=Code.getName(fldObj,Code.Field.Title),encodePrefix="",encodeSuffix="";if(ctrlId!="info"){encodePrefix="HtmlEncode(";encodeSuffix=")"}__append("\\n");__append(ev);__append(" = ");__append(encodePrefix);__append(cv);__append(encodeSuffix);__append(";\\n");if(UsePlaceHolder=="Caption"){__append("\\n");__append(placeHolder);__append(" = RemoveHtml(");__append(fldCaption);__append(");\\n")}else if(UsePlaceHolder=="Title"){__append("\\n");__append(placeHolder);__append(" = RemoveHtml(");__append(fldTitle);__append(");\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditTextarea",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditUserId:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,userid:userid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldName=field.FldName,fldObj=Code.fldObj(field,table,control),vv=Code.getName(fldObj,Code.Field.ViewValue),lookup=Code.getName(fldObj,Code.Field.Lookup),displayValue=Code.getName(fldObj,Code.Field.DisplayValue),fldTagLnkTbl,fldTagLnkFld,fldTagLnkDisplay,fldTagLnkDisp2,fldTagLnkDisp3,fldTagLnkDisp4,linkTypeTable;if(field.FldSelectType=="Table"&&!IsEmpty(field.FldTagLnkTbl)&&!IsEmpty(field.FldTagLnkFld)&&!IsEmpty(field.FldTagLnkDisplay)){fldTagLnkTbl=field.FldTagLnkTbl;fldTagLnkFld=field.FldTagLnkFld;fldTagLnkDisplay=field.FldTagLnkDisplay;fldTagLnkDisp2=field.FldTagLnkDisp2;fldTagLnkDisp3=field.FldTagLnkDisp3;fldTagLnkDisp4=field.FldTagLnkDisp4;linkTypeTable=FieldIsLinkTable(table,field,ctlid)}else{fldTagLnkTbl=PROJ.SecTbl;fldTagLnkFld=DB.SecuUserIDFld;fldTagLnkDisplay=DB.SecuUserIDFld;fldTagLnkDisp2="";fldTagLnkDisp3="";fldTagLnkDisp4="";linkTypeTable=field.FldGenerate&&field.FldSelectType=="Table"&&IsFieldGenerate(table,field,ctlid)}let isLinkTable=linkTypeTable&&["TEXT","SELECT","RADIO","CHECKBOX"].includes(field.FldHtmlTag),fldDropdown=(field.FldDropdown||field.FldModalLookup)&&["RADIO","CHECKBOX"].includes(field.FldHtmlTag);if(["search","extbs"].includes(ctlid)){vv=cv.endsWith("2")?Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.ViewValue2):Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.ViewValue)}let prefix="HtmlEncode(",suffix=")",linkField,isLnkUserIDFld;if(linkTypeTable){let dbId=GetDbId(fldTagLnkTbl),linkTable=GetTableObject(fldTagLnkTbl),linkDBID=linkTable.LinkDBID,linkTblVar=linkTable.TblVar,formatDisplayFields=false,fldSelectFilter=field.FldSelectFilter.trim();let dispField=GetFieldObject(linkTable,fldTagLnkDisplay),formatWrk1=ScriptViewFormat({fld:dispField,parm:"%fld%",islookup:true});if(IsEmpty(formatWrk1))formatWrk1="%fld%";else formatDisplayFields=true;let formatWrk2="%fld%";if(!IsEmpty(fldTagLnkDisp2)){dispField=GetFieldObject(linkTable,fldTagLnkDisp2);formatWrk2=ScriptViewFormat({fld:dispField,parm:"%fld%",islookup:true});if(IsEmpty(formatWrk2))formatWrk2="%fld%";else formatDisplayFields=true}let formatWrk3="%fld%";if(!IsEmpty(fldTagLnkDisp3)){dispField=GetFieldObject(linkTable,fldTagLnkDisp3);formatWrk3=ScriptViewFormat({fld:dispField,parm:"%fld%",islookup:true});if(IsEmpty(formatWrk3))formatWrk3="%fld%";else formatDisplayFields=true}let formatWrk4="%fld%";if(!IsEmpty(fldTagLnkDisp4)){dispField=GetFieldObject(linkTable,fldTagLnkDisp4);formatWrk4=ScriptViewFormat({fld:dispField,parm:"%fld%",islookup:true});if(IsEmpty(formatWrk4))formatWrk4="%fld%";else formatDisplayFields=true}isLnkUserIDFld=!IsEmpty(linkTable.TblUserIDFld);let linkField=GetFieldObject(linkTable,fldTagLnkFld),lnkFldWhere=Code.quote(FieldSqlName(linkField,dbId));if(isLinkTable){__append("\\nif (trim(strval(");__append(cv);__append(\')) == "") {\\n    $filterWrk = "0=1";\\n} else {\\n    \');if(field.FldHtmlTag=="SELECT"&&field.FldSelectMultiple||field.FldHtmlTag=="CHECKBOX"){__append(\'\\n    $arwrk = explode(",", \');__append(cv);__append(\');\\n    $filterWrk = "";\\n    foreach ($arwrk as $wrk) {\\n        if ($filterWrk != "")\\n            $filterWrk .= " OR ";\\n        $filterWrk .= "\');__append(lnkFldWhere);__append(\'" . SearchString("=", trim($wrk), \');__append(GetFieldTypeName(linkField.FldType));__append(\', "\');__append(Quote(linkDBID));__append(\'");\\n    }\\n    \')}else{__append(\'\\n    $filterWrk = "\');__append(lnkFldWhere);__append(\'" . SearchString("=", \');__append(cv);__append(", ");__append(GetFieldTypeName(linkField.FldType));__append(\', "\');__append(Quote(linkDBID));__append(\'");\\n    \')}__append("\\n}\\n")}else{__append(\'\\n$filterWrk = "";\\n\')}let userTable=HasUserTable();if(userTable&&fldTagLnkTbl==PROJ.SecTbl){if(isLnkUserIDFld){if(userid!=""){userid=ctlid=="add"?`""`:userid;__append(\'\\nAddFilter($filterWrk, Container("\');__append(linkTblVar);__append(\'")->addParentUserIDFilter(\');__append(userid);__append("));\\n")}else{__append(\'\\nAddFilter($filterWrk, Container("\');__append(linkTblVar);__append(\'")->addUserIDFilter());\\n\')}}}let connObj=linkDBID=="DB"||linkDBID==""?"Conn()":`Conn("${Quote(linkDBID)}")`;let lookupGetSql=Code.getName(fldObj,Code.Field.LookupGetSql);__append("\\n    ");if(fldSelectFilter!=""){__append("\\n$lookupFilter = function() {\\n    return ");__append(fldSelectFilter);__append(";\\n};\\n$lookupFilter = $lookupFilter->bindTo($this);\\n$sqlWrk = ");__append(lookupGetSql);__append("(true, $filterWrk, $lookupFilter, $this, false, true);\\n    ")}else{__append("\\n$sqlWrk = ");__append(lookupGetSql);__append("(true, $filterWrk, \'\', $this, false, true);\\n    ")}__append("\\n$rswrk = ");__append(connObj);__append("->executeQuery($sqlWrk)->fetchAll(\\\\PDO::FETCH_BOTH);\\n\\n");let fldHtmlTag=field.FldHtmlTag,virtualFld=IsVirtualLookupField(field),virtualSearch=["extbs","search"].includes(ctlid)&&virtualFld,forceSelect=field.FldSelectForceSelection&&!virtualSearch;__append("\\n\\n");if(fldDropdown||fldHtmlTag=="TEXT"&&forceSelect){__append("\\nif (count($rswrk) > 0) { // Lookup values found\\n    $arwrk = ");__append(lookup);__append("->renderViewRow($rswrk[0]);\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(displayValue);__append("($arwrk);\\n} else {\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(Code.languagePhrase("PleaseSelect"));__append(";\\n}\\n")}__append("\\n$arwrk = $rswrk;\\n");if(formatDisplayFields){__append("\\nforeach ($arwrk as &$row)\\n    $row = ");__append(lookup);__append("->renderViewRow($row);\\n")}__append("\\n\\n");if(fldHtmlTag=="TEXT"&&forceSelect){__append("\\n");__append(ev);__append(" = ");__append(vv);__append(";\\n")}else{__append("\\n");__append(ev);__append(" = $arwrk;\\n")}__append("\\n\\n")}__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditUserId",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptEditValues:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,ev:ev,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,fldObj=Code.fldObj(field,table,control),fldOptions=Code.getName(fldObj,Code.Field.Options),pleaseSelect=!field.FldSelectMultiple&&field.FldHtmlTag=="SELECT",tagValues=FieldTagValues(field).trim();if(!IsEmpty(tagValues)){__append("\\n");__append(ev);__append(" = ");__append(fldOptions);__append("(");__append(Code.bool(pleaseSelect));__append(");\\n")}let placeHolder=Code.getName(fldObj,Code.Field.PlaceHolder),fldCaption=Code.getName(fldObj,Code.Field.Caption),fldTitle=Code.getName(fldObj,Code.Field.Title);__append("\\n");if(UsePlaceHolder=="Caption"){__append("\\n");__append(placeHolder);__append(" = RemoveHtml(");__append(fldCaption);__append(");\\n")}else if(UsePlaceHolder=="Title"){__append("\\n");__append(placeHolder);__append(" = RemoveHtml(");__append(fldTitle);__append(");\\n")}__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptEditValues",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptGroupSummaryView:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),gvv=Code.getName(fldObj,"GroupViewValue"),gv=Code.getName(fldObj,"groupValue()");_arguments=Object.assign(_arguments,{cv:gv,vv:gvv,dtl:false});__append("\\n");__append(ScriptViewCall(_arguments));let __args={arguments:arguments[0],code:__output};Events.emit("ScriptGroupSummaryView",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptGroupView:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),gv=Code.getName(fldObj,"groupValue()"),gvv=Code.getName(fldObj,"GroupViewValue");_arguments=Object.assign(_arguments,{cv:gv,vv:gvv,dtl:true});__append("\\n");__append(ScriptViewCall(_arguments));let __args={arguments:arguments[0],code:__output};Events.emit("ScriptGroupView",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptInsert:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{};_arguments=Object.assign(_arguments,{ctlid:"insert"});return Script(_arguments);let __args={arguments:arguments[0],code:__output};Events.emit("ScriptInsert",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptReferCall:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),tblVar=table.TblVar,fldParm=field.FldParm,fldVar=field.FldVar,fldObj=Code.fldObj(field,table,control),tv=Code.getName(fldObj,Code.Field.TooltipValue),tw=Code.getName(fldObj,Code.Field.TooltipWidth),hv=Code.getName(fldObj,Code.Field.HrefValue),linkAttrs=Code.getName(fldObj,Code.Field.LinkAttrs),fldLinkCustomAttributes=field.FldTagACustomAttributes;if(["list","grid"].includes(ctrlId))fldVar=RowCountVarQuoted(fldVar);if(IsEmpty(fldLinkCustomAttributes))fldLinkCustomAttributes=`""`;__append("\\n");__append(Code.getName(fldObj,Code.Field.LinkCustomAttributes));__append(" = ");__append(fldLinkCustomAttributes);__append(";\\n");__append("\\n");__append(ScriptViewHref(_arguments));__append("\\n");if(ctlid=="view"||ctlid=="edit"&&field.FldHtmlTagReadOnly){let fldTooltipFld=field.FldTooltipFld;if(!IsEmpty(fldTooltipFld)){let tooltipField=GetFieldObject(table,fldTooltipFld),tooltipFldObj=Code.fldObj(tooltipField,table,control),tooltipCurrentValue=Code.getName(tooltipFldObj,Code.Field.CurrentValue),tooltipViewValue=Code.getName(tooltipFldObj,Code.Field.ViewValue);__append("\\nif (!$this->isExport()) {\\n");if(tooltipField.FldHtmlTag=="TEXTAREA"){__append("\\n    ");__append(String(tv).replace(/\\n/g,"\\n    "));__append(" = strval(");__append(tooltipCurrentValue);__append(");\\n");if(tooltipField.FldMemoCRLFReplace){__append("\\n    ");__append(String(tv).replace(/\\n/g,"\\n    "));__append(\' = str_replace("\\\\n", "<br>", \');__append(tv);__append(");\\n")}}else if(tooltipField.FldHtmlTag=="FILE"){__append("\\n    ");__append(String(tv).replace(/\\n/g,"\\n    "));__append(" = ");__append(tooltipViewValue);__append(";\\n")}else{__append("\\n    ");__append(String(tv).replace(/\\n/g,"\\n    "));__append(" = ");__append(tooltipViewValue);__append(\' != "" ? \');__append(tooltipViewValue);__append(" : ");__append(tooltipCurrentValue);__append(";\\n")}let tooltipWidth=field.FldTooltipWidth;if(tooltipWidth=="")tooltipWidth=0;if(tooltipWidth>0){__append("\\n    ");__append(String(tw).replace(/\\n/g,"\\n    "));__append(" = ");__append(tooltipWidth);__append(";\\n")}__append("\\n    if (");__append(hv);__append(\' == "") {\\n        \');__append(String(hv).replace(/\\n/g,"\\n        "));__append(\' = "javascript:void(0);";\\n    }\\n    \');__append(String(linkAttrs).replace(/\\n/g,"\\n    "));__append(\'->appendClass("ew-tooltip-link");\\n\');if(ctrlId=="info"){__append("\\n    ");__append(String(linkAttrs).replace(/\\n/g,"\\n    "));__append(\'["data-tooltip-id"] = "tt_\');__append(tblVar);__append("_");__append(fldVar.substr(0,1));__append(\'" . (($this->RowType != ROWTYPE_MASTER) ? @$this->RowCount : "") . "\');__append(fldVar.substr(1));__append(\'";\\n\')}else{__append("\\n    ");__append(String(linkAttrs).replace(/\\n/g,"\\n    "));__append(\'["data-tooltip-id"] = "tt_\');__append(tblVar);__append("_");__append(fldVar);__append(\'";\\n\')}__append("\\n    ");__append(String(linkAttrs).replace(/\\n/g,"\\n    "));__append(\'["data-tooltip-width"] = \');__append(tw);__append(";\\n    ");__append(String(linkAttrs).replace(/\\n/g,"\\n    "));__append(\'["data-placement"] = Config("CSS_FLIP") ? "left" : "right";\\n}\\n\')}else{__append("\\n");__append(tv);__append(\' = "";\\n\')}if(field.FldHtmlTag=="FILE"&&field.FldViewTag=="IMAGE"){let fldHrefFld=field.FldHrefFld,useColorbox=true;if(fldHrefFld!=""){let hrefField=GetFieldObject(table,fldHrefFld);useColorbox=IsBinaryField(hrefField)||hrefField.FldViewTag=="IMAGE"}if(useColorbox){__append("\\nif (");__append(Code.getName(fldObj,Code.Field.UseColorbox));__append(") {\\n    if (EmptyValue(");__append(tv);__append(")) {\\n        ");__append(String(linkAttrs).replace(/\\n/g,"\\n        "));__append(\'["title"] = \');__append(Code.languagePhrase("ViewImageGallery"));__append(";\\n    }\\n    ");__append(String(linkAttrs).replace(/\\n/g,"\\n    "));__append(\'["data-rel"] = "\');__append(tblVar);__append("_");__append(fldVar);__append(\'";\\n    \');__append(String(linkAttrs).replace(/\\n/g,"\\n    "));__append(\'->appendClass("ew-lightbox");\\n}\\n\')}}if(["list","grid"].includes(ctrlId)&&table.TblSearchHighlight&&(IsEmpty(field.FldFmtType)||field.FldFmtType=="None")&&([1,2,3].includes(GetFieldType(field.FldType))&&["NO","TEXT","TEXTAREA"].includes(field.FldHtmlTag)||IsVirtualLookupField(field)&&(field.FldBasicSearch||field.FldVirtualLookupSearch||field.FldHtmlTag=="TEXT"))){let highlightWrk=ScriptViewHighlightSearch(_arguments);__append("\\n");__append(highlightWrk);__append("\\n")}}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptReferCall",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptSearch:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),ctlid=ctrlId=="list"?"extbs":"search",fldObj=Code.fldObj(field,table,control),cv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchValue),ev=Code.getName(fldObj,Code.Field.EditValue);if(!IsCrosstabYearField(table,field)&&[2,7].includes(GetFieldType(field.FldType))&&!(["summary","crosstab"].includes(table.TblReportType)&&IsDateFilter(field))){cv=`UnFormatDateTime(${cv}, ${field.FldDtFormat})`}_arguments=Object.assign(_arguments,{cv:cv,ev:ev,ctlid:ctlid});__append("\\n");__append(ScriptEditCall(_arguments));let __args={arguments:arguments[0],code:__output};Events.emit("ScriptSearch",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptSearch2:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),ctlid=ctrlId=="list"?"extbs":"search",fldObj=Code.fldObj(field,table,control),cv=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchValue2),ev=Code.getName(fldObj,Code.Field.EditValue2);if(!IsCrosstabYearField(table,field)&&[2,7].includes(GetFieldType(field.FldType))){cv=`UnFormatDateTime(${cv}, ${field.FldDtFormat})`}_arguments=Object.assign(_arguments,{cv:cv,ev:ev,ctlid:ctlid});__append("\\n");__append(ScriptEditCall(_arguments));let __args={arguments:arguments[0],code:__output};Events.emit("ScriptSearch2",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptSummaryView:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{id:id,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),cv=Code.getName(fldObj,SummaryValueName(id)),vv=Code.getName(fldObj,SummaryViewValueName(id));let fldFmtType=field.FldFmtType;let fldNumDigits=field.FldNumDigits;if(id.toLowerCase()=="cnt"){field.FldFmtType="Number";field.FldNumDigits=0}_arguments=Object.assign(_arguments,{cv:cv,vv:vv,tbl:table,fld:field,dtl:false});__append("\\n");__append(ScriptViewCall(_arguments));__append("\\n");if(id.toLowerCase()=="cnt"){field.FldFmtType=fldFmtType;field.FldNumDigits=fldNumDigits}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptSummaryView",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptSummaryViewRefer:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let table=tbl||TABLE,field=fld||FIELD,control=ctrl||CONTROL,fldParm=field.FldParm,fldObj=Code.fldObj(field,table,control),ctlid="view",cv=Code.getName(fldObj,Code.Field.CurrentValue),vv=Code.getName(fldObj,Code.Field.ViewValue);_arguments=Object.assign(_arguments,{cv:cv,vv:vv,ctlid:ctlid});__append("\\n");__append(ScriptViewHref(_arguments));__append("\\n");if(IsFieldDrillDown(field)){let isSecurityEnabled=PROJ.SecType&&PROJ.SecType!="None",checkDrillDownTable=isSecurityEnabled?` && AllowList(PROJECT_ID . $${fldObj}->DrillDownTable)`:"";__append("\\nif (!$this->isExport()");__append(checkDrillDownTable);__append(") {\\n    $drillurl = $");__append(fldObj);__append("->DrillDownUrl;\\n");let drillTable=GetTableObject(field.FldDrillTable),drillTblVar=drillTable.TblVar,drillSourceFields=field.FldDrillSourceFields.trim().replace(/\\|\\|$/,""),arSourceFlds=drillSourceFields.split("||"),drillTargetFields=field.FldDrillTargetFields.trim().replace(/\\|\\|$/,""),arTargetFlds=drillTargetFields.split("||"),filterParm="";if(arSourceFlds.length==arTargetFlds.length){let j=0,mapSourceTarget=ArrayCombine(arSourceFlds,arTargetFlds);for(let[sourceFld,targetFld]of mapSourceTarget.entries()){let sourceField=GetFieldObject(table,sourceFld),sourceFldParm=sourceField.FldParm,sourceFldObj=field.FldParm==sourceFldParm?fldObj:"this->"+sourceFldParm,targetField=GetFieldObject(drillTable,targetFld),targetFldParm=targetField.FldParm;let isNotGroupField=table.TblReportType=="crosstab"&&field.FldRowID==0||table.TblReportType!="crosstab"&&field.FldGroupBy==0;let sourceIsGroupField=table.TblReportType=="crosstab"&&sourceField.FldRowID>0||table.TblReportType!="crosstab"&&sourceField.FldGroupBy>0;let sourceIsFirstGroupField=table.TblReportType=="crosstab"&&sourceField.FldRowID==1||table.TblReportType!="crosstab"&&sourceField.FldGroupBy==1;let sourceIsDetailGroup=table.TblReportType=="crosstab"&&field.FldRowID>0&&field.FldRowID<sourceField.FldRowID||table.TblReportType!="crosstab"&&field.FldGroupBy>0&&field.FldGroupBy<sourceField.FldGroupBy;if(isNotGroupField||sourceIsDetailGroup)filterParm=", -1";else filterParm="";let sourceGroupId=table.TblReportType=="crosstab"?sourceField.FldRowID:sourceField.FldGroupBy;__append("\\n");if(isNotGroupField&&sourceIsGroupField){__append("\\n    ");if(sourceIsFirstGroupField){__append(\'\\n    $drillurl = str_replace("=f\');__append(j);__append(\'", "=" . Encrypt($this->getDrillDownSql($\');__append(sourceFldObj);__append(\', "\');__append(targetFldParm);__append(\'", $this->RowTotalType)), $drillurl);\\n    \')}else{__append("\\n    $parm = ($this->RowTotalType == ROWTOTAL_GROUP && $this->RowGroupLevel >= ");__append(sourceGroupId);__append(\') ? 0 : -1;\\n    $drillurl = str_replace("=f\');__append(j);__append(\'", "=" . Encrypt($this->getDrillDownSql($\');__append(sourceFldObj);__append(\', "\');__append(targetFldParm);__append(\'", $this->RowTotalType, $parm)), $drillurl);\\n    \')}__append("\\n")}else{__append(\'\\n    $drillurl = str_replace("=f\');__append(j);__append(\'", "=" . Encrypt($this->getDrillDownSql($\');__append(sourceFldObj);__append(\', "\');__append(targetFldParm);__append(\'", $this->RowTotalType\');__append(filterParm);__append(")), $drillurl);\\n")}__append("\\n");j++}}__append("\\n    $");__append(fldObj);__append(\'->LinkAttrs["title"] = JsEncodeAttribute($GLOBALS["Language"]->phrase("ClickToDrillDown"));\\n    $\');__append(fldObj);__append(\'->LinkAttrs["class"] = "ew-drill-link";\\n    $\');__append(fldObj);__append(\'->LinkAttrs["onclick"] = DrillDownScript($drillurl, \\\'\');__append(tblVar);__append("_");__append(fldParm);__append("\', $GLOBALS[\\"Language\\"]->tablePhrase(\'");__append(drillTblVar);__append("\', \'TblCaption\'), $this->UseDrillDownPanel);\\n    $");__append(fldObj);__append(\'->LinkAttrs["data-drilldown-placement"] = "bottom";\\n    if ($\');__append(fldObj);__append(\'->HrefValue == "") {\\n        $\');__append(fldObj);__append(\'->HrefValue = "#";\\n    }\\n}\\n\')}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptSummaryViewRefer",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptUpdate:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{};_arguments=Object.assign(_arguments,{ctlid:"update"});return Script(_arguments);let __args={arguments:arguments[0],code:__output};Events.emit("ScriptUpdate",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptUpdateFile:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldName=field.FldName,fldObj=Code.fldObj(field,table,control),updateCheck="",dbValue=Code.getName(fldObj,Code.Field.Upload.DbValue),imageWidth=Code.getName(fldObj,Code.Field.ImageWidth),imageHeight=Code.getName(fldObj,Code.Field.ImageHeight),fileName=Code.getName(fldObj,Code.Field.Upload.FileName),index=Code.getName(fldObj,Code.Field.Upload.Index),visible=Code.getName(fldObj,Code.Field.Visible),keepFile=Code.getName(fldObj,Code.Field.Upload.KeepFile),uploadResizeAndSaveToFile=Code.getName(fldObj,Code.Field.Upload.ResizeAndSaveToFile),uploadSaveToFile=Code.getName(fldObj,Code.Field.Upload.SaveToFile);if(ctrlId=="update")updateCheck=" && $this->UpdateCount == 1";if(!IsBinaryField(field)){__append("\\nif (");__append(visible);__append(" && !");__append(keepFile);__append(") {\\n    ");if(!field.FldUploadMultiple){__append("\\n    $oldFiles = EmptyValue(");__append(dbValue);__append(") ? [] : [");__append(Code.getName(fldObj,Code.Field.HtmlDecode));__append("(");__append(dbValue);__append(")];\\n    ")}else{__append("\\n    $oldFiles = EmptyValue(");__append(dbValue);__append(\') ? [] : explode(Config("MULTIPLE_UPLOAD_SEPARATOR"), \');__append(Code.getName(fldObj,Code.Field.HtmlDecode));__append("(strval(");__append(dbValue);__append(")));\\n    ")}__append("\\n    if (!EmptyValue(");__append(fileName);__append(")");__append(updateCheck);__append(") {\\n    ");if(!field.FldUploadMultiple){__append("\\n        $newFiles = [");__append(fileName);__append("];\\n        $newFiles2 = [");__append(Code.getName(fldObj,Code.Field.HtmlDecode));__append("($rsnew[\'");__append(SingleQuote(field.FldName));__append("\'])];\\n    ")}else{__append(\'\\n        $newFiles = explode(Config("MULTIPLE_UPLOAD_SEPARATOR"), \');__append(fileName);__append(\');\\n        $newFiles2 = explode(Config("MULTIPLE_UPLOAD_SEPARATOR"), \');__append(Code.getName(fldObj,Code.Field.HtmlDecode));__append("($rsnew[\'");__append(SingleQuote(field.FldName));__append("\']));\\n    ")}__append(\'\\n        $newFileCount = count($newFiles);\\n        for ($i = 0; $i < $newFileCount; $i++) {\\n            if ($newFiles[$i] != "") {\\n                $file = UploadTempPath(\');__append(Code.getName(fldObj));__append(", ");__append(index);__append(\') . $newFiles[$i];\\n                if (file_exists($file)) {\\n                    if (@$newFiles2[$i] != "") { // Use correct file name\\n                        $newFiles[$i] = $newFiles2[$i];\\n                    }\\n    \');if(field.FldUploadResize){__append("\\n                    if (!");__append(uploadResizeAndSaveToFile);__append("(");__append(imageWidth);__append(", ");__append(imageHeight);__append(", 100, $newFiles[$i], true, $i)) {\\n    ")}else{__append("\\n                    if (!");__append(uploadSaveToFile);__append("($newFiles[$i], true, $i)) { // Just replace\\n    ")}__append("\\n                        $this->setFailureMessage(");__append(Code.languagePhrase("UploadErrMsg7"));__append(\');\\n                        return false;\\n                    }\\n                }\\n            }\\n        }\\n    } else {\\n        $newFiles = [];\\n    }\\n    if (Config("DELETE_UPLOADED_FILES")) {\\n        foreach ($oldFiles as $oldFile) {\\n            if ($oldFile != "" && !in_array($oldFile, $newFiles)) {\\n                @unlink(\');__append(Code.getName(fldObj,Code.Field.OldPhysicalUploadPath));__append(" . $oldFile);\\n            }\\n        }\\n    }\\n}\\n")}__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptUpdateFile",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptUpdateFileData:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{ctlid:ctlid,tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldName=field.FldName,fldObj=Code.fldObj(field,table,control),updateCheck="",currentValue=Code.getName(fldObj,Code.Field.CurrentValue),multiUpdate=Code.getName(fldObj,Code.Field.MultiUpdate),fldObject=Code.getName(fldObj),uploadPath=Code.getName(fldObj,Code.Field.UploadPath),dbValue=Code.getName(fldObj,Code.Field.Upload.DbValue),fileName=Code.getName(fldObj,Code.Field.Upload.FileName),index=Code.getName(fldObj,Code.Field.Upload.Index),visible=Code.getName(fldObj,Code.Field.Visible),keepFile=Code.getName(fldObj,Code.Field.Upload.KeepFile),setDbValueDef=Code.getName(fldObj,Code.Field.SetDbValueDef);if(ctrlId=="update")updateCheck=" && $this->UpdateCount == 1";if(!IsBinaryField(field)){let defaultValue=Code.null,nullable=(field.FldAttribute&32)==32;if(!nullable)defaultValue=`""`;let skipUpdate=Code.false;if(!IsEmpty(field.FldDbDefault)&&ctlid=="insert"){skipUpdate=`strval(${currentValue}) == ""`}else if(ctlid=="update"){skipUpdate=Code.getName(fldObj,Code.Field.ReadOnly);if(ctrlId=="update")skipUpdate+=` || ${multiUpdate} != "1"`}__append("\\nif (");__append(visible);__append(" && !");__append(keepFile);__append(") {\\n    ");if(!IsEmpty(field.FldUploadPath)){__append("\\n    ");__append(String(uploadPath).replace(/\\n/g,"\\n    "));__append(" = ");__append(field.FldUploadPath);__append(";\\n    ")}__append("\\n    ");if(!field.FldUploadMultiple){__append("\\n    $oldFiles = EmptyValue(");__append(dbValue);__append(") ? [] : [");__append(Code.getName(fldObj,Code.Field.HtmlDecode));__append("(");__append(dbValue);__append(")];\\n    ")}else{__append("\\n    $oldFiles = EmptyValue(");__append(dbValue);__append(\') ? [] : explode(Config("MULTIPLE_UPLOAD_SEPARATOR"), \');__append(Code.getName(fldObj,Code.Field.HtmlDecode));__append("(strval(");__append(dbValue);__append(")));\\n    ")}__append("\\n    if (!EmptyValue(");__append(fileName);__append(")");__append(updateCheck);__append(") {\\n    ");if(!field.FldUploadMultiple){__append("\\n        $newFiles = [");__append(fileName);__append("];\\n    ")}else{__append(\'\\n        $newFiles = explode(Config("MULTIPLE_UPLOAD_SEPARATOR"), strval(\');__append(fileName);__append("));\\n    ")}__append(\'\\n        $NewFileCount = count($newFiles);\\n        for ($i = 0; $i < $NewFileCount; $i++) {\\n            if ($newFiles[$i] != "") {\\n                $file = $newFiles[$i];\\n                $tempPath = UploadTempPath(\');__append(fldObject);__append(", ");__append(index);__append(\');\\n                if (file_exists($tempPath . $file)) {\\n                    if (Config("DELETE_UPLOADED_FILES")) {\\n                        $oldFileFound = false;\\n                        $oldFileCount = count($oldFiles);\\n                        for ($j = 0; $j < $oldFileCount; $j++) {\\n                            $oldFile = $oldFiles[$j];\\n                            if ($oldFile == $file) { // Old file found, no need to delete anymore\\n                                array_splice($oldFiles, $j, 1);\\n                                $oldFileFound = true;\\n                                break;\\n                            }\\n                        }\\n                        if ($oldFileFound) { // No need to check if file exists further\\n                            continue;\\n                        }\\n                    }\\n                    $file1 = UniqueFilename(\');__append(Code.getName(fldObj,Code.Field.PhysicalUploadPath));__append(", $file); // Get new file name\\n                    if ($file1 != $file) { // Rename temp file\\n                        while (file_exists($tempPath . $file1) || file_exists(");__append(Code.getName(fldObj,Code.Field.PhysicalUploadPath));__append(" . $file1)) { // Make sure no file name clash\\n                            $file1 = UniqueFilename([");__append(Code.getName(fldObj,Code.Field.PhysicalUploadPath));__append(", $tempPath], $file1, true); // Use indexed name\\n                        }\\n                        rename($tempPath . $file, $tempPath . $file1);\\n                        $newFiles[$i] = $file1;\\n                    }\\n                }\\n            }\\n        }\\n        ");__append(String(dbValue).replace(/\\n/g,"\\n        "));__append(\' = empty($oldFiles) ? "" : implode(Config("MULTIPLE_UPLOAD_SEPARATOR"), $oldFiles);\\n        \');__append(String(fileName).replace(/\\n/g,"\\n        "));__append(\' = implode(Config("MULTIPLE_UPLOAD_SEPARATOR"), $newFiles);\\n        \');__append(String(setDbValueDef).replace(/\\n/g,"\\n        "));__append("($rsnew, ");__append(fileName);__append(", ");__append(defaultValue);__append(", ");__append(skipUpdate);__append(");\\n    }\\n}\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptUpdateFileData",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptUpdateSpecial:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldName=field.FldName,fldObj=Code.fldObj(field,table,control),cv=Code.getName(fldObj,Code.Field.CurrentValue),sv=Code.getName(fldObj,Code.Field.SessionValue),userTable=HasUserTable(),userID=userTable&&!IsEmpty(DB.SecuUserIDFld),tableHasUserIDFld=userID&&!IsEmpty(table.TblUserIDFld),parentUserID=tableHasUserIDFld&&!IsEmpty(DB.SecuParentUserIDFld);let firstCond=true,condStr;if(IsDetailKeyField(table,field)&&!["search","addopt"].includes(ctrlId)){condStr=firstCond?"if":"} elseif";firstCond=false;__append("\\n");__append(condStr);__append(" (");__append(sv);__append(\' != "") {\\n    $rsnew[\\\'\');__append(SingleQuote(fldName));__append("\'] = ");__append(sv);__append(";\\n")}if(parentUserID&&table.TblName==PROJ.SecTbl&&field.FldName==DB.SecuParentUserIDFld&&ctrlId!="register"){condStr=firstCond?"if":"} elseif";firstCond=false;__append("\\n");__append(condStr);__append(" (!$Security->isAdmin() && $Security->isLoggedIn()) { // Non system admin\\n    $rsnew[\'");__append(SingleQuote(fldName));__append("\'] = CurrentUserID();\\n")}if(tableHasUserIDFld&&table.TblName!=PROJ.SecTbl&&field.FldName==table.TblUserIDFld&&ctrlId!="register"){condStr=firstCond?"if":"} elseif";firstCond=false;__append("\\n");__append(condStr);__append(" (!$Security->isAdmin() && $Security->isLoggedIn()) { // Non system admin\\n    $rsnew[\'");__append(SingleQuote(fldName));__append("\'] = CurrentUserID();\\n")}if(!firstCond){__append("\\n}\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptUpdateSpecial",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptView:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let field=fld||FIELD,table=tbl||TABLE,control=ctrl||CONTROL,fldObj=Code.fldObj(field,table,control),ctlid="view",cv=Code.getName(fldObj,Code.Field.CurrentValue),vv=Code.getName(fldObj,Code.Field.ViewValue);_arguments=Object.assign(_arguments,{cv:cv,vv:vv,ctlid:ctlid});__append("\\n");__append(ScriptViewCall(_arguments));let __args={arguments:arguments[0],code:__output};Events.emit("ScriptView",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewCall:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,dtl:dtl,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),tblVar=table.TblVar,fldParm=field.FldParm,fldHtmlTag=ctlid=="aggregate"?ctlid.toUpperCase():field.FldHtmlTag,out="";if(["summary","crosstab"].includes(ctrlId)){if(IsUndefined(dtl))dtl=true;if(IsDetailGroupTypeField(table,field))fldHtmlTag="NO";else fldHtmlTag="TEXT"}if(IsSelfLookupField(field,table))fldHtmlTag="TEXT";switch(fldHtmlTag){case"NO":out=ScriptViewNo(_arguments);break;case"TEXT":case"AGGREGATE":out=ScriptViewText(_arguments);break;case"PASSWORD":out=ScriptViewPassword(_arguments);break;case"RADIO":out=ScriptViewRadio(_arguments);break;case"CHECKBOX":out=ScriptViewCheckbox(_arguments);break;case"SELECT":out=ScriptViewSelect(_arguments);break;case"TEXTAREA":out=ScriptViewTextarea(_arguments);break;case"HIDDEN":out=ScriptViewHidden(_arguments);break;case"FILE":out=ScriptViewFile(_arguments);break}let argsv=Object.assign({},_arguments,{parm:vv});if(fldHtmlTag!="AGGREGATE"&&IsVirtualLookupField(field)){out=ScriptViewVirtual(Object.assign({},argsv,{wrk:out}))}let formatWrk=!IsLookupField(field)?ScriptViewFormat(argsv):"";if(!IsEmpty(formatWrk))formatWrk=`${vv} = ${formatWrk};`;if(fldHtmlTag!="AGGREGATE"&&["Both","Use Table"].includes(PROJ.SecType)&&PROJ.SecTbl==table.TblName&&DB.SecUserLevelFld==field.FldName){__append("\\nif ($Security->canAdmin()) { // System admin\\n    ");__append(String(out).replace(/\\n/g,"\\n    "));__append("\\n    ");__append(String(formatWrk).replace(/\\n/g,"\\n    "));__append("\\n} else {\\n    ");__append(String(ScriptViewPassword(_arguments)).replace(/\\n/g,"\\n    "));__append("\\n}\\n")}else{__append("\\n");__append(out);__append("\\n");__append(formatWrk);__append("\\n")}let arCellClass=[],cellClassCodes="",cssClass=FieldViewClass(field),cellStyle=!IsEmpty(field.FldAlign)?`text-align: ${field.FldAlign};`:"";if(ctrlId=="summary"&&field.FldGroupBy>0){if(dtl){arCellClass.push("ew-rpt-grp-field-"+field.FldGroupBy)}else{if(table.TblRptShowSummaryView){let groupCount=table.Fields.filter((f=>f.FldGroupBy>0)).length;if(groupCount==field.FldGroupBy)arCellClass.push("ew-rpt-grp-field-%g");else cellClassCodes=`($this->RowGroupLevel == %g ? "ew-rpt-grp-summary-%g" : "ew-rpt-grp-field-%g")`}else{cellClassCodes=`($this->RowGroupLevel == %g ? "ew-rpt-grp-summary-%g" : "ew-rpt-grp-field-%g")`}cellClassCodes=cellClassCodes.replace(/%g/g,field.FldGroupBy)}}else if(ctrlId=="crosstab"&&field.FldRowID>0){if(dtl){arCellClass.push("ew-rpt-grp-field-"+field.FldRowID)}else{cellClassCodes=`($this->RowGroupLevel == %g ? "ew-rpt-grp-summary-%g" : "ew-rpt-grp-field-%g")`;cellClassCodes=cellClassCodes.replace(/%g/g,field.FldRowID)}}else if(dtl){cellClassCodes=`($this->RecordCount % 2 != 1 ? "ew-table-alt-row" : "ew-table-row")`}if(arCellClass.length)if(cellClassCodes)cellClassCodes=`"${arCellClass.join(" ")} " . ${cellClassCodes}`;else cellClassCodes=`"${arCellClass.join(" ")}"`;if(!IsEmpty(cssClass)){__append("\\n");__append(Code.getName(fldObj,Code.Field.CssClass));__append(\' = "\');__append(cssClass);__append(\'";\\n\')}if(!IsEmpty(cellClassCodes)){__append("\\n");__append(Code.getName(fldObj,Code.Field.CellCssClass));__append(" = ");__append(cellClassCodes);__append(";\\n")}if(!IsEmpty(cellStyle)){__append("\\n");__append(Code.getName(fldObj,Code.Field.CellCssStyle));__append(\' .= "\');__append(cellStyle);__append(\'";\\n\')}let fldViewCustomAttributes=field.FldViewCustomAttributes;if(IsEmpty(fldViewCustomAttributes))fldViewCustomAttributes=`""`;__append("\\n");__append(Code.getName(fldObj,Code.Field.ViewCustomAttributes));__append(" = ");__append(fldViewCustomAttributes);__append(";\\n");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewCall",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewCheckbox:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let field=fld||FIELD;if(field.FldSelectType=="Table"){_arguments=Object.assign(_arguments,{isedit:false});return ScriptViewTable(_arguments)}else{return ScriptViewValues(_arguments)}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewCheckbox",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewFile:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),tblVar=table.TblVar,fldParm=field.FldParm,fldUploadPath="",ctlDbValue=Code.getName(fldObj,Code.Field.Upload.DbValue),uploadPath=Code.getName(fldObj,Code.Field.UploadPath),imageWidth=Code.getName(fldObj,Code.Field.ImageWidth),imageHeight=Code.getName(fldObj,Code.Field.ImageHeight),imageAlt=Code.getName(fldObj,Code.Field.ImageAlt),alt=Code.getName(fldObj,Code.Field.Alt);if(!IsEmpty(field.FldUploadPath))fldUploadPath=field.FldUploadPath;__append("\\n");if(fldUploadPath){__append("\\n");__append(uploadPath);__append(" = ");__append(fldUploadPath);__append(";\\n")}__append("\\nif (!EmptyValue(");__append(ctlDbValue);__append(")) {\\n");if(field.FldViewTag=="IMAGE"||field.FldViewThumbnail){if(field.FldTagImgWidth>0||field.FldTagImgHeight>0){let width=IsValue(field.FldTagImgWidth)?field.FldTagImgWidth:0,height=IsValue(field.FldTagImgHeight)?field.FldTagImgHeight:0;__append("\\n    ");__append(String(imageWidth).replace(/\\n/g,"\\n    "));__append(" = ");__append(width);__append(";\\n    ");__append(String(imageHeight).replace(/\\n/g,"\\n    "));__append(" = ");__append(height);__append(";\\n")}else{if(field.FldViewThumbnail){__append("\\n    ");__append(String(imageWidth).replace(/\\n/g,"\\n    "));__append(\' = Config("THUMBNAIL_DEFAULT_WIDTH");\\n    \');__append(String(imageHeight).replace(/\\n/g,"\\n    "));__append(\' = Config("THUMBNAIL_DEFAULT_HEIGHT");\\n\')}else if(field.FldViewTag=="IMAGE"){if(!IsEmpty(field.ImageWidthFld)&&!IsEmpty(field.ImageHeightFld)){let widthField=GetFieldObject(table,field.ImageWidthFld),widthFldObj=Code.fldObj(widthField,table,control),widthCurrentValue=Code.getName(widthFldObj,Code.Field.CurrentValue),heightField=GetFieldObject(table,field.ImageHeightFld),heightFldObj=Code.fldObj(heightField,table,control),heightCurrentValue=Code.getName(heightFldObj,Code.Field.CurrentValue);__append("\\n    if (");__append(widthCurrentValue);__append(" != null) {\\n        ");__append(String(imageWidth).replace(/\\n/g,"\\n        "));__append(" = ");__append(widthCurrentValue);__append(";\\n    } else {\\n        ");__append(String(imageWidth).replace(/\\n/g,"\\n        "));__append(" = 0;\\n    }\\n    if (");__append(heightCurrentValue);__append(" != null) {\\n        ");__append(String(imageHeight).replace(/\\n/g,"\\n        "));__append(" = ");__append(heightCurrentValue);__append(";\\n    } else {\\n        ");__append(String(imageHeight).replace(/\\n/g,"\\n        "));__append(" = 0;\\n    }\\n")}}}__append("\\n    ");__append(String(imageAlt).replace(/\\n/g,"\\n    "));__append(" = ");__append(alt);__append(";\\n")}if(IsBinaryField(field)){let keyUrl=KeyUrl(table);__append("\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(keyUrl);__append(";\\n    ");__append(String(Code.getName(fldObj,Code.Field.IsBlobImage)).replace(/\\n/g,"\\n    "));__append(" = IsImageFile(ContentExtension(");__append(ctlDbValue);__append("));\\n");if(!IsEmpty(field.FileNameFld)){let fileNameField=GetFieldObject(table,field.FileNameFld),fileNameFldObj=Code.fldObj(fileNameField,table,control),fileNameCurrentValue=Code.getName(fileNameFldObj,Code.Field.CurrentValue),fileName=Code.getName(fldObj,Code.Field.Upload.FileName);__append("\\n    ");__append(String(fileName).replace(/\\n/g,"\\n    "));__append(" = ");__append(fileNameCurrentValue);__append(";\\n")}}else{let uploadMultiple=field.FldUploadMultiple&&!IsBinaryField(field);if(field.FldViewTag=="IMAGE"){__append("\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(ctlDbValue);__append(";\\n")}else{__append("\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(ctlDbValue);__append(";\\n")}}__append("\\n} else {\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(\' = "";\\n}\\n\');let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewFile",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewFormat:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{parm:parm,tbl:tbl,fld:fld,ctrl:ctrl,ctlid:ctlid,islookup:islookup}=_arguments;let table=tbl||TABLE,field=fld||FIELD,control=ctrl||CONTROL,fldObj=Code.fldObj(field,table,control),fldFmtType=field.FldFmtType,fldDtFormat=field.FldDtFormat,fldType=GetFieldType(field.FldType),fldNumDigits=field.FldNumDigits;if(ctlid=="aggregate"){let fldAggregate=field.FldAggregate.toLowerCase();if(fldAggregate=="count"){if(["Currency","Number","Percent"].includes(fldFmtType)){fldFmtType="Number";fldNumDigits=0}else{fldFmtType=""}}}if(table.TblType=="REPORT"&&table.TblReportType=="summary"&&field.FldGroupBy>0&&(!IsEmpty(field.FldGroupByType)&&field.FldGroupByType!="n"))fldFmtType="None";if(table.TblType=="REPORT"&&table.TblReportType=="crosstab"&&field.FldColumnID>0&&field.FldColumnDateType=="y")fldFmtType="None";if(fldType!=1&&["Currency","Number","Percent"].includes(fldFmtType)||![2,7].includes(fldType)&&["Date/Time"].includes(fldFmtType))fldFmtType="None";switch(fldFmtType){case"Currency":return`FormatCurrency(${parm}, ${fldNumDigits}, ${field.FldIncLeadDigit}, ${field.FldUseParen}, ${field.FldGpDigits})`;break;case"Date/Time":return`FormatDateTime(${parm}, ${fldDtFormat})`;break;case"Number":return`FormatNumber(${parm}, ${fldNumDigits}, ${field.FldIncLeadDigit}, ${field.FldUseParen}, ${field.FldGpDigits})`;break;case"Percent":return`FormatPercent(${parm}, ${fldNumDigits}, ${field.FldIncLeadDigit}, ${field.FldUseParen}, ${field.FldGpDigits})`;break;case"String":let out="";if(!IsEmpty(field.FldStrFunc)){out=RemoveQuotes(field.FldStrFunc);if(out.includes("{value}"))out=out.replace("{value}",parm);else out=`${out}(${parm})`}return out;break;default:if(IsFloatFormatField(field)){let defaultDecimalPrecision=islookup?`Config("DEFAULT_DECIMAL_PRECISION")`:Code.getName(fldObj,Code.Field.DefaultDecimalPrecision);return`FormatNumber(${parm}, ${defaultDecimalPrecision})`}return"";break}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewFormat",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewHidden:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv}=_arguments;__append("\\n");__append(vv);__append(" = ");__append(cv);__append(";");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewHidden",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewHighlightSearch:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,fldParm=field.FldParm,basicSearch=table.TblBasicSearch&&field.FldBasicSearch,advancedSearch=table.TblSearch&&field.FldSearch||table.TblExtendedBasicSearch&&field.FldExtendedBasicSearch;if(ctlid=="view"&&(basicSearch||advancedSearch)){__append("\\nif (!$this->isExport()) {\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = $this->highlightValue($this->");__append(fldParm);__append(");\\n}\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewHighlightSearch",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewHref:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),tblVar=table.TblVar,fldParm=field.FldParm,fldHrefFld=field.FldHrefFld,uploadMultiple=field.FldUploadMultiple&&!IsBinaryField(field),isExport=Code.getName(Code.this,Code.IsExport),linkAttrs=Code.getName(fldObj,Code.Field.LinkAttrs),hrefValue=Code.getName(fldObj,Code.Field.HrefValue),uploadPath=Code.getName(fldObj,Code.Field.UploadPath),uploadDbValue=Code.getName(fldObj,Code.Field.Upload.DbValue);if(field.FldHtmlTag=="FILE"){if(field.FldViewTag!="IMAGE"){if(fldHrefFld!=""&&fldHrefFld!=field.FldName)fldHrefFld=field.FldName}else if(field.FldViewTag=="IMAGE"&&PROJ.UseColorbox){if(fldHrefFld=="")fldHrefFld=field.FldName}}if(!IsEmpty(fldHrefFld)){let hrefField=GetFieldObject(table,fldHrefFld),hrefFldObj=Code.fldObj(hrefField,table,control),hrefFld=Code.getName(hrefFldObj),hrefCurrentValue=Code.getName(hrefFldObj,Code.Field.CurrentValue),hrefViewValue=ctlid=="view"?Code.getName(hrefFldObj,Code.Field.ViewValue):Code.getName(hrefFldObj,Code.Field.EditValue),hrefFldDbValue=Code.getName(hrefFldObj,Code.Field.Upload.DbValue),hrefFldValue,target="",prefix="",suffix="",sImageWidthVar,sImageHeightVar;if(IsBinaryField(hrefField)){let keyUrl=KeyUrl(table);hrefFldValue=`GetFileUploadUrl(${hrefFld}, ${keyUrl})`;if(field.FldTagASuffix!="None"&&!IsEmpty(field.FldTagASuffix)){suffix=" . "+DoubleQuote(field.FldTagASuffix)}target=field.FldTagATarget;__append("\\nif (!empty(");__append(hrefFldDbValue);__append(")) {\\n    ");__append(String(hrefValue).replace(/\\n/g,"\\n    "));__append(" = ");__append(hrefFldValue);__append(suffix);__append(";\\n    ");__append(String(linkAttrs).replace(/\\n/g,"\\n    "));__append(\'["target"] = "\');__append(Quote(target));__append(\'";\\n    if (\');__append(Code.getName(fldObj,Code.Field.IsBlobImage));__append(" && empty(");__append(linkAttrs);__append(\'["target"])) {\\n        \');__append(String(linkAttrs).replace(/\\n/g,"\\n        "));__append(\'["target"] = "_blank";\\n    }\\n    if (\');__append(isExport);__append(") {\\n        ");__append(String(hrefValue).replace(/\\n/g,"\\n        "));__append(" = FullUrl(");__append(hrefValue);__append(\', "href");\\n    }\\n} else {\\n    \');__append(String(hrefValue).replace(/\\n/g,"\\n    "));__append(\' = "";\\n}\\n\')}else{if(field.FldHrefFldOrig){hrefFldValue=hrefCurrentValue}else{hrefFldValue=`(!empty(${hrefViewValue}) && !is_array(${hrefViewValue}) ? RemoveHtml(${hrefViewValue}) : ${hrefCurrentValue})`}let fldUploadPath,dbValue;if(hrefField.FldHtmlTag=="FILE"){if(!IsEmpty(hrefField.FldUploadPath)){fldUploadPath=hrefField.FldUploadPath}dbValue=hrefFldDbValue;if(uploadMultiple)hrefFldValue=\'"%u"\';else hrefFldValue=`GetFileUploadUrl(${hrefFld}, ${Code.getName(hrefFldObj,Code.Field.HtmlDecode)}(${dbValue}))`}else{dbValue=hrefCurrentValue}if(field.FldTagAPrefix!="None"&&!IsEmpty(field.FldTagAPrefix)){prefix=DoubleQuote(field.FldTagAPrefix)+" . "}if(field.FldTagASuffix!="None"&&!IsEmpty(field.FldTagASuffix)){suffix=" . "+DoubleQuote(field.FldTagASuffix)}target=field.FldTagATarget;let hrefUploadPath=Code.getName(hrefFldObj,Code.Field.UploadPath);__append("\\n");if(fldUploadPath){__append("\\n");__append(hrefUploadPath);__append(" = ");__append(fldUploadPath);__append(";\\n")}__append("\\nif (!EmptyValue(");__append(dbValue);__append(")) {\\n    ");__append(String(hrefValue).replace(/\\n/g,"\\n    "));__append(" = ");__append(prefix);__append(hrefFldValue);__append(suffix);__append("; // Add prefix/suffix\\n    ");__append(String(linkAttrs).replace(/\\n/g,"\\n    "));__append(\'["target"] = "\');__append(Quote(target));__append(\'"; // Add target\\n    if (\');__append(isExport);__append(") {\\n        ");__append(String(hrefValue).replace(/\\n/g,"\\n        "));__append(" = FullUrl(");__append(hrefValue);__append(\', "href");\\n    }\\n} else {\\n    \');__append(String(hrefValue).replace(/\\n/g,"\\n    "));__append(\' = "";\\n}\\n\')}}else{__append("\\n");__append(hrefValue);__append(\' = "";\\n\')}if(field.FldHtmlTag=="FILE"){let exportHrefValue="";if(IsBinaryField(field)){let keyUrl=KeyUrl(table);exportHrefValue=`GetFileUploadUrl(${Code.getName(fldObj)}, ${keyUrl})`}else{exportHrefValue=Code.concat(uploadPath,uploadDbValue)}if(exportHrefValue=="")exportHrefValue=`""`;__append("\\n");__append(Code.getName(fldObj,Code.Field.ExportHrefValue));__append(" = ");__append(exportHrefValue);__append(";\\n")}else{let customViewTemplateExport=GetCustomViewTemplateExport(table,field);UseCustomViewTemplate=!IsEmpty(customViewTemplateExport)&&customViewTemplateExport.trim()!="";if(UseCustomViewTemplate){__append("\\n");__append(customViewTemplateExport);__append("\\n")}}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewHref",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewNo:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv}=_arguments;__append("\\n");__append(vv);__append(" = ");__append(cv);__append(";");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewNo",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewPassword:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv}=_arguments;__append("\\n");__append(vv);__append(" = ");__append(Code.languagePhrase("PasswordMask"));__append(";");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewPassword",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewRadio:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let field=fld||FIELD;if(field.FldSelectType=="Table"){_arguments=Object.assign(_arguments,{isedit:false});return ScriptViewTable(_arguments)}else{return ScriptViewValues(_arguments)}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewRadio",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewRefer:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let table=tbl||TABLE,field=fld||FIELD,control=ctrl||CONTROL,fldParm=field.FldParm,fldObj=Code.fldObj(field,table,control),ctlid="view",cv=Code.getName(fldObj,Code.Field.CurrentValue),vv=Code.getName(fldObj,Code.Field.ViewValue);_arguments=Object.assign(_arguments,{cv:cv,vv:vv,ctlid:ctlid});__append("\\n");__append(ScriptReferCall(_arguments));__append("\\n");if(IsFieldDrillDown(field)){let isSecurityEnabled=PROJ.SecType&&PROJ.SecType!="None",checkDrillDownTable=isSecurityEnabled?` && AllowList(PROJECT_ID . $${fldObj}->DrillDownTable)`:"";__append("\\nif (!$this->isExport()");__append(checkDrillDownTable);__append(") {\\n    $drillurl = $");__append(fldObj);__append("->DrillDownUrl;\\n");let drillTable=GetTableObject(field.FldDrillTable),drillTblVar=drillTable.TblVar,drillSourceFields=field.FldDrillSourceFields.trim().replace(/\\|\\|$/,""),arSourceFlds=drillSourceFields.split("||"),drillTargetFields=field.FldDrillTargetFields.trim().replace(/\\|\\|$/,""),arTargetFlds=drillTargetFields.split("||"),filterParm="";if(arSourceFlds.length==arTargetFlds.length){let j=0,mapSourceTarget=ArrayCombine(arSourceFlds,arTargetFlds);for(let[sourceFld,targetFld]of mapSourceTarget.entries()){let sourceField=GetFieldObject(table,sourceFld),sourceFldParm=sourceField.FldParm,sourceFldObj=field.FldParm==sourceFldParm?fldObj:"this->"+sourceFldParm,targetField=GetFieldObject(drillTable,targetFld),targetFldParm=targetField.FldParm;if(table.TblReportType=="crosstab"&&sourceField.FldColumnID==0&&(sourceField.FldRowID==0||field.FldRowID>0&&field.FldRowID<sourceField.FldRowID))filterParm=", -1";else filterParm="";__append(\'\\n    $drillurl = str_replace("=f\');__append(j++);__append(\'", "=" . Encrypt($this->getDrillDownSql($\');__append(sourceFldObj);__append(\', "\');__append(targetFldParm);__append(\'", 0\');__append(filterParm);__append(")), $drillurl);\\n")}}__append("\\n    $");__append(fldObj);__append(\'->LinkAttrs["title"] = JsEncodeAttribute($GLOBALS["Language"]->phrase("ClickToDrillDown"));\\n    $\');__append(fldObj);__append(\'->LinkAttrs["class"] = "ew-drill-link";\\n    $\');__append(fldObj);__append(\'->LinkAttrs["onclick"] = DrillDownScript($drillurl, \\\'\');__append(tblVar);__append("_");__append(fldParm);__append("\', $GLOBALS[\\"Language\\"]->tablePhrase(\'");__append(drillTblVar);__append("\', \'TblCaption\'), $this->UseDrillDownPanel);\\n    $");__append(fldObj);__append(\'->LinkAttrs["data-drilldown-placement"] = "bottom";\\n    if ($\');__append(fldObj);__append(\'->HrefValue == "") {\\n        $\');__append(fldObj);__append(\'->HrefValue = "#";\\n    }\\n}\\n\')}__append("\\n");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewRefer",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewSelect:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let field=fld||FIELD;if(field.FldSelectType=="Table"){_arguments=Object.assign(_arguments,{isedit:false});return ScriptViewTable(_arguments)}else{return ScriptViewValues(_arguments)}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewSelect",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewTable:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,ctlid:ctlid,isedit:isedit,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),ctrlType=control.CtrlType.toLowerCase(),fldObj=Code.fldObj(field,table,control),tblVar=table.TblVar,fldParm=field.FldParm,multiple=field.FldHtmlTag=="CHECKBOX"||field.FldHtmlTag=="SELECT"&&field.FldSelectMultiple,prefix=isedit?"HtmlEncode(":"",prefix2=prefix,suffix=isedit?")":"",suffix2=suffix,displayValue=Code.getName(fldObj,Code.Field.DisplayValue),lookup=Code.getName(fldObj,Code.Field.Lookup);if(GetFieldType(field.FldType)==2){prefix2+="FormatDateTime(";suffix2=`, ${field.FldDtFormat})`+suffix2}if(!IsEmpty(field.FldTagLnkTbl)&&!IsEmpty(field.FldTagLnkFld)&&!IsEmpty(field.FldTagLnkDisplay)){let dbId=GetDbId(field.FldTagLnkTbl),linkTable=GetTableObject(field.FldTagLnkTbl),linkDBID=linkTable.LinkDBID,fldSelectFilter=field.FldSelectFilter.trim(),linkField=GetFieldObject(linkTable,field.FldTagLnkFld),linkFldObj=Code.fldObj(linkField,linkTable,control),linkCurrentValue=Code.getName(linkFldObj,Code.Field.CurrentValue);let dispField=GetFieldObject(linkTable,field.FldTagLnkDisplay),formatWrk1=ScriptViewFormat({fld:dispField,parm:"%fld%",islookup:true}),dispFldObj=Code.fldObj(dispField,linkTable,control),dispCurrentValue=Code.getName(dispFldObj,Code.Field.CurrentValue);let formatWrk2,formatWrk3,formatWrk4,disp2CurrentValue,disp3CurrentValue,disp4CurrentValue;if(!IsEmpty(field.FldTagLnkDisp2)){dispField=GetFieldObject(linkTable,field.FldTagLnkDisp2);dispFldObj=Code.fldObj(dispField,linkTable,control);disp2CurrentValue=Code.getName(dispFldObj,Code.Field.CurrentValue)}if(!IsEmpty(field.FldTagLnkDisp3)){dispField=GetFieldObject(linkTable,field.FldTagLnkDisp3);dispFldObj=Code.fldObj(dispField,linkTable,control);disp3CurrentValue=Code.getName(dispFldObj,Code.Field.CurrentValue)}if(!IsEmpty(field.FldTagLnkDisp4)){dispField=GetFieldObject(linkTable,field.FldTagLnkDisp4);dispFldObj=Code.fldObj(dispField,linkTable,control);disp4CurrentValue=Code.getName(dispFldObj,Code.Field.CurrentValue)}if((field.FldTagLnkTbl==table.TblName||table.TblType=="REPORT"&&field.FldTagLnkTbl==table.TblRptSrc)&&field.FldName==field.FldTagLnkFld&&!multiple){__append(\'\\n$arwrk = [];\\n$arwrk["df"] = \');__append(dispCurrentValue);__append(";\\n");if(!IsEmpty(field.FldTagLnkDisp2)){__append(\'\\n$arwrk["df2"] = \');__append(disp2CurrentValue);__append(";\\n")}__append("\\n");if(!IsEmpty(field.FldTagLnkDisp3)){__append(\'\\n$arwrk["df3"] = \');__append(disp3CurrentValue);__append(";\\n")}__append("\\n");if(!IsEmpty(field.FldTagLnkDisp4)){__append(\'\\n$arwrk["df4"] = \');__append(disp4CurrentValue);__append(";\\n")}__append("\\n$arwrk = ");__append(lookup);__append("->renderViewRow($arwrk, $this);\\n$dispVal = ");__append(displayValue);__append(\'($arwrk);\\nif ($dispVal != "") {\\n    \');__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = $dispVal;\\n}\\n")}else{let linkField=GetFieldObject(linkTable,field.FldTagLnkFld),lnkFldWhere="";if(linkTable.UseSqlAliasForCustomView)lnkFldWhere=Code.quote(CustomViewFieldName(linkField,dbId));else lnkFldWhere=Code.quote(FieldSqlName(linkField,dbId));let connObj=linkDBID=="DB"||linkDBID==""?"Conn()":`Conn("${Quote(linkDBID)}")`;let lookupGetSql=Code.getName(fldObj,Code.Field.LookupGetSql);if(ctrlType=="report"){__append("\\n$curVal = ");__append(cv);__append(\' == INIT_VALUE ? "" : trim(strval(\');__append(cv);__append("));\\n")}else{__append("\\n$curVal = trim(strval(");__append(cv);__append("));\\n")}__append(\'\\nif ($curVal != "") {\\n    \');__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(Code.getName(fldObj,Code.Field.LookupCacheOption));__append("($curVal);\\n    if (");__append(vv);__append(" === null) { // Lookup from database\\n\\n");if(multiple){__append(\'\\n        $arwrk = explode(",", $curVal);\\n        $filterWrk = "";\\n        foreach ($arwrk as $wrk) {\\n            if ($filterWrk != "") {\\n                $filterWrk .= " OR ";\\n            }\\n            $filterWrk .= "\');__append(lnkFldWhere);__append(\'" . SearchString("=", trim($wrk), \');__append(GetFieldTypeName(linkField.FldType));__append(\', "\');__append(Quote(linkDBID));__append(\'");\\n        }\\n\')}else{__append(\'\\n        $filterWrk = "\');__append(lnkFldWhere);__append(\'" . SearchString("=", $curVal, \');__append(GetFieldTypeName(linkField.FldType));__append(\', "\');__append(Quote(linkDBID));__append(\'");\\n\')}__append("\\n\\n    ");if(fldSelectFilter!=""){__append("\\n        $lookupFilter = function() {\\n            return ");__append(fldSelectFilter);__append(";\\n        };\\n        $lookupFilter = $lookupFilter->bindTo($this);\\n        $sqlWrk = ");__append(lookupGetSql);__append("(false, $filterWrk, $lookupFilter, $this, true, true);\\n    ")}else{__append("\\n        $sqlWrk = ");__append(lookupGetSql);__append("(false, $filterWrk, \'\', $this, true, true);\\n    ")}__append("\\n        $rswrk = ");__append(connObj);__append("->executeQuery($sqlWrk)->fetchAll(\\\\PDO::FETCH_BOTH);\\n        $ari = count($rswrk);\\n        if ($ari > 0) { // Lookup values found\\n");if(multiple){__append("\\n            ");__append(String(vv).replace(/\\n/g,"\\n            "));__append(" = new OptionValues();\\n            foreach ($rswrk as $row) {\\n                $arwrk = ");__append(lookup);__append("->renderViewRow($row);\\n                ");__append(String(vv).replace(/\\n/g,"\\n                "));__append("->add(");__append(displayValue);__append("($arwrk));\\n            }\\n")}else{__append("\\n            $arwrk = ");__append(lookup);__append("->renderViewRow($rswrk[0]);\\n            ");__append(String(vv).replace(/\\n/g,"\\n            "));__append(" = ");__append(displayValue);__append("($arwrk);\\n")}__append("\\n        } else {\\n            ");__append(String(vv).replace(/\\n/g,"\\n            "));__append(" = ");__append(prefix2+cv+suffix2);__append(";\\n        }\\n    }\\n} else {\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = null;\\n}\\n")}}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewTable",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewText:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),imageWidth=Code.getName(fldObj,Code.Field.ImageWidth),imageHeight=Code.getName(fldObj,Code.Field.ImageHeight),imageAlt=Code.getName(fldObj,Code.Field.ImageAlt),alt=Code.getName(fldObj,Code.Field.Alt),viewValue=Code.getName(fldObj,Code.Field.ViewValue),tblVar=table.TblVar,fldParm=field.FldParm,args2=Object.assign({},_arguments,{isedit:false});__append("\\n");__append(vv);__append(" = ");__append(cv);__append(";\\n");if(DB.UseDynamicUserLevel&&table.TblName==DB.UserLevelTbl&&field.FldName==DB.UserLevelNameFld){let userLevelIdField=GetFieldObject(table,DB.UserLevelIdFld),userLevelIdFldObj=Code.fldObj(userLevelIdField,table,control),userLevelIdCurrentValue=Code.getName(userLevelIdFldObj,Code.Field.CurrentValue);__append("\\nif ($Security->getUserLevelName(");__append(userLevelIdCurrentValue);__append(\') != "") {\\n    \');__append(String(viewValue).replace(/\\n/g,"\\n    "));__append(" = $Security->getUserLevelName(");__append(userLevelIdCurrentValue);__append(");\\n}\\n")}if(field.FldViewTag=="IMAGE"){if(field.FldTagImgWidth>0||field.FldTagImgHeight>0){let width=IsValue(field.FldTagImgWidth)?field.FldTagImgWidth:0,height=IsValue(field.FldTagImgHeight)?field.FldTagImgHeight:0;if(width>0){__append("\\n");__append(imageWidth);__append(" = ");__append(width);__append(";\\n")}if(height>0){__append("\\n");__append(imageHeight);__append(" = ");__append(height);__append(";\\n")}}else if(!IsEmpty(field.ImageWidthFld)&&!IsEmpty(field.ImageHeightFld)){let widthField=GetFieldObject(table,field.ImageWidthFld),widthFldObj=Code.fldObj(widthField,table,control),widthCurrentValue=Code.getName(widthFldObj,Code.Field.CurrentValue),heightField=GetFieldObject(table,field.ImageHeightFld),heightFldObj=Code.fldObj(heightField,table,control),heightCurrentValue=Code.getName(heightFldObj,Code.Field.CurrentValue);__append("\\nif (");__append(widthCurrentValue);__append(" != null) {\\n    ");__append(String(imageWidth).replace(/\\n/g,"\\n    "));__append(" = ");__append(widthCurrentValue);__append(";\\n}\\nif (");__append(heightCurrentValue);__append(" != null) {\\n    ");__append(String(imageWidth).replace(/\\n/g,"\\n    "));__append(" = ");__append(heightCurrentValue);__append(";\\n}\\n")}__append("\\n");__append(imageAlt);__append(" = ");__append(alt);__append(";\\n")}__append("\\n");if(ctlid!="aggregate"&&IsLinkTableField(field)&&!IsSelfLookupField(field,table)){__append("\\n");__append(ScriptViewTable(args2));__append("\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewText",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewTextarea:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),fldMemoMaxLength=field.FldMemoMaxLength;if(["list","grid","delete"].includes(ctrlId)&&fldMemoMaxLength>0){__append("\\n");__append(vv);__append(" = TruncateMemo(");__append(cv);__append(", ");__append(fldMemoMaxLength);__append(", ");__append(Code.getName(fldObj,Code.Field.TruncateMemoRemoveHtml));__append(");\\n")}else{__append("\\n");__append(vv);__append(" = ");__append(cv);__append(";\\n")}if(field.FldMemoCRLFReplace){__append("\\nif (");__append(vv);__append(" != null) {\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(Code.replace(vv,`["\\\\r\\\\n", "\\\\n", "\\\\r"]`,`"<br>"`));__append(";\\n}\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewTextarea",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewValues:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{cv:cv,vv:vv,ctlid:ctlid,ctrl:ctrl,tbl:tbl,fld:fld}=_arguments;let control=ctrl||CONTROL,table=tbl||TABLE,field=fld||FIELD,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),tblVar=table.TblVar,fldParm=field.FldParm,tagCaption=Code.getName(fldObj,Code.Field.TagCaption),tagValue=Code.getName(fldObj,Code.Field.TagValue),optionCaption=Code.getName(fldObj,Code.Field.OptionCaption),multiple=field.FldHtmlTag=="CHECKBOX"||field.FldHtmlTag=="SELECT"&&field.FldSelectMultiple,tagValues=BoolFieldTagValues(field.FldType,FieldTagValues(field)).trim().replace(/\\|$/,""),dlm="|";if(tagValues!=""){let arrLines=tagValues.split(dlm),val1,val2;if(IsBooleanField(table,field)){val1=`"Y"`;let tagYID=1;val2=`"N"`;let tagNID=2;if(arrLines.length>=2){arrLines.forEach(((line,i)=>{let arrValues=line.split(",");if(arrValues[0]==`"Y"`||arrValues[0]==`"y"`||arrValues[0]==`"1"`){tagYID=i+1;val1=arrValues[1]}else if(arrValues[0]==`"N"`||arrValues[0]==`"n"`||arrValues[0]==`"0"`){tagNID=i+1;val2=arrValues[1]}}))}__append("\\nif (ConvertToBool(");__append(cv);__append(")) {\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(tagCaption);__append("(");__append(tagYID);__append(\') != "" ? \');__append(tagCaption);__append("(");__append(tagYID);__append(") : ");__append(val1);__append(";\\n} else {\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(tagCaption);__append("(");__append(tagNID);__append(\') != "" ? \');__append(tagCaption);__append("(");__append(tagNID);__append(") : ");__append(val2);__append(";\\n}\\n")}else{__append("\\nif (strval(");__append(cv);__append(\') != "") {\\n\');if(multiple){__append("\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(\' = new OptionValues();\\n    $arwrk = explode(",", strval(\');__append(cv);__append("));\\n    $cnt = count($arwrk);\\n    for ($ari = 0; $ari < $cnt; $ari++)\\n        ");__append(String(vv).replace(/\\n/g,"\\n        "));__append("->add(");__append(optionCaption);__append("(trim($arwrk[$ari])));\\n")}else{__append("\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(optionCaption);__append("(");__append(cv);__append(");\\n")}__append("\\n} else {\\n    ");__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = null;\\n}\\n")}}let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewValues",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ScriptViewVirtual:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{wrk:wrk,parm:parm,vv:vv,tbl:tbl,fld:fld,ctrl:ctrl}=_arguments;let field=fld||FIELD,table=tbl||TABLE,control=ctrl||CONTROL,fldObj=Code.fldObj(field,table,control),lv=Code.getName(fldObj,Code.Field.VirtualValue);__append("\\nif (");__append(lv);__append(\' != "") {\\n    \');__append(String(vv).replace(/\\n/g,"\\n    "));__append(" = ");__append(lv);__append(";\\n} else {\\n    ");__append(String(wrk).replace(/\\n/g,"\\n    "));__append("\\n}\\n");let __args={arguments:arguments[0],code:__output};Events.emit("ScriptViewVirtual",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ServerDefaultMsg:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let field=fld||FIELD,table=tbl||TABLE,control=ctrl||CONTROL,fldObj=Code.fldObj(field,table,control),fldCaption=Code.getName(fldObj,Code.Field.Caption),phraseId="";switch(field.FldValidate){case"PASSWORD":return Code.languagePhrase("EnterPassword");break;case"EMAIL":return Code.languagePhrase("IncorrectEmail");break;case"DATE":let dateFormat=field.FldDtFormat,dateReplace=Code.globals(Code.DateSeparator);if([5,9,109].includes(dateFormat))phraseId="IncorrectDateYMD";else if([6,10,110].includes(dateFormat))phraseId="IncorrectDateMDY";else if([7,11,111].includes(dateFormat))phraseId="IncorrectDateDMY";else if([12,15,115].includes(dateFormat))phraseId="IncorrectShortDateYMD";else if([13,16,116].includes(dateFormat))phraseId="IncorrectShortDateMDY";else if([14,17,117].includes(dateFormat))phraseId="IncorrectShortDateDMY";else{phraseId="IncorrectDate";dateReplace=Code.globals(Code.DateFormat)}return Code.replace(Code.languagePhrase(phraseId),`"%s"`,dateReplace);break;case"TIME":return Code.replace(Code.languagePhrase("IncorrectTime"),`"%s"`,Code.globals(Code.TimeSeparator));break;case"FLOAT":return Code.languagePhrase("IncorrectFloat");break;case"RANGE":let find=`["%1", "%2"]`,replace=`["${Quote(field.FldMin)}", "${Quote(field.FldMax)}"]`;return Code.replace(Code.languagePhrase("IncorrectRange"),find,replace);break;case"INTEGER":return Code.languagePhrase("IncorrectInteger");break;case"USPHONE":return Code.languagePhrase("IncorrectPhone");break;case"USZIP":return Code.languagePhrase("IncorrectZip");break;case"CREDITCARD":return Code.languagePhrase("IncorrectCreditCard");break;case"USSSN":return Code.languagePhrase("IncorrectSSN");break;case"GUID":return Code.languagePhrase("IncorrectGUID");break;case"REGEX":return Code.languagePhrase("IncorrectField");break;default:return Code.languagePhrase("IncorrectField");break}let __args={arguments:arguments[0],code:__output};Events.emit("ServerDefaultMsg",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ServerErrMsg:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld}=_arguments;let field=fld||FIELD;if(!IsEmpty(field.FldErrMsg)){return`"${Quote(field.FldErrMsg)}"`}else{return ServerDefaultMsg(_arguments)}let __args={arguments:arguments[0],code:__output};Events.emit("ServerErrMsg",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ServerFileValidator:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let field=fld||FIELD,table=tbl||TABLE,control=ctrl||CONTROL,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),addMessage=Code.getName(fldObj,Code.Field.AddErrorMessage),fileName=Code.getName(fldObj,Code.Field.Upload.FileName),fileSize=Code.getName(fldObj,Code.Field.Upload.FileSize),fileError=Code.getName(fldObj,Code.Field.Upload.Error),fileAllowedExt=Code.getName(fldObj,Code.Field.UploadAllowedFileExt),fileMaxFileSize=Code.getName(fldObj,Code.Field.UploadMaxFileSize),multiUpdate=Code.getName(fldObj,Code.Field.MultiUpdate);if(ctrlId=="update"){__append("\\nif (");__append(multiUpdate);__append(\' != "") {\\n    if (!CheckFileType(\');__append(fileName);__append(", ");__append(fileAllowedExt);__append(")) {\\n        ");__append(String(addMessage).replace(/\\n/g,"\\n        "));__append("(");__append(Code.languagePhrase("WrongFileType"));__append(");\\n    }\\n    if (");__append(fileSize);__append(" > 0 && ");__append(fileMaxFileSize);__append(" > 0 && ");__append(fileSize);__append(" > ");__append(fileMaxFileSize);__append(") {\\n        ");__append(String(addMessage).replace(/\\n/g,"\\n        "));__append("(");__append(Code.replace(Code.languagePhrase("MaxFileSize"),`"%s"`,fileMaxFileSize));__append(");\\n    }\\n    if (in_array(");__append(fileError);__append(", [1, 2, 3, 6, 7, 8])) { // PHP\\n        ");__append(String(addMessage).replace(/\\n/g,"\\n        "));__append("(");__append(Code.languagePhrase(Code.concat("PhpUploadErr",fileError)));__append(");\\n    }\\n}\\n")}else{__append("\\nif (!CheckFileType(");__append(fileName);__append(", ");__append(fileAllowedExt);__append(")) {\\n    ");__append(String(addMessage).replace(/\\n/g,"\\n    "));__append("(");__append(Code.languagePhrase("WrongFileType"));__append(");\\n}\\nif (");__append(fileSize);__append(" > 0 && ");__append(fileMaxFileSize);__append(" > 0 && ");__append(fileSize);__append(" > ");__append(fileMaxFileSize);__append(") {\\n    ");__append(String(addMessage).replace(/\\n/g,"\\n    "));__append("(");__append(Code.replace(Code.languagePhrase("MaxFileSize"),`"%s"`,fileMaxFileSize));__append(");\\n}\\nif (in_array(");__append(fileError);__append(", [1, 2, 3, 6, 7, 8])) { // PHP\\n    ");__append(String(addMessage).replace(/\\n/g,"\\n    "));__append("(");__append(Code.languagePhrase(Code.concat("PhpUploadErr",fileError)));__append(");\\n}\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ServerFileValidator",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ServerReqErrMsg:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let control=ctrl||CONTROL,field=fld||FIELD,table=tbl||TABLE,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),fldCaption=Code.getName(fldObj,Code.Field.Caption);if(ctrlId=="register"&&field.FldName==PROJ.SecLoginIDFld){return Code.languagePhrase("EnterUserName")}else if(ctrlId=="register"&&field.FldName==PROJ.SecPasswdFld){return Code.languagePhrase("EnterPassword")}else{return Code.replace(Code.getName(fldObj,Code.Field.RequiredErrorMessage),`"%s"`,fldCaption)}let __args={arguments:arguments[0],code:__output};Events.emit("ServerReqErrMsg",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ServerReqValidator:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let control=ctrl||CONTROL,field=fld||FIELD,table=tbl||TABLE,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),addMessage=Code.getName(fldObj,Code.Field.AddErrorMessage),fldHtmlTag=field.FldHtmlTag,fileName=Code.getName(fldObj,Code.Field.Upload.FileName),keepFile=Code.getName(fldObj,Code.Field.Upload.KeepFile),formValue=Code.getName(fldObj,Code.Field.FormValue),isDetailKey=Code.getName(fldObj,Code.Field.IsDetailKey),hasValue="",multiUpdate=Code.getName(fldObj,Code.Field.MultiUpdate);if(fldHtmlTag=="FILE"){hasValue=`${fileName} == "" && !${keepFile}`}else if(["CHECKBOX","RADIO"].includes(fldHtmlTag)||fldHtmlTag=="SELECT"&&field.FldSelectMultiple){hasValue=`${formValue} == ""`}else{hasValue=`!${isDetailKey} && EmptyValue(${formValue})`}if(ctrlId=="update"){__append("\\nif (");__append(multiUpdate);__append(\' != "" && \');__append(hasValue);__append(") {\\n    ");__append(String(addMessage).replace(/\\n/g,"\\n    "));__append("(");__append(ServerReqErrMsg());__append(");\\n}\\n")}else{__append("\\nif (");__append(hasValue);__append(") {\\n    ");__append(String(addMessage).replace(/\\n/g,"\\n    "));__append("(");__append(ServerReqErrMsg());__append(");\\n}\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ServerReqValidator",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ServerSearchValidator:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let control=ctrl||CONTROL,field=fld||FIELD,table=tbl||TABLE,fldObj=Code.fldObj(field,table,control),fldVal=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchValue);__append("\\n");__append(ServerValidatorCommon({fld:fld,ctrl:ctrl,val:fldVal}));__append("\\n");let isUserSelect=field.FldSrchOpr=="USER SELECT"&&GetFieldType(field.FldType)!=4;if(field.FldSrchOpr=="BETWEEN"||isUserSelect||!IsEmpty(field.FldSrchOpr2)){fldVal=Code.getName(fldObj,Code.Field.AdvancedSearch,Code.Field.SearchValue2);__append("\\n");__append(ServerValidatorCommon({fld:fld,ctrl:ctrl,val:fldVal}));__append("\\n")}let __args={arguments:arguments[0],code:__output};Events.emit("ServerSearchValidator",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ServerValidator:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl}=_arguments;let control=ctrl||CONTROL,field=fld||FIELD,table=tbl||TABLE,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),formValue=Code.getName(fldObj,Code.Field.FormValue),addMessage=Code.getName(fldObj,Code.Field.AddErrorMessage);if(ctrlId=="register"&&field.FldName==PROJ.SecPasswdFld){__append("\\nif (");__append(Code.getName(fldObj,Code.Field.ConfirmValue));__append(" != ");__append(formValue);__append(") {\\n    ");__append(String(addMessage).replace(/\\n/g,"\\n    "));__append("(");__append(Code.languagePhrase("MismatchPassword"));__append(");\\n}\\n")}else if(ctrlId=="register"&&field.FldName==DB.SecUserLevelFld){}else{_arguments=Object.assign(_arguments,{val:formValue});return ServerValidatorCommon(_arguments)}let __args={arguments:arguments[0],code:__output};Events.emit("ServerValidator",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;',ServerValidatorCommon:'var __output="";function __append(s){if(s!==undefined&&s!==null)__output+=s}var write=__append;let _arguments=arguments[0]||{},{fld:fld,tbl:tbl,ctrl:ctrl,val:val}=_arguments;let control=ctrl||CONTROL,field=fld||FIELD,table=tbl||TABLE,ctrlId=control.CtrlID.toLowerCase(),fldObj=Code.fldObj(field,table,control),addMessage=Code.getName(fldObj,Code.Field.AddErrorMessage),fldValidateArgs=IsEmpty(field.FldServerValidateArgs)?"":", "+field.FldServerValidateArgs,errorMessage=Code.getName(fldObj,Code.Field.SearchErrorMessage),checkValue="",validate=field.FldValidate,multiUpdate=Code.getName(fldObj,Code.Field.MultiUpdate);if(IsCrosstabYearField(table,field))validate="INTEGER";switch(validate){case"EMAIL":checkValue=`!CheckEmail(${val})`;break;case"DATE":if(field.FldDtFormat==12||field.FldDtFormat==15){checkValue=`!CheckStdShortDate(${val})`}else if(field.FldDtFormat==5||field.FldDtFormat==9){checkValue=`!CheckStdDate(${val})`}else if(field.FldDtFormat==14||field.FldDtFormat==17){checkValue=`!CheckShortEuroDate(${val})`}else if(field.FldDtFormat==7||field.FldDtFormat==11){checkValue=`!CheckEuroDate(${val})`}else if(field.FldDtFormat==13||field.FldDtFormat==16){checkValue=`!CheckShortUSDate(${val})`}else if(field.FldDtFormat==6||field.FldDtFormat==10){checkValue=`!CheckUSDate(${val})`}else{checkValue=`!CheckDate(${val})`}break;case"TIME":checkValue=`!CheckTime(${val})`;break;case"FLOAT":checkValue=`!CheckNumber(${val})`;break;case"RANGE":checkValue=`!CheckRange(${val}, ${IsValue(field.FldMin)?field.FldMin:Code.null}, ${IsValue(field.FldMax)?field.FldMax:Code.null})`;break;case"INTEGER":checkValue=`!CheckInteger(${val})`;break;case"USPHONE":checkValue=`!CheckPhone(${val})`;break;case"USZIP":checkValue=`!CheckZip(${val})`;break;case"CREDITCARD":checkValue=`!CheckCreditCard(${val})`;break;case"USSSN":checkValue=`!CheckSsn(${val})`;break;case"GUID":checkValue=`!CheckGuid(${val})`;break;case"REGEX":if(!IsEmpty(fldValidateArgs)){checkValue=`!CheckByRegEx(${val}${fldValidateArgs})`}else{checkValue=""}break;default:if(!IsEmpty(field.FldValidate)){checkValue=`!${field.FldValidate}(${val}${fldValidateArgs})`}break}if(checkValue!=""){if(ctrlId=="update"){__append("\\nif (");__append(multiUpdate);__append(\' != "") {\\n    if (\');__append(checkValue);__append(") {\\n        ");__append(String(addMessage).replace(/\\n/g,"\\n        "));__append("(");__append(errorMessage);__append(");\\n    }\\n}\\n")}else{__append("\\nif (");__append(checkValue);__append(") {\\n    ");__append(String(addMessage).replace(/\\n/g,"\\n    "));__append("(");__append(errorMessage);__append(");\\n}\\n")}}let __args={arguments:arguments[0],code:__output};Events.emit("ServerValidatorCommon",__args);if(args&&"code"in args)args.code=args.code.trimEnd()+"\\n\\n"+__args.code.replace(/^[\\r\\n]*/g,"");return __args.code;'};let productName="PHPMaker",product=productName.replace(/[ \.]/g,""),version="2021";fs=fs||require("fs"),path=path||require("path"),ejs=ejs||require("./ejs.js");const util=require("util"),EventEmitter=require("events"),ExecSync=require("child_process").execSync,process=require("process"),writeFile=util.promisify(fs.writeFile),copyFile=util.promisify(fs.copyFile);let hrstart=process.hrtime.bigint();global.IsArray=Array.isArray,global.IsBoolean=e=>"boolean"==typeof e,global.IsFunction=e=>"function"==typeof e||"[object Function]"===Object.prototype.toString.apply(e),global.IsNull=e=>null===e,global.IsNumber=e=>"number"==typeof e&&isFinite(e),global.IsObject=e=>e&&("object"==typeof e||IsFunction(e))||!1,global.IsString=e=>"string"==typeof e,global.IsUndefined=e=>void 0===e,global.IsValue=e=>IsObject(e)||IsString(e)||IsNumber(e)||IsBoolean(e),global.Throw=e=>{throw new Error(JSON.stringify(e))};let cwd=process.cwd(),modulePath=path.dirname(process.argv[1]),syscodePath=modulePath.endsWith("syscode")?modulePath:"",installPath=modulePath.endsWith("maker")?path.resolve(modulePath,"../../.."):"",gitPath=modulePath.endsWith("syscode")?path.resolve(modulePath,".."):"",workPath=gitPath||installPath;global.changeCase=require(path.join(workPath,"node","node_modules","change-case")),global.pascalCaseTransformMerge=require(path.join(workPath,"node","node_modules","pascal-case")).pascalCaseTransformMerge,global.fsExtra=require(path.join(workPath,"node","node_modules","fs-extra"));class InternalEventEmitter extends EventEmitter{}global.Events=new InternalEventEmitter,global.TrueValue="1",global.FalseValue="0",global.JavaScriptString="",global.ScriptTemplateClass="",global.FieldSpanTagStart="",global.FieldSpanTagEnd="",global.GenerateTemplateLine=!1,global.FieldOriginalTemplate="",global.UseCustomTemplate=!1,global.UseCustomMultiPageTemplate=!1,global.MultiPageIndex=0,global.CustomListOptions="block",global.UseCustomTemplateSearch=!1,global.UseCustomViewTemplate=!1,global.UsePlaceHolder="None",global.CheckPasswordStrength=!1,global.GeneratePassword=!1,global.RelativePath="",global.IncludeFilePathPrefix="",global.AppRootRelativePath="",global.TABLE=null,global.FIELD=null,global.CHART=null,global.CONTROL=null,global.PageObject="",global.HasCustomTemplate=!1,global.FileExists=e=>fs.existsSync(e),global.GetJavaScripts=()=>IsEmpty(PROJ.JavaScripts)?[]:PROJ.JavaScripts.split("|").map((e=>e.trim())).filter((e=>!IsEmpty(e))).filter(((e,l,t)=>t.indexOf(e)==l)),global.GetStyleSheets=()=>IsEmpty(PROJ.StyleSheets)?[]:PROJ.StyleSheets.split("|").map((e=>e.trim())).filter((e=>!IsEmpty(e))).filter(((e,l,t)=>t.indexOf(e)==l)),global.ArrayCombine=(e,l)=>{let t=new Map;return e.forEach(((e,a)=>t.set(e,l[a]))),t},global.IncludeTrailingPathDelimiter=e=>e?((e=e.trim())&&!e.endsWith("\\")&&(e+="\\"),e):"",global.ExcludeTrailingPathDelimiter=e=>e?e.trim().replace(/[\\/]*$/,""):"",global.IncludeTrailingSlash=e=>e?((e=e.trim().replace(/\\/g,"/"))&&!e.endsWith("/")&&(e+="/"),e):"",global.GetLanguageFileId=e=>{if(e=path.join(workPath,"languages",e),fs.existsSync(e)){let l=fs.readFileSync(e,"utf-8"),t=String(l).match(/ew-language\s[^>]+\sid\s*=\s*['"]([\w\-]+)['"]/);return t?t[1]:""}return console.log("Error: Language file not found:"+e),""},global.DatabaseConnection=e=>{let l=e.DBID,t=DbType(l),a=e.DBUID,d=e.DBPwd,r=IsEmpty(e.DBPort)?null:e.DBPort,n="ACCESS"==t,i="MSSQL"==t,p="MYSQL"==t,s="SQLITE"==t,o="POSTGRESQL"==t,_="ORACLE"==t,c=PROJ.EncryptionKey||"";c&&PROJ.EncryptUsernamePassword&&(a=PhpEncrypt(a,c,`database (${l}) username`),d=PhpEncrypt(d,c,`database (${l}) password`));let u={id:l,type:t,qs:e.DBQuoteS,qe:e.DBQuoteE};if(p||o)u=Object.assign({},u,{host:e.DBHost,port:r,user:a,password:d,dbname:e.DBName}),p||(u=Object.assign({},u,{schema:e.DBSchema}));else if(_){let l=IsEmpty(e.DBHost)?GetOracleServiceName(e.DBConnstr):e.DBHost;u=Object.assign({},u,{connectstring:l,port:r,user:a,password:d,schema:e.DBSchema})}else if(n||s){let l=e.DBPath;IsEmpty(l)||(l=l.replace(/\//g,"\\"),l.endsWith("\\")||(l+="\\"));let t=e.DBPhyPath.substr(e.DBPhyPath.lastIndexOf("\\")+1);if(s)u=Object.assign({},u,{user:a,password:d,relpath:l,dbname:t});else{t.toUpperCase().endsWith(".ACCDB");let e="Driver={Microsoft Access Driver (*.mdb, *.accdb)}";u=Object.assign({},u,{provider:e,relpath:l,dbname:t,password:d})}}else i&&(u=Object.assign({},u,{host:e.DBHost,port:r,user:a,password:d,dbname:e.DBName}));return u},global.LinkDbExist=e=>PROJ.LINKDBS.some((l=>l.DBID==e)),global.GetLinkDb=e=>PROJ.LINKDBS.find((l=>l.DBID==e)),global.GetDbId=e=>{let l=GetTableObject(e);return l&&"REPORT"==l.TblType&&""!=l.TblRptSrc&&(l=GetTableObject(l.TblRptSrc)),l&&"LINKTABLE"==l.TblType&&LinkDbExist(l.LinkDBID)?l.LinkDBID:"DB"},global.DbType=e=>{let l,t;if(""==e||"DB"==e)l=DB.DBType,t=DB.DBDBMSName;else{let a=GetLinkDb(e);l=a?a.DBType:DB.DBType,t=a?a.DBDBMSName:DB.DBDBMSName}return ContainsText(l,"MySQL")||ContainsText(t,"MySQL")?"MYSQL":ContainsText(l,"Access")||ContainsText(t,"Access")||ContainsText(t,"MS Jet")?"ACCESS":ContainsText(l,"Microsoft SQL Server")||ContainsText(t,"Microsoft SQL Server")?"MSSQL":ContainsText(l,"PostgreSQL")||ContainsText(t,"PostgreSQL")?"POSTGRESQL":ContainsText(l,"SQLITE")||ContainsText(t,"SQLITE")?"SQLITE":ContainsText(l,"Oracle")||ContainsText(t,"Ora")?"ORACLE":"UNKNOWN"},global.MultiPageFieldAttribute=(e,l,t)=>{let a=MultiPageFieldAttributeValue(e,l,t);return-1==a?"":` data-page="${a}"`},global.MultiPageFieldAttributeValue=(e,l,t)=>{let a=t||CONTROL,d=e||TABLE,r=l||FIELD,n=a.CtrlID.toLowerCase();return"add"==n&&r.FldAdd&&d.TblMultiPageAdd||"register"==n&&r.FldRegister&&PROJ.RegisterMultiPage||"edit"==n&&r.FldEdit&&d.TblMultiPageEdit||"search"==n&&r.FldSearch&&d.TblMultiPageSearch||"view"==n&&r.FldView&&d.TblMultiPageView?r.FldPageIndex:-1},global.IsDetailKeyField=(e,l)=>{let t=e||TABLE,a=l||FIELD;return MasterDetails.some((e=>{if(e.DetailTable==t.TblName){if(GetTableObject(e.MasterTable).TblGen)return e.Relations.some((e=>e.DetailField==a.FldName))}return!1}))},global.IsHiddenField=(e,l,t)=>{let a=e||TABLE,d=l||FIELD;if("HIDDEN"==d.FldHtmlTag){if("add"==t){let e=HasUserTable()&&!IsEmpty(DB.SecuUserIDFld)&&!IsEmpty(a.TblUserIDFld),l=!IsEmpty(d.FldDefault)||e&&a.TblUserIDFld==d.FldName,t=IsDetailKeyField(a,d);return l||t}if("edit"==t)return!0}return!1},global.IsAutoSuggest=e=>{let l=e||FIELD;return"TEXT"==l.FldHtmlTag&&"Table"==l.FldSelectType&&!IsEmpty(l.FldTagLnkTbl)&&!IsEmpty(l.FldTagLnkFld)&&!IsEmpty(l.FldTagLnkDisplay)},global.UseForLabel=e=>{let l=e||FIELD;return"TEXT"==l.FldHtmlTag&&!IsAutoSuggest(l)||"PASSWORD"==l.FldHtmlTag||"SELECT"==l.FldHtmlTag||"TEXTAREA"==l.FldHtmlTag&&!l.FldUseDHTMLEditor},global.HasUserTable=()=>("Both"==PROJ.SecType||"Use Table"==PROJ.SecType)&&""!=PROJ.SecTbl&&TABLES.some((e=>e.TblName==PROJ.SecTbl)),global.IsStaticUserLevel=()=>HasUserTable()&&!DB.UseDynamicUserLevel&&!IsEmpty(DB.SecUserLevelFld),global.IsDynamicUserLevel=()=>HasUserTable()&&DB.UseDynamicUserLevel&&!IsEmpty(DB.UserLevelTbl)&&!IsEmpty(DB.SecUserLevelFld),global.IsEmpty=e=>!IsValue(e)||""==String(e).trim(),global.GetFormObject=(e,l,t)=>{let a=l||CONTROL,d=t||TABLE,r=a.CtrlID.toLowerCase(),n="f";return"table"==a.CtrlType.toLowerCase()&&(n+=d.TblVar),n+=r,e&&"extbs"==e&&(n+="srch"),n},global.GetLanguageFieldProperty=(e,l,t,a)=>{let d=l||TABLE,r=t||FIELD,n=d.TblName,i=r.FldName,p="";if(r.hasOwnProperty(a)&&(p=r[a]),PROJ.MultiLanguage){let l=GetLanguageFieldPhrase(e,n,i,a);l&&""!=l&&(p=l)}return p},global.GetLanguageFieldPhrase=(e,l,t,a)=>{if(IsArray(PROJ.FieldPhrases))for(let d of PROJ.FieldPhrases)if(d.LanguageId==e&&d.TableName==l&&d.FieldName==t&&d.FieldAttribute==a)return d.Phrase;return""},global.CustomScriptRowCnt=()=>Code.write(CustomScriptRowVar()),global.CustomScriptRowStartVar=()=>Code.getName(PageObject,Code.StartRowCount),global.CustomScriptRowVar=()=>Code.getName(PageObject,Code.RowCount),global.CustomScriptVar=()=>Code.getName(Code.CustomScriptVar),global.CustomScriptId=(e,l,t)=>{let a="_"+e;switch(t&&(a=t+a),l){case"div":a="tpd"+a;break;case"template":a="tpm"+a;break;case"value":case"":a="tpx"+a;break;case"oldvalue":a="orig"+a;break;case"value2":a="tpy"+a;break;case"header":a="tpc"+a;break;case"operator":a="tpz"+a;break;case"operator2":a="tpw"+a;break;case"condition":a="tpv"+a;break;case"aggregate":a="tpg"+a;break;case"searchdiv":a="tpsd"+a;break;case"searchscript":a="tpsm"+a;break;case"searchcaption":a="tpsc"+a;break;case"current_filters":a="tp_current_filters";break;case"pagebreak":a="tpb"+a;break;case"sum":a="tpgs"+a;break;case"avg":a="tpga"+a;break;case"min":a="tpgn"+a;break;case"max":a="tpgx"+a;break;case"cnt":a="tpgc"+a;break;case"pagesum":a="tpps"+a;break;case"pageavg":a="tppa"+a;break;case"pagemin":a="tppn"+a;break;case"pagemax":a="tppx"+a;break;case"pagecnt":a="tppc"+a;break;case"grandsum":a="tpts"+a;break;case"grandavg":a="tpta"+a;break;case"grandmin":a="tptn"+a;break;case"grandmax":a="tptx"+a;break;case"grandcnt":a="tptc"+a;break;default:a="tp"+l+a}return a},global.CustomScriptTag=(e,l,t,a)=>`<template id="${CustomScriptId(e,l,a)}"${t=t?` class="${t}"`:""}>`,global.RemoveCustomPageTemplate=e=>{let l=1,t=new RegExp("\\{{3}(page_"+l+")\\}{3}([\\s\\S]*?)\\{{3}/\\1\\}{3}","i");for(;e.match(t);)e=e.replace(t,""),l+=1,t=new RegExp("\\{{3}(page_"+l+")\\}{3}([\\s\\S]*?)\\{{3}/\\1\\}{3}","i");return e},global.CastFieldForLike=(e,l)=>{let t=GetDbId(e.TblName),a=DbType(t),d=FieldSqlName(l,t),r=l.FldType,n=l.FldDtFormat;return[2,7].includes(GetFieldType(r))?(n=n||0,`CastDateFieldForLike("${Quote(d)}", ${n}, "${Quote(t)}")`):"MSSQL"==a&&1==GetFieldType(r)?`'CAST(${SingleQuote(d)} AS NVARCHAR)'`:"POSTGRESQL"!=a||3==GetFieldType(r)&&![114,3802,1560,1562].includes(l.NativeDataType)?`'${SingleQuote(d)}'`:`'CAST(${SingleQuote(d)} AS varchar(255))'`},global.ContainsText=(e,l)=>String(e).toLowerCase().includes(l.toLowerCase()),global.StartsText=(e,l)=>String(e).toLowerCase().startsWith(l.toLowerCase()),global.EndsText=(e,l)=>String(e).toLowerCase().endsWith(l.toLowerCase()),global.SameText=(e,l)=>String(e).toLowerCase()==String(l).toLowerCase(),global.HasTagValue=(e,l)=>{let t=FieldTagValues(e||FIELD);return!IsEmpty(t)&&t.split("|").some((e=>e.split(",")[0]==`"${l}"`))},global.FieldTagValues=e=>(e.FldTagValues||"").trim().replace(/\|$/,""),global.IsBinaryField=e=>[205,204,128].includes(e.FldType),global.GetTableObject=e=>TABLES.find((l=>l.TblName==e)),global.GetChartObject=(e,l)=>{let t=e||TABLE;return t&&IsArray(t.Charts)?t.Charts.find((e=>e.ChartName==l)):null},global.GetFieldObject=(e,l)=>{let t=e||TABLE;return t&&IsArray(t.Fields)?t.Fields.find((e=>e.FldName==l)):null},global.GetControlObject=(e,l)=>CONTROLS.find((t=>SameText(t.CtrlID,e)&&SameText(t.CtrlTagExt,l||""))),global.GetParentSelect=(e,l)=>{let t=e||FIELD,a="FldParentSelect"+(1==l?"":l);return t.hasOwnProperty(a)?t[a]:""},global.GetParentSelectTable=(e,l)=>{let t=e||FIELD,a="FldParentSelectTbl"+(1==l?"":l);return t.hasOwnProperty(a)?t[a]:""},global.GetSelectFilter=(e,l)=>{let t=e||FIELD;return l==t.FldParentSelect?t.FldSelectFilterFld:l==t.FldParentSelect2?t.FldSelectFilterFld2:l==t.FldParentSelect3?t.FldSelectFilterFld3:l==t.FldParentSelect4?t.FldSelectFilterFld4:""},global.GetExtensionPath=e=>{if(e&&e.Template){let l=gitPath||appDataPath,t=path.basename(e.Template,".zip"),a="extensions";return e.IsViewTemplate?a="customviewtags":e.IsEditTemplate&&(a="customedittags"),path.join(l,a,t)}return""},global.GetExtensionObject=e=>{let l=PROJ.Extensions.find((l=>SameText(l.Name,e)));return l&&l.PROJ&&!util.types.isProxy(l.PROJ)&&(l.PROJ=new Proxy(l.PROJ,PropertyHandler)),l};var _cnt=0;global.GetExtensionTable=(e,l)=>{let t=PROJ.Extensions.find((l=>SameText(l.Name,e)));if(t&&t.PROJ&&t.PROJ.DB){let e=t.PROJ.DB.Tables;if(e&&e.length){let t=e.findIndex((e=>e.TblName==l));if(t>-1)return util.types.isProxy(e[t])||(e[t]=new Proxy(e[t],PropertyHandler)),e[t]}}return null},global.GetExtensionChart=(e,l,t)=>{let a=GetExtensionTable(e,l);if(a){let e=a.Charts;if(e&&e.length){let l=e.findIndex((e=>e.ChartName==t));if(l>-1)return util.types.isProxy(e[l])||(e[l]=new Proxy(e[l],PropertyHandler)),e[l]}}return null},global.GetExtensionField=(e,l,t)=>{let a=GetExtensionTable(e,l);if(a){let e=a.Fields;if(e&&e.length){let l=e.findIndex((e=>e.FldName==t));if(l>-1)return util.types.isProxy(e[l])||(e[l]=new Proxy(e[l],PropertyHandler)),e[l]}}return null},global.GetObjectByName=e=>e&&global.hasOwnProperty(e)?global[e]:null,global.CssInherit=e=>e||"inherit",global.RowCountVar=e=>`x${Code.write(Code.getName(PageObject,Code.RowCount))}${e.substr(1)}`,global.RowCountVarQuoted=e=>`x" . ${Code.getName(Code.this,Code.RowCount)} . "${e.substr(1)}`,global.RowVar=e=>`x${Code.write(Code.getName(PageObject,Code.RowIndex))}${e.substr(1)}`,global.RowVarQuoted=e=>`x" . ${Code.getName(Code.this,Code.RowIndex)} . "${e.substr(1)}`,global.RowVarToQuoted=e=>e.replace(/<\?= (\$\w+\->RowIndex) \?>/,"{$1}"),global.AddSquareBrackets=(e,l)=>{let t=l||FIELD;return("SELECT"==t.FldHtmlTag&&t.FldSelectMultiple||"CHECKBOX"==t.FldHtmlTag)&&!e.endsWith("[]")?e+"[]":e},global.CLASS_INFIX="",global.CLASS_PREFIX="_",global.GetPageObject=(e,l,t)=>{let a=e?GetControlObject(e):GetControlObject(CONTROL.CtrlID,CONTROL.CtrlTagExt);if(!a)return"";let d=l||TABLE,r=(t||FIELD,a.CtrlID.toLowerCase()),n=a.CtrlType.toLowerCase(),i="";i=["table","report"].includes(n)?["dashboard","custom"].includes(r)?PascalCase(d.TblVar):PascalCase(d.TblVar)+CLASS_INFIX+PascalCase(r):PascalCase(r);let p=i.charCodeAt(0);return(p<65||p>122||p>90&&p<97&&95!=p)&&(i=CLASS_PREFIX+i),i},global.PascalCase=e=>changeCase.pascalCase(e,{transform:pascalCaseTransformMerge}).replace(/^(\d)/,"_$1"),global.NoCase=e=>changeCase.noCase(e,{delimiter:""}),global.JsBool=e=>e?"true":"false",global.SecurityCheck=(e,l,t,a)=>{let d=e.toLowerCase(),r=(a||TABLE).TblName;return t?"detail"==d?`$Security->allowList(CurrentProjectID() . '${SingleQuote(r)}')`:"detailview"==d?`$Security->allowView(CurrentProjectID() . '${SingleQuote(r)}')`:"detailadd"==d?`$Security->allowAdd(CurrentProjectID() . '${SingleQuote(r)}')`:"detailedit"==d?`$Security->allowEdit(CurrentProjectID() . '${SingleQuote(r)}')`:`$Security->can${e}()`:l?"$Security->isLoggedIn()":""},global.RandomIntInclusive=(e,l)=>Math.floor(Math.random()*(l-e+1))+e,global.RandomKey=()=>{try{let e=48,l=57,t=65,a=90,d=97,r=122,n=16,i="",p=0,s=0;for(;p!=n;){let n=Math.floor(9*Math.random()+2);s=n<=3?Math.floor((l-e+1)*Math.random()+e):n<=6?Math.floor((a-t+1)*Math.random()+t):Math.floor((r-d+1)*Math.random()+d),i+=String.fromCharCode(s),p+=1}return i}catch(e){throw e}},global.FolderPath=(e,l)=>{let t=CONTROLS.find((l=>SameText(l.CtrlID,e)&&SameText(l.CtrlType,"folder"))),a=t?t.CtrlOFolder:"";return l&&(a=IncludeTrailingSlash(a)),a},global.BaseName=(e,l)=>path.basename(e,l),global.ExtName=(e,l)=>path.extname(e,l),global.ReservedFileNames=["AdvancedFilter.php","AdvancedSearch.php","AdvancedSecurity.php","ApiPermissionMiddleware.php","Attributes.php","AuditTrailHandler.php","BasicSearch.php","Breadcrumb.php","CaptchaBase.php","CaptchaInterface.php","Cars.php","ChartExporter.php","ChartJsRenderer.php","ChartRendererInterface.php","ChartTypes.php","CorsMiddleware.php","CrosstabColumn.php","CrosstabTable.php","DbChart.php","DbField.php","DbHelper.php","DbTable.php","DbTableBase.php","DebugSqlLogger.php","Email.php","ExportBase.php","ExportCsv.php","ExportEmail.php","ExportExcel.php","ExportExcel2007.php","ExportExcel5.php","ExportHtml.php","ExportJson.php","ExportPdf.php","ExportPhpWord.php","ExportWord.php","ExportXml.php","FileUploadHandler.php","FileViewer.php","HttpErrorHandler.php","HttpForm.php","HttpUpload.php","JwtMiddleware.php","Language.php","LdapConn.php","ListAction.php","ListActions.php","ListOption.php","ListOptions.php","ListOptionsArray.php","Lookup.php","Menu.php","MenuItem.php","NumericPager.php","OptionValues.php","Pager.php","PagerItem.php","PasswordHash.php","PermissionMiddleware.php","PhpBarcode.php","PhpCaptcha.php","PhpEncryption.php","PrevNextPager.php","ReCaptcha.php","Recordset.php","ReportField.php","ReportTable.php","SessionHandler.php","ShutdownHandler.php","SubPage.php","SubPages.php","SummaryField.php","Tea.php","Timer.php","UploadHandler.php","UserProfile.php","XmlDocument.php","apiroutes.php","config.development.php","config.php","config.production.php","constants.php","definitions.php","filemanager.php","phpfn.php","routes.php","userfn.php","userlevelsettings.php"],global.GetFileName=(e,l,t,a)=>{try{l=l||"",t=!IsBoolean(t)||t;let d=IsObject(e)?e:GetControlObject(e,l);if(!d)return"";let r="",n=a||TABLE,i=d.CtrlID,p=d.CtrlType,s=d.CtrlIFolder,o=d.CtrlIFiles,_=d.CtrlExt,c=ConvertPath(d.CtrlOFolderID),u=IsEmpty(c)?d.CtrlOFolder:FolderPath(c),g=ConvertPath(d.CtrlOFile),f=d.CtrlOExt;if(g||f){if(!g&&f&&!SameText(i,"info")&&!SameText(p,"report")){let e=ExtName(o);g=BaseName(o,e),["simple","other"].includes(p.toLowerCase())&&SameText(c,"_views")&&(g=PascalCase(i))}}else{let e=ExtName(o);g=BaseName(o,e),["simple","other"].includes(p.toLowerCase())&&SameText(l,"class")&&SameText(c,"_models")&&(g=PascalCase(i)),f=e.replace(".","")}if(SameText(p,"table"))r=PascalCase(n.TblVar);else if(SameText(p,"report"))if(SameText(e,"custom")){if(!EndsText(n.TblName,".php")||!n.IncludeFiles){let e=ExcludeTrailingPathDelimiter(n.OutputFolder.trim());if(t&&e){if(["models","views"].includes(e)&&(e="src"),"src"==e&&ReservedFileNames.includes(n.TblName))throw new Error(`The file name '${n.TblName}' is reserved, please change the file name of your Custom File.`);return GetRootRelativePath()+IncludeTrailingSlash(e)+n.TblName}return n.TblName}r=PascalCase(n.TblVar),f="php"}else r=PascalCase(n.TblVar);else r="";if(r+=g,IsEmpty(r)||IsEmpty(f))if(SameText(p,"copy")){if(s&&!IsEmpty(c))return u;if(IsEmpty(o)){if(!IsEmpty(s))return u}else{let e=_?GetExtensionObject(_):null,l=e?GetPath().join(GetExtensionPath(e),o):GetPath().join(templatePath,o),t=fs.statSync(l);if(t.isFile())r=o;else if(t.isDirectory())return u}}else".htaccess"==r||(r="");else r+="."+f;if(!IsEmpty(r)){let e=RelativeFolder(u);!IsEmpty(e)&&t&&(r=ConvertPath(e)+r)}return r}catch(e){throw e}},global.GetRouteUrl=(e,l,t)=>{let a="",d=l||TABLE,r=IsObject(e)?e:GetControlObject(e,"");r||(r=GetControlObject(e,"class"));let n=r&&r.CtrlType?r.CtrlType:"";if(a=["summary","crosstab","dashboard"].includes(e)?d.TblVar:GetFileName(e,"",!1,d),a||(a=GetFileName(e,"class",!1,d)),!a)return"";if(a=a.replace(/\.php$/i,""),a=["other","simple"].includes(n)?a.toLowerCase():PascalCase(a),"custom"==e&&d.IncludeFiles&&d.OutputFolder){let e=d.OutputFolder;e.startsWith("/")&&(e=e.substring(1)),a=IncludeTrailingSlash(e)+a}return PROJ.OutputNameLCase&&(a=a.toLowerCase()),t&&(a+=t),a},global.ConvertPath=e=>e?e.replace(/\{(\w+)(?:\.(\w+))?\}/g,(function(e,l,t){var a=GetObjectByName(l);return IsObject(a)&&null!=t&&a.hasOwnProperty(t)&&(a=a[t]),null!=a?a:!t&&l&&l.startsWith("_")?FolderPath(l):""})).replace(/^\/+/g,""):"",global.RelativeFolder=(e,l)=>{let t=l||CONTROL,a=t.CtrlOFolderID?FolderPath(t.CtrlOFolderID):t.CtrlOFolder;if(a&&(a=IncludeTrailingSlash(a)),e&&(e=IncludeTrailingSlash(e)),!IsEmpty(a)&&!SameText(a,e)){if(StartsText(a,e))return GetRelativePath(a,e);if(IsEmpty(a)||IsEmpty(e)){let l=GetDestinationPath();return IsEmpty(l)||(l="/"+l),l+e}return GetParentPath(a)+e}return e},global.OutputRelativePath=e=>{let l=IncludeTrailingSlash(e),t=GetDestinationPath();return t&&StartsText(l,t)&&(l=l.substr(t.length),t=""),GetParentPath(t)+l},global.DestinationRelativePath=e=>{let l=IncludeTrailingSlash(e),t=GetDestinationPath();return t&&StartsText(l,t)&&(l=l.substr(t.length),t=""),GetParentPath(l)+t},global.GetParentPath=e=>(e=IncludeTrailingSlash(e),"../".repeat(e.split("/").length-1)),global.GetRootRelativePath=()=>{let e=PROJ.RootRelativePath,l="."==e?"":e;if(l=IncludeTrailingSlash(l),!l.match(/^[\.\/]*$/))throw new Error(`Invalid root relative path: ${e}`);return l},global.GetDestinationPath=()=>{let e=PROJ.Destination,l=path.join(e,PROJ.RootRelativePath);return GetRelativePath(l,e)},global.GetRelativePath=(e,l)=>{let t=path.relative(e,l).replace(/\\/g,"/");return t.startsWith("..")&&(t=""),IncludeTrailingSlash(t)},global.RemoveQuotes=e=>{let l=String(e).trim().match(/^(['"])(.*?)\1$/);return l?l[2].replace(new RegExp(l[1]+l[1],"g"),l[1]):e},global.DoubleQuote=e=>'"'+RemoveQuotes(e).replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"',global.Quote=e=>String(e).replace(/\\/g,"\\\\").replace(/\"/g,'\\"'),global.SingleQuote=e=>String(e).replace(/\\/g,"\\\\").replace(/'/g,"\\'"),global.GetFieldType=e=>{switch(e){case 20:case 3:case 2:case 16:case 4:case 5:case 131:case 6:case 17:case 18:case 19:case 21:case 139:return 1;case 7:case 133:case 135:case 146:return 2;case 134:case 145:return 7;case 201:case 203:case 129:case 130:case 200:case 202:case 141:return 3;case 11:return 4;case 72:return 5;default:return 6}},global.BoolFieldTagValues=(e,l,t)=>{let a=t||TABLE,d=GetDbId(a.TblName);return IsEmpty(l)&&11==e?"ACCESS"==DbType(d)?'"Yes","Yes"|"No","No"':'"1","Yes"|"0","No"':l},global.SqlPart=(e,l)=>{let t=["SELECT","FROM","WHERE","GROUP BY","HAVING","ORDER BY","LIMIT"],a=e.trim().replace(/\s/g," ").replace(/;*$/,"").replace(/ +/g," "),d=e=>{let l=0;for(let t of e)if("("==t)l++;else if(")"==t){if(0==l)return!1;l--}return 0==l},r=(e,l)=>{let t,r=l;for(;!(t||(r=a.toUpperCase().indexOf(" "+e.toUpperCase()+" ",r),r<0));){if(t=d(a.substr(0,r)))return r;r+=e.length}return-1};for(;/^\([\s\S]+\)$/.test(a);){let e=a.substr(1,a.length-2).trim();if(!d(e))break;a=e}a=" "+a;let n="",i=t.indexOf(l.toUpperCase());if(i>-1){let e=r(l,0);if(e>-1){let d=-1;for(let l=i+1,a=t.length;l<a&&(d=r(t[l],e),!(d>-1));l++);n=a.substr(e+l.length+2,d>-1?d-(e+l.length+2):void 0)}}return n},global.RecordsPerPageList=(e,l)=>{if(IsEmpty(e))return"";{let t=!1,a=e.split(",");a.push(String(l)),a=a.filter((e=>SameText(e,"all")?(t=!0,!1):IsNumber(parseInt(e)))).sort(((e,l)=>parseInt(e)-parseInt(l))).filter(((e,l,t)=>t.indexOf(e)==l));let d=a.join(",");return t&&(d+=",-1"),d}},global.IsLinkTableField=e=>{let l=e||FIELD;return"Table"==l.FldSelectType&&!IsEmpty(l.FldTagLnkTbl)&&!IsEmpty(l.FldTagLnkFld)&&!IsEmpty(l.FldTagLnkDisplay)},global.IsLookupField=(e,l)=>{let t=e||FIELD,a=l||TABLE;return["summary","crosstab"].includes(a.TblReportType)&&IsDateFilter(t)||IsLinkTableField(t)&&["TEXT","SELECT","RADIO","CHECKBOX"].includes(t.FldHtmlTag)||"Table"!=t.FldSelectType&&!IsEmpty(FieldTagValues(t))&&["SELECT","RADIO","CHECKBOX"].includes(t.FldHtmlTag)},global.IsSelfLookupField=(e,l)=>{let t=e||FIELD,a=l||TABLE;return IsLinkTableField(t)&&t.FldTagLnkTbl==a.TblName&&t.FldTagLnkFld==t.FldName&&t.FldTagLnkFld==t.FldTagLnkDisplay&&IsEmpty(t.FldTagLnkDisp2)&&IsEmpty(t.FldTagLnkDisp3)&&IsEmpty(t.FldTagLnkDisp4)},global.IsEncryptField=e=>{let l=e||FIELD;return 3==GetFieldType(l.FldType)&&!l.FldIsPrimaryKey},global.IsFloatFormatField=e=>{let l=e||FIELD;return[4,5,131,6].includes(l.FldType)&&"TEXT"==l.FldHtmlTag&&!IsLinkTableField(l)},global.IsVirtualLookupField=e=>{let l=e||FIELD;return l.FldVirtualLookup&&"Table"==l.FldSelectType&&!IsEmpty(l.FldTagLnkTbl)&&!IsEmpty(l.FldTagLnkFld)&&!IsEmpty(l.FldTagLnkDisplay)&&IsEmpty(l.FldSelectFilter)},global.IsForceSelectField=e=>{let l=e||FIELD;return"TEXT"!=l.FldHtmlTag||l.FldSelectForceSelection},global.VirtualLookupFieldSql=(e,l,t,a)=>{let d=a||TABLE,r=l||FIELD,n=DbType(t),i=GetTableObject(r.FldTagLnkTbl),p=QuotedName("TMP_LOOKUPTABLE",t),s="",o="",_="",c=GetLanguageFieldProperty(e,d,r,"FldTagLnkDisplay"),u=GetLanguageFieldProperty(e,d,r,"FldTagLnkDisp2"),g=GetLanguageFieldProperty(e,d,r,"FldTagLnkDisp3"),f=GetLanguageFieldProperty(e,d,r,"FldTagLnkDisp4"),m=!IsEmpty(u)||!IsEmpty(g)||!IsEmpty(f),b=QuotedName(c,t);if(m&&"MSSQL"==n&&(b=`CONVERT(NVARCHAR(MAX),${b})`),s=Quote(b),IsEmpty(u)||(b=QuotedName(u,t),"MSSQL"==n&&(b=`CONVERT(NVARCHAR(MAX),${b})`),s=SqlConcatName(i,s,Quote(b),r,1)),IsEmpty(g)||(b=QuotedName(g,t),"MSSQL"==n&&(b=`CONVERT(NVARCHAR(MAX),${b})`),s=SqlConcatName(i,s,Quote(b),r,2)),IsEmpty(f)||(b=QuotedName(f,t),"MSSQL"==n&&(b=`CONVERT(NVARCHAR(MAX),${b})`),s=SqlConcatName(i,s,Quote(b),r,3)),o="CUSTOMVIEW"==i.TblType?"("+i.TblCustomSQL+") "+p:SqlTableName(i,t)+" "+p,_=p+"."+QuotedName(r.FldTagLnkFld,t)+" = ","CUSTOMVIEW"==d.TblType)_+=FieldSqlName(r,t);else{let e="LINKTABLE"==d.TblType?d.LinkTableName:d.TblName;_+=QuotedName(e,t)+"."+QuotedName(r.FldName,t)}let F="(SELECT ";return r.FldTagLnkDistinct&&(F+="DISTINCT "),["ACCESS","MSSQL"].includes(n)&&(F+="TOP 1 "),F+=s+" FROM "+Quote(o)+" WHERE "+Quote(_),["MYSQL","POSTGRESQL"].includes(n)&&(F+=" LIMIT 1"),F+=")",F},global.VirtualLookupFieldName=(e,l)=>{let t="EV__"+(e||FIELD).FldParm,a=DbType(l);return t.length>30&&"ORACLE"==a&&(t=t.substr(0,30)),t},global.EscapeRegExChars=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),global.QuotedName=(e,l)=>{let t=DB.DBQuoteS,a=DB.DBQuoteE;if(!IsEmpty(l)&&"DB"!=l){let e=GetLinkDb(l);e&&(t=e.DBQuoteS,a=e.DBQuoteE)}return t+e.replace(new RegExp(EscapeRegExChars(a)),a+a)+a},global.SqlConcatName=(e,l,t,a,d)=>{let r,n=e||TABLE,i=a||FIELD,p=GetDbId(n.TblName),s=DbType(p);return r="ACCESS"==s?l+' & \\"%i\\" & '+t:"MSSQL"==s?l.startsWith("CONCAT(")&&l.endsWith(")")?"CONCAT("+l.substr(7,l.length-8)+",'%i',"+t+")":"CONCAT("+l+",'%i',"+t+")":"MYSQL"==s?l.startsWith("CONCAT(")&&l.endsWith(")")?"CONCAT("+l.substr(7,l.length-8)+",'%i',COALESCE("+t+",''))":"CONCAT(COALESCE("+l+", ''),'%i',COALESCE("+t+",''))":["POSTGRESQL","ORACLE","SQLITE"].includes(s)?l+" || '%i' || "+t:l+' & "%i" & '+t,r.replace("%i",'" . ValueSeparator('+d+", $this->"+i.FldParm+') . "')},global.FieldSqlName=(e,l)=>{let t=e||FIELD;return t.FldIsCustom?""!=t.FldSQL?t.FldSQL:"''":IsEmpty(t.FldSourceName)||t.FldSourceName==t.FldName?QuotedName(t.FldName,l):t.FldSourceName},global.CustomViewFieldName=(e,l)=>{let t=e||FIELD,a="";a=IsEmpty(t.FldSourceName)||t.FldSourceName==t.FldName?QuotedName(t.FldName,l):t.FldSourceName;let d=a.split(".");return QuotedName("TMP_LOOKUPTABLE",l)+"."+d[d.length-1]},global.VirtualTableInCustomView=(e,l,t)=>{let a=" "+SqlPart(e,"FROM")+" ";return a=a.toUpperCase(),a.includes(" "+l.toUpperCase()+" ")||a.includes(" "+QuotedName(l.toUpperCase(),t)+" ")},global.EncodeName=e=>{let l="";for(let t of e)/[a-zA-Z0-9]/.test(t)?l+=t:l+=" "==t?"_":t.toString(16);return l},global.SameControlId=(e,l)=>NoCase(e)==NoCase(l),global.CodeBaseExist=(e,l,t)=>PROJ.CodeBase.Codes.some((a=>SameText(a.ScriptType,e)&&SameText(a.CodeType,l)&&SameText(a.CodeName,t))),global.CodeBaseItem=(e,l,t)=>PROJ.CodeBase.Codes.find((a=>SameText(a.ScriptType,e)&&SameText(a.CodeType,l)&&SameText(a.CodeName,t))),global.CustomScriptExist=(e,l,t,a,d,r)=>PROJ.CustomScripts.some((n=>SameText(n.ScriptType,e)&&SameText(n.ScriptCodeType,l)&&SameText(n.ScriptName,t)&&SameControlId(n.ScriptCtrlID,a)&&n.ScriptL1Key==d&&n.ScriptL2Key==r)),global.ScriptItem=(e,l,t,a,d,r)=>PROJ.CustomScripts.find((n=>SameText(n.ScriptType,e)&&SameText(n.ScriptCodeType,l)&&SameText(n.ScriptName,t)&&SameControlId(n.ScriptCtrlID,a)&&n.ScriptL1Key==d&&n.ScriptL2Key==r)),global.ParseJson=(e,l)=>{try{return IsString(e)?JSON.parse(e,l):e}catch(e){return null}},global.GetFieldJsonTypeName=e=>{switch(e){case 20:case 3:case 2:case 16:case 4:case 5:case 131:case 6:case 17:case 18:case 19:case 21:case 139:return"number";case 7:case 133:case 135:case 146:return"string";case 134:case 145:return"string";case 201:case 203:case 129:case 130:case 200:case 202:case 141:return"string";case 11:return"boolean";case 72:return"string";case 204:case 205:default:return"string"}},global.GetFieldTypeName=e=>{switch(e){case 20:case 3:case 2:case 16:case 4:case 5:case 131:case 6:case 17:case 18:case 19:case 21:case 139:return"DATATYPE_NUMBER";case 7:case 133:case 135:case 146:return"DATATYPE_DATE";case 134:case 145:return"DATATYPE_TIME";case 201:case 203:return"DATATYPE_MEMO";case 129:case 130:case 200:case 202:case 141:return"DATATYPE_STRING";case 11:return"DATATYPE_BOOLEAN";case 72:return"DATATYPE_GUID";case 204:case 205:return"DATATYPE_BLOB";default:return"DATATYPE_OTHER"}},global.GetReturnPage=e=>{if(e.startsWith("_"))switch(e.substr(1).toLowerCase()){case"view":return"$this->GetViewUrl()";case"edit":return"$this->GetEditUrl()";case"add":return"$this->GetAddUrl()";case"copy":return"$this->GetCopyUrl()";case"delete":return"$this->GetDeleteUrl()";default:return DoubleQuote(GetRouteUrl(e.substr(1)))}return e},global.GetFieldValue=(e,l,t)=>4==GetFieldType(t)?`(ConvertToBool(${l}) ? "1" : "0")`:l,global.UseAddOption=()=>TABLES.some((e=>e.TblAddOpt)),global.UseEmailExport=()=>TABLES.some((e=>e.TblGen&&(!e.TblUseGlobal&&e.TblExportEmail||PROJ.ExportEmail))),global.UseModalLookup=()=>TABLES.some((e=>e.Fields.some((e=>e.FldModalLookup)))),global.IsExport=()=>TABLES.some((e=>e.TblGen&&(e.TblUseGlobal?PROJ.PrinterFriendly||PROJ.ExportHtml||PROJ.ExportWord||PROJ.ExportExcel||PROJ.ExportXml||PROJ.ExportCsv||PROJ.ExportEmail||PROJ.ExportPDF:e.TblPrinterFriendly||e.TblExportHtml||e.TblExportWord||e.TblExportExcel||e.TblExportXml||e.TblExportCsv||e.TblExportEmail||e.TblExportPDF))),global.IsImport=()=>TABLES.some((e=>e.TblImport)),global.UseTooltip=()=>!0,global.IsMasterDetail=(e,l)=>MasterDetails.some((t=>t.DetailTable==l&&t.MasterTable==e)),global.IsRelated=(e,l,t)=>{t=t||[];let a=JSON.stringify([e,l]);if(t.includes(a))return!1;if(t.push(a),IsMasterDetail(e,l))return!0;let d=MasterDetails.filter((e=>e.DetailTable==l&&e.MasterTable!=l));for(let l of d)if(IsRelated(e,l.MasterTable,t))return!0;return!1},global.IsRequiredField=(e,l)=>{let t=l||TABLE,a=e||FIELD,d=PROJ.ValidateNotNull,r=(a.FldReq&&IsEmpty(a.FldDbDefault)&&d&&!(IsBooleanField(t,a)&&"CHECKBOX"==a.FldHtmlTag)||a.FldRequired)&&IsEmpty(a.FldAutoUpdateValue)&&!a.FldAutoIncrement&&!["NO","HIDDEN"].includes(a.FldHtmlTag);return r||t.TblName!=PROJ.SecTbl||(a.FldName==PROJ.SecPasswdFld||a.FldName==PROJ.SecLoginIDFld||PROJ.SecRegisterEmail&&a.FldName==PROJ.SecEmailFld)&&(r=!0),r},global.IsBooleanField=(e,l)=>{let t=e||TABLE,a=l||FIELD,d=GetDbId(t.TblName),r=DbType(d);if(["MYSQL","ORACLE"].includes(r)){if("MYSQL"==r&&247==a.NativeDataType||"ORACLE"==r){let e=FieldTagValues(a).split("|");if(0==e.length||2!=e.length)return!1;let l=e[0].split(","),t=e[1].split(","),d=[l[0],t[0]].sort().join();if('"N","Y"'==d)return TrueValue="Y",FalseValue="N",!0;if('"n","y"'==d)return TrueValue="y",FalseValue="n",!0;if('"0","1"'==d)return TrueValue="1",FalseValue="0",!0}else{if("MYSQL"==r&&1==a.NativeDataType&&1==a.FldSize&&"CHECKBOX"==a.FldHtmlTag)return TrueValue="1",FalseValue="0",!0;if("MYSQL"==r&&16==a.NativeDataType&&1==a.FldSize)return TrueValue="1",FalseValue="0",!0}return!1}return("POSTGRESQL"==r&&[1560,1562].includes(a.NativeDataType)&&1==a.FldSize||"SQLITE"==r&&601==a.NativeDataType&&"CHECKBOX"==a.FldHtmlTag||11==a.FldType)&&(TrueValue="1",FalseValue="0",!0)},global.IsValidateText=e=>{let l=e||FIELD;return IsEmpty(l.FldAutoUpdateValue)&&["TEXT","PASSWORD"].includes(l.FldHtmlTag)&&!IsVirtualLookupField(l)&&(IsFieldList(l)&&!l.FldHtmlTagReadOnly||IsFieldAdd(l)||IsFieldAddOption(l)||IsFieldRegister(l)||IsFieldEdit(l)&&!l.FldHtmlTagReadOnly||IsFieldUpdate(l)&&!l.FldHtmlTagReadOnly)},global.IsValidateFile=e=>{let l=e||FIELD;return"FILE"==l.FldHtmlTag&&(IsFieldList(l)&&!l.FldHtmlTagReadOnly||IsFieldAdd(l)||IsFieldAddOption(l)||IsFieldRegister(l)||IsFieldEdit(l)&&!l.FldHtmlTagReadOnly||IsFieldUpdate(l)&&!l.FldHtmlTagReadOnly)},global.IsValidateSearch=(e,l)=>{let t=e||FIELD,a=l||TABLE;return!(["summary","crosstab"].includes(a.TblReportType)&&IsDateFilter(t))&&["TEXT","NO"].includes(t.FldHtmlTag)&&!IsVirtualLookupField(t)&&(IsFieldExtendedSearch(t)||IsFieldAdvancedSearch(t))&&"EMAIL"!=t.FldValidate},global.IsValidateServer=e=>PROJ.ServerValidate||["PASSWORD","EMAIL","DATE","TIME","FLOAT","RANGE","INTEGER","USPHONE","USZIP","CREDITCARD","USSSN","GUID"].includes((e||FIELD).FldValidate),global.ValidatorFn=e=>{let l=CONTROL.CtrlID.toLowerCase(),t=IsEmpty(e.FldClientValidateArgs)?"":", "+e.FldClientValidateArgs,a=[];if(e.FldCheckPasswordStrength&&a.push("passwordStrength"),"register"==l&&(e.FldName==PROJ.SecLoginIDFld&&a.push(`username(fields.${e.FldParm}.raw)`),e.FldName==PROJ.SecPasswdFld&&a.push(`password(fields.${e.FldParm}.raw)`)),TABLE.TblName==DB.UserLevelTbl&&isDynamicUserLevel&&(e.FldName==DB.UserLevelIdFld&&a.push("userLevelId"),e.FldName==DB.UserLevelNameFld)){let e=GetFieldObject(TABLE,DB.UserLevelIdFld);a.push(`userLevelName('${e.FldParm}')`)}let d="",r=e.FldDtFormat,n=e.FldValidate;switch(IsCrosstabYearField(TABLE,e)&&(n="INTEGER"),n){case"PASSWORD":d=`password(fields.${e.FldParm}.raw)`;break;case"EMAIL":d="email";break;case"DATE":d=`datetime(${r})`;break;case"TIME":d="time";break;case"FLOAT":d="float";break;case"RANGE":d=`range(${IsValue(e.FldMin)?e.FldMin:"null"}, ${IsValue(e.FldMax)?e.FldMax:"null"})`;break;case"INTEGER":d="integer";break;case"USPHONE":d="phone";break;case"USZIP":d="zip";break;case"CREDITCARD":d="creditCard";break;case"USSSN":d="ssn";break;case"GUID":d="guid";break;case"REGEX":IsEmpty(e.FldClientValidateArgs)||(d=`regex(${e.FldClientValidateArgs})`);break;default:IsEmpty(e.FldValidate)||(d=`custom(${e.FldValidate}${t})`)}return d&&!a.includes(d)&&a.push(d),a.length&&"update"==l&&a.push("selected"),a.map((e=>"ew.Validators."+e)).join(", ")},global.IsFieldList=(e,l)=>(e||FIELD).FldList&&["list","master","info","grid","preview"].includes((l||CONTROL).CtrlID.toLowerCase()),global.IsFieldReport=(e,l)=>(e||FIELD).FldList&&"report"==(l||CONTROL).CtrlType.toLowerCase(),global.IsFieldBasicSearch=e=>{let l=e||FIELD;return l.FldList&&l.FldBasicSearch},global.IsFieldExtendedSearch=e=>{let l=e||FIELD;return l.FldList&&l.FldExtendedBasicSearch},global.IsFieldAdvancedSearch=(e,l)=>(e||FIELD).FldSearch&&"search"==(l||CONTROL).CtrlID.toLowerCase(),global.IsFieldUpdatable=e=>{let l=e||FIELD;return 4==(4&l.FldAttribute)||8==(8&l.FldAttribute)||l.FldIsCustom},global.IsFieldView=(e,l)=>(e||FIELD).FldView&&"view"==(l||CONTROL).CtrlID.toLowerCase(),global.IsFieldAdd=(e,l)=>(e||FIELD).FldAdd&&"add"==(l||CONTROL).CtrlID.toLowerCase(),global.IsFieldAddOption=(e,l)=>(e||FIELD).FldAddOpt&&"addopt"==(l||CONTROL).CtrlID.toLowerCase(),global.IsFieldEdit=(e,l)=>(e||FIELD).FldEdit&&"edit"==(l||CONTROL).CtrlID.toLowerCase(),global.IsFieldDelete=(e,l)=>(e||FIELD).FldList&&"delete"==(l||CONTROL).CtrlID.toLowerCase(),global.IsFieldUpdate=(e,l)=>(e||FIELD).FldMultiUpdate&&"update"==(l||CONTROL).CtrlID.toLowerCase(),global.IsFieldRegister=(e,l)=>(e||FIELD).FldRegister&&"register"==(l||CONTROL).CtrlID.toLowerCase(),global.IsCustomField=e=>(e||FIELD).FldIsCustom,global.ActivateFieldValue=(e,l)=>{let t,a=e||TABLE,d=l||FIELD,r=GetDbId(a.TblName);switch(GetFieldType(d.FldType)){case 4:t="1","ACCESS"==DbType(r)?t="True":"POSTGRESQL"==DbType(r)&&(t="true");break;case 1:t=1;break;default:t=247==d.NativeDataType?HasTagValue(d,"Y")?"Y":"1":"Y"}return t},global.FieldStyle=(e,l)=>{let t=e||FIELD,a=l||TABLE,d=(t.FldColumnWidth||"").trim(),r="";if(IsEmpty(d)||(d.match(/^[\d\.]+$/)?r="min-width: "+d+"px;":d.match(/^[\d\.]+(px|rem|rem|%)$/)?r="min-width: "+d+";":IsString(d)&&(r=d,r&&!r.endsWith(";")&&(r+=";"))),t.FldColumnWrap||(IsEmpty(r)||(r+=" "),r+="white-space: nowrap;"),a&&"REPORT"==a.TblType&&"crosstab"==a.TblReportType&&a.CrosstabSummaryFields){a.CrosstabSummaryFields.split("||").includes(t.FldName)&&(IsEmpty(t.FldAlign)||(r&&!r.endsWith(";")&&(r+=";"),IsEmpty(r)||(r+=" "),r+=`text-align: ${t.FldAlign};`))}return r},global.FieldHeaderAttributes=e=>{let l=e||FIELD,t=FieldStyle(l);return IsEmpty(t)||(t=` style="${t}"`),t},global.SqlTableName=(e,l)=>{let t,a=e||TABLE;return"LINKTABLE"==a.TblType&&a.LinkTableName.includes(".")?a.LinkTableName:(t="LINKTABLE"==a.TblType?QuotedName(a.LinkTableName,l):QuotedName(a.TblName,l),IsEmpty(a.TblSchema)||(t=QuotedName(a.TblSchema,l)+"."+t),t)},global.BuildCondition=(e,l,t)=>{if(!IsEmpty(t)){if(!IsEmpty(e)){let a=e+" "+l+" ";return a+=t,"||"==l.toLowerCase()&&(a="("+a+")"),a}return t}return e},global.GetProjectCssFileName=()=>{let e=PROJ.ProjVar+".css",l=FolderPath("_css");return PROJ.OutputNameLCase&&(e=e.toLowerCase()),IsEmpty(l)||(e=IncludeTrailingSlash(l)+e),e},global.CharsetToIconvEncoding=e=>{if(!e)return"";switch(e.toLowerCase()){case"iso-8859-6":return"ISO-8859-6";case"x-mac-arabic":return"MacArabic";case"windows-1256":return"CP1256";case"iso-8859-4":return"ISO-8859-4";case"windows-1257":return"CP1257";case"ibm852":return"CP852";case"iso-8859-2":return"ISO-8859-2";case"x-mac-ce":return"MacCentralEurope";case"windows-1250":return"CP1250";case"gb2312":case"hz-gb-2312":return"GBK";case"big5":return"BIG5";case"cp866":return"CP866";case"iso-8859-5":return"ISO-8859-5";case"koi8-r":return"KOI8-R";case"koi8-u":return"KOI8-U";case"x-mac-cyrillic":return"MacCyrillic";case"windows-1251":return"CP1251";case"iso-8859-7":return"ISO-8859-7";case"x-mac-greek":return"MacGreek";case"windows-1253":return"CP1253";case"iso-8859-8-i":case"iso-8859-8":return"ISO-8859-8";case"x-mac-hebrew":return"MacHebrew";case"windows-1255":return"CP1255";case"x-mac-icelandic":return"MacIceland";case"euc-jp":return"EUC-JP";case"iso-2022-jp":return"ISO-2022-JP";case"shift_jis":return"SHIFT_JIS";case"euc-kr":return"EUC-KR";case"iso-2022-kr":return"ISO-2022-KR";case"Johab":return"JOHAB";case"iso-8859-3":return"ISO-8859-3";case"iso-8859-15":return"ISO-8859-15";case"windows-874":return"CP874";case"ibm857":return"CP857";case"iso-8859-9":return"ISO-8859-9";case"x-mac-turkish":return"MacTurkish";case"windows-1254":return"CP1254";case"utf-16":return"UTF-16";case"utf-8":return"UTF-8";case"windows-1258":return"CP1258";case"ibm850":return"CP850";case"iso-8859-1":return"ISO-8859-1";case"macintosh":return"Macintosh";case"windows-1252":return"CP1252";default:return""}},global.CharsetToMySqlCharset=e=>{if(!e)return"";switch(e.toLowerCase()){case"windows-1256":return"cp1256";case"windows-1257":return"cp1257";case"ibm852":return"cp852";case"iso-8859-2":return"latin2";case"x-mac-ce":return"macce";case"windows-1250":return"cp1250";case"gb2312":return"gb2312";case"big5":return"big5";case"cp866":return"cp866";case"koi8-r":return"koi8r";case"koi8-u":return"koi8u";case"windows-1251":return"cp1251";case"iso-8859-7":return"greek";case"iso-8859-8-i":case"iso-8859-8":return"hebrew";case"x-mac-icelandic":return"";case"euc-jp":return"ujis";case"shift_jis":return"sjis";case"euc-kr":return"euckr";case"iso-8859-9":return"latin5";case"utf-16":return"ucs2";case"utf-8":return"utf8";case"ibm850":return"cp850";case"iso-8859-1":return"latin1";case"macintosh":return"macroman";case"windows-1252":return"latin1";default:return""}},global.CharsetToPostgreSqlCharset=e=>{if(!e)return"";switch(e.toLowerCase()){case"iso-8859-6":return"ISO_8859_6";case"windows-1256":return"WIN1256";case"windows-1257":return"WIN1257";case"windows-1250":return"WIN1250";case"big5":return"BIG5";case"cp866":return"WIN866";case"iso-8859-5":return"ISO_8859_5";case"koi8-r":return"KOI8R";case"koi8-u":return"KOI8U";case"windows-1251":return"WIN1251";case"iso-8859-7":return"ISO_8859_7";case"windows-1253":return"WIN1253";case"iso-8859-8":return"ISO_8859_8";case"windows-1255":return"WIN1255";case"euc-jp":return"EUC_JP";case"shift_jis":return"SJIS";case"euc-kr":return"EUC_KR";case"Johab":return"JOHAB";case"windows-874":return"WIN874";case"windows-1254":return"WIN1254";case"utf-8":return"UTF8";case"windows-1258":return"WIN1258";case"iso-8859-1":return"LATIN1";case"windows-1252":return"WIN1252";default:return""}},global.GetOracleServiceName=e=>{let l="",t=e.toUpperCase().indexOf("DATA SOURCE=");if(t>0){t+=12;let a=e.indexOf(";",t);l=a>t?e.substr(t,a-t):e.substr(t)}return l},global.GetMenuItems=e=>{let l=PROJ.SecType&&"None"!=PROJ.SecType,t=HasUserTable(),a=t&&!DB.UseDynamicUserLevel&&!IsEmpty(DB.SecUserLevelFld),d=t&&DB.UseDynamicUserLevel&&!IsEmpty(DB.UserLevelTbl)&&!IsEmpty(DB.SecUserLevelFld),r=a||d,n=[],i=function(e){if(e.MenuNavbar)return!0;if(e.MenuParentId>-1){let l=PROJ.Menus.find((l=>l.MenuId==e.MenuParentId));if(l)return i(l)}return!1};for(let t of PROJ.Menus){let a=i(t);if(t.MenuShow&&(!IsBoolean(e)||!0===e&&a||!1===e&&!a)){let e=t.MenuGroup;if(t.MenuCustomUrl){let d,r=t.MenuUrl,i=t.MenuId,p=t.MenuText,s="mci_"+EncodeName(p);d=8==(8&t.MenuAnonymous)?Code.true:l?"IsLoggedIn()":Code.true,n.push({id:i,name:s,phrase:`$MenuLanguage->MenuPhrase("${i}", "MenuText")`,url:r,parentId:t.MenuParentId,source:t.MenuSource,security:d,group:e,isCustomUrl:!0,icon:t.MenuIconClass,isNavbarItem:a})}else{let i,p,s,o,_,c,u,g=t.MenuId,f=(t.MenuText,t.MenuUrl);if(IsEmpty(t.MenuSource))try{let e=GetTableObject(t.MenuUrl);if(i="mi_"+e.TblVar,p=e.TblName,"REPORT"==e.TblType)if("custom"==e.TblReportType){let l=EndsText(p,".php")&&e.IncludeFiles,t=EndsText(p,".html")||EndsText(p,".htm");if(!l&&!t)continue;s=l?GetRouteUrl(e.TblReportType,e):p,PROJ.OutputNameLCase&&(s=s.toLowerCase()),t&&e.OutputFolder&&(s=OutputRelativePath(e.OutputFolder)+s)}else s=GetRouteUrl(e.TblReportType,e);else s=GetRouteUrl("list",e);e.TblIsDetail&&(s+="?cmd=resetall"),o=!1,_=d&&[DB.UserLevelTbl,DB.UserLevelPrivTbl].includes(p),"REPORT"==e.TblType&&"custom"==e.TblReportType&&""!=e.TblRptSrc&&(p=e.TblRptSrc),c="'"+PROJ.ProjID+SingleQuote(p)+"'"}finally{}else{p=f.includes("|")?f.split("|")[0]:f,i="mri_"+EncodeName(f),s=t.MenuExtUrl;let e=PROJ.ReportProjectFolder;e&&(s=path.join(e,s).replace("\\","/")),o=8==(8&t.MenuAnonymous),_=!1,c="'"+t.MenuSource+SingleQuote(p)+"'"}u=o?Code.true:r?"AllowListMenu("+c+")":l?"IsLoggedIn() || AllowListMenu("+c+")":Code.true,n.push({id:g,name:i,phrase:`$MenuLanguage->MenuPhrase("${g}", "MenuText")`,url:s,parentId:t.MenuParentId,source:t.MenuSource,security:u,group:e,isCustomUrl:!1,icon:t.MenuIconClass,isNavbarItem:a})}}}return n},global.FormatCode=e=>{let l,t=/^\s*(class|((private|public|protected)\s+)?(static\s+)?function(?! \())\s+/i,a=/^\s*\/\//,d=/^\s*\/\*/,r=/^\s*\*\//,n=/<<<(\w+)/,i=/<!--CUSTOM_FILE_CONTENT_BEGIN-->([\s\S]*)<!--CUSTOM_FILE_CONTENT_END-->/,p="",s=!1,o=0,_=0,c=SameText(CONTROL.CtrlID,"custom"),u="";c&&(l=e.match(i))&&(u=l[1]);let g,f=(e=e.replace(/\n\s+\n/g,"\n\n").replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\n{3,}/g,"\n\n").replace(/\n\n(?!(namespace|use|return|\s*\/[/*]))/g,"\n").replace(/\{(\s*\/\/.*)?\n{2,}/g,"{\n").replace(/\n{2,}(\s+)\}/g,"\n$1}")).split("\n"),m=0,b="";for(let l of f)""==b?((g=l.match(n))?b=RemoveQuotes(g[1]):d.test(l)?(s=!0,_=0,o=1):s?r.test(l)&&(s=!1):a.test(l)?(_=0,o+=1):t.test(l)?(0!=m&&0==o&&(p+="\n"),_=0,o=0):(_+=1,o=0),e.includes("<head>")&&l.includes("</head>")&&ProductVersion&&(l=l.replace(/<\/head>/,`<meta name="generator" content="${productName} ${ProductVersion}">\n</head>`))):l.startsWith(b)&&(b=""),p+=l,m<f.length-1&&(p+="\n"),m++;return c&&l&&(p=p.replace(i,(e=>u))),p=p.trim(),p.startsWith("<?php")&&(p+="\n"),p},global.GetProjectNamespace=()=>(PROJ.ProjectNamespace||product+version)+"\\"+PROJ.ProjVar,global.GetScript=(e,l,t,a,d,r)=>{let n,i,p,s=a||CONTROL,o=d||TABLE,_=r||FIELD,c=s.CtrlID.toLowerCase(),u="";if(SameText(l,"global")?(c="",n="",i=""):SameText(l,"table")||SameText(l,"report")?(l="table",n=o.TblName,i="","info"==c?c="":"reportinfo"==c&&(c=o.TblReportType),"grid"!=c||t.startsWith("ListOptions_")||(c="list")):SameText(l,"field")?(SameText(e,"client")&&(c=""),n=o.TblName,i=_.FldName):SameText(l,"chart")?(SameText(e,"client")&&(c=""),n=o.TblName,i=r.ChartName):(SameText(l,"simple")&&(l="other"),n="",i=""),p=CustomScriptExist(e,l,t,c,n,i)?ScriptItem(e,l,t,c,n,i).ScriptCode:CodeBaseExist(e,l,t)?CodeBaseItem(e,l,t).CodeSource:"",IsEmpty(p)||(p=p.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),SameText(e,"client")&&!(SameText(l,"global")&&SameText(t,"global code")||SameText(t,"form_customvalidate")||["field","chart"].includes(l.toLowerCase()))){if(""!=p.trim()&&(u=p),PROJ.CompressJs&&uglifyJs&&(SameText(t,"client script")||SameText(t,"startup script")))try{u=uglifyJs.minify(u,uglifyJsOptions).code||p}catch(e){console.log(`Warning: Failed to compress ${t} (${l}). ${e.message}`)}}else u=SameText(t,"page_head")||SameText(t,"page_foot")?p.trim().match(/^<[\s\S]+>$/)?p:`<?php\n${p}\n?>`:SameText(e,"client")&&SameText(t,"form_customvalidate")?p.trim():p;return SameText(e,"server")&&!SameText(s.CtrlID,"userfn")&&(u=u.replace(new RegExp("\\bfunction\\s+"+t+"\\b"),"public function "+changeCase.camelCase(t))),u},global.ScriptExist=(e,l,t,a,d,r)=>{let n,i,p,s=a||CONTROL,o=d||TABLE,_=r||FIELD,c=s.CtrlID.toLowerCase();if(SameText(l,"global")?(c="",n="",i=""):SameText(l,"table")||SameText(l,"report")?(l="table",n=o.TblName,i="","info"==c&&(c=""),c.endsWith("info")&&(c=c.substr(0,c.length-4)),"grid"!=c||t.startsWith("ListOptions_")||(c="list")):SameText(l,"field")?(SameText(e,"client")&&(c=""),n=o.TblName,i=_.FldName):SameText(l,"chart")?(SameText(e,"client")&&(c=""),n=o.TblName,i=r.ChartName):(SameText(l,"simple")&&(l="other"),n="",i=""),CustomScriptExist(e,l,t,c,n,i)){p=ScriptItem(e,l,t,c,n,i).ScriptCode;let a=t.toLowerCase();return["page_head","page_foot","customtemplatesearch"].includes(a)||a.startsWith("customtemplate")||"client"==e.toLowerCase()&&["field","chart"].includes(l.toLowerCase())?""!=p.trim():ContainsText(p,t)||ContainsText(p,"function")}return!!CodeBaseExist(e,l,t)&&(p=CodeBaseItem(e,l,t).CodeSource,ContainsText(p,t)||ContainsText(p,"function"))},global.GetServerScript=(e,l,t,a,d)=>GetScript("Server",e,l,t,a,d),global.GetClientScript=(e,l,t,a,d)=>GetScript("Client",e,l,t,a,d),global.GetTemplateScript=(e,l,t,a,d)=>GetScript("Template",e,l,t,a,d),global.ServerScriptExist=(e,l,t,a,d)=>ScriptExist("Server",e,l,t,a,d),global.ClientScriptExist=(e,l,t,a,d)=>ScriptExist("Client",e,l,t,a,d),global.CustomListOptions=e=>{let l;if("list"==CONTROL.CtrlID){if(l="header"==e?GetTemplateScript("Table","CustomTemplateHeader"):"footer"==e?GetTemplateScript("Table","CustomTemplateFooter"):GetTemplateScript("Table","CustomTemplateBody"),/\{{3}(list_options_2)\}{3}/.test(l))return"inline";if(/\{{3}(list_option(\s+\w+)?)\}{3}/.test(l))return"single"}return"block"},global.CustomMultiPageTemplateExist=e=>{let l=e||CONTROL,t=l.CtrlID.toLowerCase(),a=/\{{3}(page_\d+)\}{3}([\s\S]*?)\{{3}\/\1\}{3}/i;if("table"==l.CtrlType.toLowerCase()||"register"==t){return!!GetTemplateScript("register"==t?"Other":"Table","CustomTemplate").match(a)}return!1},global.CustomTemplateExist=e=>{let l=e||CONTROL,t=l.CtrlID.toLowerCase(),a=l.CtrlType.toLowerCase();return"report"==a&&(a="table"),["list","delete","summary"].includes(t)?ScriptExist("Template",a,"CustomTemplateHeader")||ScriptExist("Template",a,"CustomTemplateBody")||ScriptExist("Template",a,"CustomTemplateFooter"):ScriptExist("Template",a,"CustomTemplate")},global.CustomTemplateSearchExist=e=>ScriptExist("Template",(e||CONTROL).CtrlType.toLowerCase(),"CustomTemplateSearch"),global.IsFieldGenerate=(e,l,t,a)=>{let d=a||CONTROL,r=e||TABLE,n=l||FIELD,i=d.CtrlID.toLowerCase();if(["summary","crosstab"].includes(i))return n.FldList;switch(t){case"extbs":return n.FldExtendedBasicSearch;case"search":return n.FldSearch;case"add":case"register":case"addopt":return n.FldRegister&&"register"==i||n.FldAdd&&"add"==i||n.FldAddOpt&&"addopt"==i||n.FldList&&("list"==i&&(r.TblInlineAdd||r.TblInlineCopy||r.TblGridAdd||r.TblGridEdit)||"grid"==i);case"edit":case"update":return n.FldEdit&&"edit"==i||n.FldMultiUpdate&&"update"==i||n.FldList&&("list"==i&&(r.TblInlineEdit||r.TblGridEdit)||"grid"==i)&&!n.FldHtmlTagReadOnly;case"list":return n.FldList&&(r.TblInlineAdd||r.TblInlineCopy||r.TblGridAdd||r.TblGridEdit||r.TblInlineEdit);case"grid":return n.FldList;case"masterfield":return n.FldAdd||n.FldEdit;default:return!1}},global.FieldIsFirstCombo=(e,l,t,a,d)=>{if("grid"==d&&e.TblName!=t.TblName)return FieldIsFirstCombo(e,l,t,a,"masterdetail");let r="masterdetail"==d?"masterfield":d,n="masterdetail"==d?"grid":d;return(["SELECT","RADIO","CHECKBOX"].includes(l.FldHtmlTag)&&IsFieldGenerate(e,l,r)||FieldIsLinkTable(e,l,r)&&"TEXT"==l.FldHtmlTag)&&FieldIsLinkTable(t,a,n)&&["TEXT","SELECT","RADIO","CHECKBOX"].includes(a.FldHtmlTag)&&e.ChildFields.some((e=>e.FldName==l.FldName&&e.ChildField==a.FldName))},global.FieldIsLinkTable=(e,l,t)=>{let a=e||TABLE,d=l||FIELD;return d.FldGenerate&&"Table"==d.FldSelectType&&!IsEmpty(d.FldTagLnkTbl)&&!IsEmpty(d.FldTagLnkFld)&&!IsEmpty(d.FldTagLnkDisplay)&&IsFieldGenerate(a,d,t)},global.GetCustomTemplateHtml=(e,l,t,a,d,r)=>`<div id="${e}" class="${l}"></div>\n${a}\n<div id="${t}">${r}</div>\n</template>\n`,global.GetCustomTemplate=(e,l)=>{let t,a,d,r,n,i=e||CONTROL,p=l||TABLE,s=i.CtrlID.toLowerCase(),o=i.CtrlType.toLowerCase(),_=p.TblVar,c="";if("custom"==s){let e=GetTemplateScript("Table","Content");if(""===e)throw new Error(`The content of the Custom File '${_}' is empty.`);return"\x3c!--CUSTOM_FILE_CONTENT_BEGIN--\x3e"+e+"\x3c!--CUSTOM_FILE_CONTENT_END--\x3e"}if("table"==o||"register"==s){let e=CustomScriptVar();if(n=Code.write(e),"register"==s)d=GetTemplateScript("Other","CustomTemplate"),d=RemoveCustomPageTemplate(d),d=ParseTemplate({template:d,id:"register"});else if(["list","delete"].includes(s)){let l=GetTemplateScript("Table","CustomTemplateHeader");l=RemoveCustomPageTemplate(l),l=ParseTemplate({template:l,id:"header"});let t=GetTemplateScript("Table","CustomTemplateBody");t=RemoveCustomPageTemplate(t),t=ParseTemplate({template:t,id:"body"});let a=GetTemplateScript("Table","CustomTemplateFooter");a=RemoveCustomPageTemplate(a),a=ParseTemplate({template:a,id:"footer"});let r=CustomScriptRowStartVar(),n=CustomScriptRowVar();if(d=`${Code.if(`${n} > 0`)}\n${l}`,IsEmpty(t)||(d+=`<?php for (${e} = ${r}; ${e} <= ${n}; ${e}++) { ?>\n${t}\n${Code.end}\n`),!IsEmpty(a)){let e=Code.getName(PageObject,Code.TotalRecords),l=Code.getName(_,Code.IsGridAdd),t=Code.getName(_,Code.IsGridEdit),r=Code.if(`${e} > 0 && !${l} && !${t}`),n=Code.end;if(ContainsText(a,"<tfoot>")&&ContainsText(a,"</tfoot>"))a=a.replace(/<tfoot>/i,`${r}\n<tfoot>`).replace(/<\/tfoot>/i,`</tfoot>\n${n}`)+"\n";else{let e=/(<\/tbody\s*>)?\s*(<\/table\s*>)\s*$/i,l=a.match(e);if(l){let t=l[1]||"",d=l[2];a=a.replace(e,""),a=IsEmpty(a.trim())?"":`${r}\n${a}\n${n}\n`,a+=t+d+"\n"}else a=`${r}\n${a}\n${n}\n`}d+=a}d+="<?php } ?>\n"}else d=GetTemplateScript("Table","CustomTemplate"),d=RemoveCustomPageTemplate(d),d=ParseTemplate({template:d,id:"body"});IsEmpty(d)||(r=_+s,t=CustomScriptId(r,"div"),a=CustomScriptTag(r,"template"))}else if("summary"==s){let e=CustomScriptGroupVar(),l=CustomScriptDetailRowVar(),t=CustomScriptDetailVar(),a=GetTemplateScript("Table","CustomTemplateHeader");a=ParseTemplate({template:a,id:"header"});let d=GetTemplateScript("Table","CustomTemplateBody");d=ParseTemplate({template:d,id:"body"});let r=GetTemplateScript("Table","CustomTemplateFooter");r=ParseTemplate({template:r,id:"footer"});let n=groupFields.length,i=[],p=[];for(let e=1;e<=n;e++){let l=1==e?"":e;i[e-1]=GetTemplateScript("Table","CustomTemplateGroupHeader"+l),i[e-1]&&(i[e-1]=ParseTemplate({template:i[e-1],id:"groupheader"+l})),p[e-1]=GetTemplateScript("Table","CustomTemplateGroupFooter"+l),p[e-1]&&(p[e-1]=ParseTemplate({template:p[e-1],id:"groupfooter"+l}))}let o=`<?php ${t} = 1; ?>`+a;o+=`<?php\n$cnt = $Page->GroupCount - 1;\nfor (${e} = 1; ${e} <= $cnt; ${e}++) {\n?>\n`;for(let l=0;l<i.length;l++){if(l>0){let t=e+l,a="$cnt"+l,d=e;for(let t=1;t<l;t++)d+=", "+e+t;o+=`<?php\n${a} = $Page->getGroupCount(${d});\nfor (${t} = 1; ${t} <= ${a}; ${t}++) {\n?>\n`}o+=i[l]+"\n"}if(!IsEmpty(d)){let a=e;for(let l=1;l<i.length;l++)a+=", "+e+l;o+=`<?php\nfor (${l} = 1; ${l} <= $Page->getGroupCount(${a}); ${l}++) {\n?>\n`,o+=d+"\n",o+=`<?php\n${t}++;\n}\n?>\n`}for(let e=p.length-1;e>=0;e--)o+=p[e]+"\n",e>0&&(o+="<?php\n}\n?>\n");if(o+=`<?php\nif ($Page->ExportPageBreakCount > 0 && $Page->isExport()) {\nif (${e} % $Page->ExportPageBreakCount == 0 && ${e} < $cnt) {\n?>\n${ParseTemplate({template:"{{{pagebreak}}}",id:"groupfooter"})}\n<?php\n}\n}\n}\n?>\n`,o+=r,!IsEmpty(o)){let e=_+s,l=CustomScriptTag(e,"template");c=`<div id="${CustomScriptId(e,"div")}"></div>\n${l}\n<div id="${"ct_"+GetPageObject()}">${o}</div>\n</template>\n`}}else"other"==o&&(d=GetTemplateScript("Other","CustomTemplate"),d=RemoveCustomPageTemplate(d),d=ParseTemplate({template:d,id:s}),IsEmpty(d)||(t=CustomScriptId(s,"div"),a=CustomScriptTag(s,"template")));if(!IsEmpty(d)){let e="ct_"+GetPageObject(),l=ScriptTemplateClass+"_js";c=GetCustomTemplateHtml(t,"ew-custom-template",e,a,l,d)}return c},global.GetCustomTemplatePage=(e,l,t)=>{let a,d,r,n,i=l||CONTROL,p=t||TABLE,s=i.CtrlID.toLowerCase(),o=i.CtrlType.toLowerCase(),_=p.TblVar,c="";if("table"==o||"register"==s){r=GetTemplateScript("register"==s?"Other":"Table","CustomTemplate");let l=new RegExp("\\{{3}(page_"+e+")\\}{3}([\\s\\S]*?)\\{{3}/\\1\\}{3}","i"),t=r.match(l);t?(r=t[2],r="register"==s?ParseTemplate({template:r,id:"register"}):ParseTemplate({template:r,id:"body"}),MultiPageIndex=e):r="",IsEmpty(r)||(n=_+s+e,a=CustomScriptId(n,"div"),d=CustomScriptTag(n,"template"))}if(!IsEmpty(r)){let l="ct_"+GetPageObject()+e,t=ScriptTemplateClass+"_js";c=GetCustomTemplateHtml(a,"ew-custom-template-page",l,d,t,r)}return c},global.GetCustomTemplateSearch=(e,l)=>{let t,a=e||CONTROL,d=l||TABLE,r=a.CtrlID.toLowerCase(),n=(a.CtrlType.toLowerCase(),d.TblVar),i="";if(t=GetTemplateScript("Table","CustomTemplateSearch"),t=ParseTemplate({template:t,id:"search"}),!IsEmpty(t)){let e=n+r,l=CustomScriptId(e,"searchdiv"),a="ew-custom-template-search",d=CustomScriptTag(e,"searchscript");i=GetCustomTemplateHtml(l,a,e,d,n+"extendedsearch_js",t)}return i},global.GetCustomViewTemplate=(e,l,t)=>{let a=e||TABLE,d=l||FIELD,r=d.FldViewTemplate,n="";if(!IsEmpty(r)){let e=ParseJson(r);if(e&&e.id&&!IsEmpty(e.id)){let l=GetObjectByName(e.id.toLowerCase());l&&l.CustomViewTemplate&&(n=l.CustomViewTemplate(e,a,d))}IsEmpty(n)&&CustomScriptExist("Template","Field","ViewTemplate","",a.TblName,d.FldName)&&(n=ScriptItem("Template","Field","ViewTemplate","",a.TblName,d.FldName).ScriptCode),IsEmpty(n)||(n=ParseFieldTemplate({template:n,source:t,ctlid:"",tbl:a,fld:d}))}return n},global.GetCustomViewTemplateExport=(e,l)=>{let t=e||TABLE,a=l||FIELD,d=a.FldViewTemplate,r="";if(!IsEmpty(d)){let e=ParseJson(d);if(e&&e.id&&!IsEmpty(e.id)){let l=GetObjectByName(e.id.toLowerCase());l&&l.CustomViewTemplateExport&&(r=l.CustomViewTemplateExport(e,t,a))}}return r},global.GetCustomEditTemplate=(e,l,t,a)=>{let d=e||TABLE,r=l||FIELD,n=r.FldEditTemplate,i="";if(!IsEmpty(n)){let e=ParseJson(n);if(e&&e.id&&!IsEmpty(e.id)){let l=GetObjectByName(e.id.toLowerCase());l&&l.CustomEditTemplate&&(i=l.CustomEditTemplate(e,d,r,a))}IsEmpty(i)&&CustomScriptExist("Template","Field","EditTemplate","",d.TblName,r.FldName)&&(i=ScriptItem("Template","Field","EditTemplate","",d.TblName,r.FldName).ScriptCode),IsEmpty(i)||(i=ParseFieldTemplate({template:i,source:t,ctlid:a,tbl:d,fld:r}))}return i},global.HasFileField=(e,l)=>{let t=e||CONTROL,a=l||TABLE,d=t.CtrlID.toLowerCase();return a.Fields.some((e=>"FILE"==e.FldHtmlTag&&("list"==d&&e.FldList&&(a.TblInlineEdit||a.TblGridEdit||a.TblInlineAdd||a.TblInlineCopy||a.TblGridAdd)||"grid"==d&&e.FldList||"add"==d&&e.FldAdd||"addopt"==d&&e.FldAddOpt||"register"==d&&e.FldRegister||"edit"==d&&e.FldEdit||"update"==d&&e.FldMultiUpdate||"search"==d&&e.FldSearch)))},global.IncludeFile=(e,l,t,a)=>{let d=t||CONTROL,r=a||TABLE,n=d.CtrlID.toLowerCase(),i=d.CtrlType.toLowerCase(),p="";return l=!IsBoolean(l)||l,SameText(e,"info")&&["login","index","logout","custompage"].includes(n)?("Use Table"!=PROJ.SecType&&"Both"!=PROJ.SecType||IsEmpty(PROJ.SecTbl)||(r=GetTableObject(PROJ.SecTbl)),""):(SameText(e,"info")&&SameText(i,"field")&&"REPORT"==r.TblType&&(r=GetTableObject(r.TblRptSrc)),""!=(e=GetFileName(e,"",!0,r))&&(p=`include_once ${IncludeFilePathPrefix}"${e}";`,l&&(p=`<?php ${p} ?>`)),p)},global.IsAggregate=e=>(e||TABLE).Fields.some((e=>e.FldList&&e.FldGenerate&&!IsEmpty(e.FldAggregate))),global.IsAutofillMasterField=(e,l,t)=>{let a=e||TABLE,d=l||FIELD,r=IsEmpty(d.FldAutoFillTargetFields)?[]:d.FldAutoFillTargetFields.split("||");return!["extbs","search"].includes(t)&&d.FldAutoFill&&!IsEmpty(d.FldAutoFillSourceFields)&&!IsEmpty(d.FldAutoFillTargetFields)&&a.Fields.some((e=>r.includes(e.FldName)&&IsFieldGenerate(a,e,t)))},global.IsFileRelatedField=(e,l,t)=>{let a=t||CONTROL,d=e||TABLE,r=l||FIELD,n=a.CtrlID.toLowerCase();return d.Fields.some((e=>e.FldGenerate&&"FILE"==e.FldHtmlTag&&e.FldName!=r.FldName&&(["list","grid"].includes(n)&&e.FldList||"add"==n&&e.FldAdd||"addopt"==n&&e.FldAddOpt||"register"==n&&e.FldRegister||"edit"==n&&e.FldEdit||"update"==n&&e.FldMultiUpdate)&&[e.FileTypeFld,e.FileSizeFld,e.FileNameFld,e.ImageWidthFld,e.ImageHeightFld].includes(r.FldName)))},global.IsCrosstabYearField=(e,l)=>{let t=e||TABLE,a=l||FIELD;return"REPORT"==t.TblType&&"crosstab"==t.TblReportType&&a.FldColumnID>0&&"y"==a.FldColumnDateType},global.IsDetailGroupTypeField=(e,l)=>{let t=e||TABLE,a=l||FIELD;return"REPORT"==t.TblType&&"summary"==t.TblReportType&&a.FldGroupBy>0&&!IsEmpty(a.FldGroupByType)&&"n"!=a.FldGroupByType},global.OrderByFieldSources=e=>{let l=e||TABLE,t=GetDbId(l.TblName),a=l;"REPORT"!=l.TblType||IsEmpty(l.TblRptSrc)||(a=GetTableObject(l.TblRptSrc));let d="CUSTOMVIEW"==a.TblType,r=l.Fields.filter((e=>e.FldOrderBy>0&&("crosstab"!=l.TblReportType||e.FldRowID>0))).slice().sort(((e,l)=>e.FldOrderBy-l.FldOrderBy)).map((e=>(d&&!IsEmpty(e.FldSourceName)&&e.FldSourceName!=e.FldName?e.FldSourceName:QuotedName(e.FldName,t))+" "+e.FldOrder)).join(",");if("CUSTOMVIEW"==a.TblType){let e=a.TblCustomSQL,l=SqlPart(e,"LIMIT").trim(),t=SqlPart(e,"GROUP BY").trim();if(havingPart=SqlPart(e,"HAVING").trim(),""==l&&(IsEmpty(t)||IsEmpty(havingPart))){let l=SqlPart(e,"ORDER BY");IsEmpty(l)||(IsEmpty(r)||(r+=", "),r+=l)}}return r},global.KeyUrl=e=>{let l=(e||TABLE).Fields.filter((e=>e.FldIsPrimaryKey)).slice().map((e=>`$this->${e.FldParm}->CurrentValue`)).join(' . Config("COMPOSITE_KEY_SEPARATOR") . ');return IsEmpty(l)&&(l='""'),l},global.AccessControlAllowHeaders=()=>{if(!PROJ.AccessControlAllowHeaders)return"*";let e=new Set([...PROJ.AccessControlAllowHeaders.split(",").map((e=>e.trim())),"X-Requested-With","Content-Type","Accept","Origin"]);return PROJ.ApiJwtAuthHeader&&e.add(PROJ.ApiJwtAuthHeader),Array.from(e).join(", ")},global.PhpQuote=e=>Quote(e).replace(/\$/g,"\\$"),global.PhpWrite=e=>`<?= ${e} ?>`,global.PhpWritePath=e=>`<?= HtmlEncode(GetUrl(${e})) ?>`,global.PhpWriteRawPath=e=>`<?= GetUrl(${e}) ?>`,global.Code={true:"true",false:"false",null:"null",dot:"->",$:"$",this:"this",concatOperator:" . ",else:"<?php } else { ?>",end:"<?php } ?>",bool:e=>e?Code.true:Code.false,castInt:e=>`(int)${e}`,concat:(...e)=>e.join(Code.concatOperator),defined:e=>`defined(PROJECT_NAMESPACE . "${e}")`,emptyString:e=>`EmptyString(${e})`,emptyValue:e=>`EmptyValue(${e})`,encrypt:e=>`Encrypt(${e})`,fldObj:(e,l,t)=>{let a=e||FIELD,d=l||TABLE,r=t||CONTROL,n=r.CtrlID.toLowerCase(),i=r.CtrlTagExt.toLowerCase();return"master"==n?d.TblVar+Code.dot+a.FldParm:("info"==n||"class"==i?Code.this:PageObject)+Code.dot+a.FldParm},getName:(...e)=>Code.$+e.join(Code.dot),globals:e=>`$GLOBALS["${e}"]`,htmlEncode:e=>`HtmlEncode(${e})`,htmlTitle:e=>`HtmlTitle(${e})`,block:e=>`<?php ${e} ?>`,if:e=>`<?php if (${e}) { ?>`,elseIf:e=>`<?php } elseif (${e}) { ?>`,isActive:e=>`isActive(${e})`,jsBool:e=>`${e} ? "true" : "false"`,jsEncode:e=>`JsEncode(${e})`,jsonEncode:e=>`JsonEncode(${e})`,languagePhrase:(e,l)=>`${Code.getName("Language","phrase")}("${Code.quote(e)}"${!0===l?", "+Code.true:""})`,languageProjectPhrase:e=>`${Code.getName("Language","projectPhrase")}("${Code.quote(e)}")`,languageProperty:e=>Code.getName("Language",e),languageTableCaption:e=>`${Code.getName("Language","tablePhrase")}("${Code.quote(e)}", "TblCaption")`,multiPagesItems:e=>`MultiPages${Code.dot}Items[${e}]`,pageCaption:e=>`pageCaption(${e})`,pageStyle:e=>`pageStyle(${e})`,quote:PhpQuote,removeHtml:e=>`RemoveHtml(${e})`,replace:(e,l,t)=>`str_replace(${l}, ${t}, ${e})`,toJson:(e,l)=>`JsonEncode(${e}${l?", "+l:""})`,toString:e=>`strval(${e})`,write:PhpWrite,writePath:PhpWritePath,writeRawPath:PhpWriteRawPath,raw:PhpWrite,Language:{GetTemplate:"getTemplate()",ToJson:"toJson()"},Config:{},Field:{AddErrorMessage:"addErrorMessage",Alt:"alt()",Caption:"caption()",CellAttributes:"cellAttributes()",CustomMsg:"getCustomMessage()",DisplayValue:"displayValue",DisplayValueSeparatorAttribute:"displayValueSeparatorAttribute()",EditAttributes:"editAttributes()",ErrorMessage:"getErrorMessage()",FooterCellClass:"footerCellClass()",GetPlaceHolder:"getPlaceHolder()",GetViewValue:"getViewValue()",HeaderCellClass:"headerCellClass()",HtmlDecode:"htmlDecode",InputTextType:"getInputTextType()",LinkAttributes:"linkAttributes()",LookupCacheOption:"lookupCacheOption",Lookup:"Lookup",MultiUpdateSelected:"multiUpdateSelected()",OldPhysicalUploadPath:"oldPhysicalUploadPath()",OptionCaption:"optionCaption",Options:"options",PhysicalUploadPath:"physicalUploadPath()",SelectOptionListHtml:"selectOptionListHtml",SearchErrorMessage:"getErrorMessage(false)",SessionValue:"getSessionValue()",SetDbValueDef:"setDbValueDef",Sort:"getSort()",TagCaption:"tagCaption",TagValue:"tagValue",Title:"title()",Upload:{},ViewAttributes:"viewAttributes()",IsInvalidClass:"isInvalidClass()",get LookupGetSql(){return this.Lookup+Code.dot+"getSql"},get LookupOptions(){return this.Lookup+Code.dot+"Options"}},BasicSearch:{},CreateConsentCookie:"CreateConsentCookie()",CurrentDetailTable:"getCurrentDetailTable()",CurrentMasterTable:"getCurrentMasterTable()",CurrentPage:"CurrentPage()",CurrentPageHeading:"CurrentPageHeading()",CurrentPageName:"CurrentPageName()",CurrentPageSubheading:"CurrentPageSubheading()",CurrentPageUrl:e=>`CurrentPageUrl(${e?Code.true:Code.false})`,CurrentUserName:"CurrentUserName()",CustomScriptVar:"i",DateFormat:"DATE_FORMAT",DateFormatId:"DATE_FORMAT_ID",DateSeparator:"DATE_SEPARATOR",DecimalPoint:"DECIMAL_POINT",FailureMessage:"getFailureMessage()",GetUserLevelName:"getUserLevelName",IsAdd:"isAdd()",IsAddOrEdit:"isAddOrEdit()",IsAutoLogin:"IsAutoLogin()",IsConfirm:"isConfirm()",IsCopy:"isCopy()",IsEdit:"isEdit()",IsExport:"isExport()",IsExportExcel:'isExport("excel")',IsExportPdf:'isExport("pdf")',IsExportPrint:'isExport("print")',IsExportWord:'isExport("word")',IsGridAdd:"isGridAdd()",IsGridEdit:"isGridEdit()",IsLoggedIn:"IsLoggedIn()",IsShow:"isShow()",IsSysAdmin:"IsSysAdmin()",MultiColumnClass:"getMultiColumnClass()",NavStyle:"navStyle()",Random:"Random()",RelativePath:"RELATIVE_PATH",ReturnUrl:"getReturnUrl()",RowAttributes:"rowAttributes()",SessionId:"session_id()",SortUrl:"sortUrl",ThousandsSeparator:"THOUSANDS_SEP",TimeSeparator:"TIME_SEPARATOR",Render:"render()"},Code=new Proxy(Code,{get:(e,l)=>l in e?e[l]:l}),Code.Config=new Proxy(Code.Config,{get:(e,l)=>`Config("${changeCase.constantCase(l)}")`}),Code.Language=new Proxy(Code.Language,{get:(e,l)=>l in e?e[l]:l}),Code.BasicSearch=new Proxy(Code.BasicSearch,{get:(e,l)=>`BasicSearch${Code.dot}get${l}()`}),Code.Field=new Proxy(Code.Field,{get:(e,l)=>l in e?e[l]:l}),Code.Field.Upload=new Proxy(Code.Field.Upload,{get:(e,l)=>`Upload${Code.dot}${l}`}),global.DefaultChartSize={width:600,height:500},global.CustomScriptGroupVar=()=>Code.getName("i"),global.CustomScriptDetailVar=()=>Code.getName("k"),global.CustomScriptDetailRowVar=()=>Code.getName("j"),global.CustomScriptGroupIndex=(e,l,t)=>{let a=Code.write(Code.getName("Page","GroupCount")),d=e.FldGroupBy>0?e.FldGroupBy:l;for(let e=2;e<=d;e++)a+="_"+Code.write(Code.getName("Page",`GroupCounter[${e}]`));return t||(a+="_"+Code.write(Code.getName("Page","RecordCount"))),a},global.IsFieldDrillDown=e=>!IsEmpty(e.FldDrillTable)&&!IsEmpty(e.FldDrillSourceFields)&&!IsEmpty(e.FldDrillTargetFields),global.FieldDrillDownUrl=e=>{let l="",t=GetTableObject(e.FldDrillTable);if(IsFieldDrillDown(e)&&t){let a=t.TblVar,d=e.FldDrillSourceFields.trim().replace(/\|\|$/,"").split("||"),r=e.FldDrillTargetFields.trim().replace(/\|\|$/,"").split("||");l=GetRouteUrl(t.TblReportType,t)+"?d=1&t="+a+"&s="+TABLE.TblVar,d.length==r.length&&(l=r.reduce(((e,l,a)=>e+"&"+GetFieldObject(t,l).FldParm+"=f"+a),l))}return l},global.SummaryValueName=e=>["sum","avg","min","max","cnt"].includes(e.toLowerCase())?PascalCase(e)+"Value":"",global.SummaryViewValueName=e=>["sum","avg","min","max","cnt"].includes(e.toLowerCase())?PascalCase(e)+"ViewValue":"",global.FieldViewClass=e=>{let l=[];return e.FldBold&&l.push("font-weight-bold"),e.FldItalic&&l.push("font-italic"),l.join(" ")},global.IsDbGroupField=e=>["f","i","y","q","m","w","d","h","min"].includes(e),global.DbGroupSql=(e,l,t)=>{let a="",d=DbType(t);switch(e){case"f":a="ACCESS"==d?"MID(%s,1,%i)":"MSSQL"==d||"MYSQL"==d?"SUBSTRING(%s,1,%i)":"SUBSTR(%s,1,%i)";break;case"i":a="ACCESS"==d?"(%s\\%i)":"MSSQL"==d?"(%s/%i)":"MYSQL"==d?"(%s DIV %i)":"SQLITE"==d?"CAST(%s/%i AS TEXT)":"POSTGRESQL"==d?"(%s/%i)":"FLOOR(%s/%i)";break;case"y":a="ACCESS"==d||"MSSQL"==d||"MYSQL"==d?"YEAR(%s)":"SQLITE"==d?"CAST(STRFTIME('%Y',%s) AS INTEGER)":"TO_CHAR(%s,'YYYY')";break;case"xq":a="ACCESS"==d?"FORMAT(%s,'q')":"MSSQL"==d?"DATEPART(QUARTER,%s)":"MYSQL"==d?"QUARTER(%s)":"SQLITE"==d?"(CAST(STRFTIME('%m',%s) AS INTEGER)+2)/3":"TO_CHAR(%s,'Q')";break;case"q":a="ACCESS"==d?"FORMAT(%s,'yyyy|q')":"MSSQL"==d?"(STR(YEAR(%s),4) + '|' + STR(DATEPART(QUARTER,%s),1))":"MYSQL"==d?"CONCAT(CAST(YEAR(%s) AS CHAR(4)), '|', CAST(QUARTER(%s) AS CHAR(1)))":"SQLITE"==d?"(CAST(STRFTIME('%Y',%s) AS TEXT) || '|' || CAST((CAST(STRFTIME('%m',%s) AS INTEGER)+2)/3 AS TEXT))":"(TO_CHAR(%s,'YYYY') || '|' || TO_CHAR(%s,'Q'))";break;case"xm":a="ACCESS"==d?"FORMAT(%s,'mm')":"MSSQL"==d||"MYSQL"==d?"MONTH(%s)":"SQLITE"==d?"CAST(STRFTIME('%m',%s) AS INTEGER)":"TO_CHAR(%s,'MM')";break;case"m":a="ACCESS"==d?"FORMAT(%s,'yyyy|mm')":"MSSQL"==d?"(STR(YEAR(%s),4) + '|' + REPLACE(STR(MONTH(%s),2,0),' ','0'))":"MYSQL"==d?"CONCAT(CAST(YEAR(%s) AS CHAR(4)), '|', CAST(LPAD(MONTH(%s),2,'0') AS CHAR(2)))":"SQLITE"==d?"CAST(STRFTIME('%Y|%m',%s) AS TEXT)":"(TO_CHAR(%s,'YYYY') || '|' || TO_CHAR(%s,'MM'))";break;case"w":a="ACCESS"==d?"FORMAT(%s,'yyyy|ww')":"MSSQL"==d?"(STR(YEAR(%s),4) + '|' + REPLACE(STR(DATEPART(WEEK,%s),2,0),' ','0'))":"MYSQL"==d?"CONCAT(CAST(YEAR(%s) AS CHAR(4)), '|', CAST(LPAD(WEEK(%s,0),2,'0') AS CHAR(2)))":"SQLITE"==d?"CAST(STRFTIME('%Y|%W',%s) AS TEXT)":"(TO_CHAR(%s,'YYYY') || '|' || TO_CHAR(%s,'WW'))";break;case"d":a="ACCESS"==d?"FORMAT(%s,'yyyy|mm|dd')":"MSSQL"==d?"(STR(YEAR(%s),4) + '|' + REPLACE(STR(MONTH(%s),2,0),' ','0') + '|' + REPLACE(STR(DAY(%s),2,0),' ','0'))":"MYSQL"==d?"CONCAT(CAST(YEAR(%s) AS CHAR(4)), '|', CAST(LPAD(MONTH(%s),2,'0') AS CHAR(2)), '|', CAST(LPAD(DAY(%s),2,'0') AS CHAR(2)))":"SQLITE"==d?"CAST(STRFTIME('%Y|%m|%d',%s) AS TEXT)":"(TO_CHAR(%s,'YYYY') || '|' || LPAD(TO_CHAR(%s,'MM'),2,'0') || '|' || LPAD(TO_CHAR(%s,'DD'),2,'0'))";break;case"h":a="ACCESS"==d||"MSSQL"==d||"MYSQL"==d?"HOUR(%s)":"SQLITE"==d?"CAST(STRFTIME('%H',%s) AS INTEGER)":"TO_CHAR(%s,'HH24')";break;case"min":a="ACCESS"==d||"MSSQL"==d||"MYSQL"==d?"MINUTE(%s)":"SQLITE"==d?"CAST(STRFTIME('%M',%s) AS INTEGER)":"TO_CHAR(%s,'MI')"}return a.replace("%i",l)},global.DateSql=(e,l)=>{switch((e||FIELD).FldDateSearch.toLowerCase()){case"year":return DbGroupSql("y","",l);case"quarter":return DbGroupSql("q","",l);case"month":return DbGroupSql("m","",l);case"day":return DbGroupSql("d","",l);default:return"%s"}},global.IsExtendedFilter=e=>e.FldExtendedBasicSearch,global.IsDateFilter=e=>!IsEmpty(e.FldDateSearch),global.IsTextFilter2=e=>!IsDateFilter(e)&&"SELECT"!=e.FldHtmlTag&&"RADIO"!=e.FldHtmlTag&&"CHECKBOX"!=e.FldHtmlTag,global.IsTextFilter=e=>IsTextFilter2(e)&&(!e.FldModalLookup||IsAutoSuggest(e)),global.IsUseAjax=e=>IsExtendedFilter(e)&&(IsDateFilter(e)||!IsTextFilter(e)&&!(4==GetFieldType(e.FldType)||"ENUM"==e.FldTypeName||"SET"==e.FldTypeName)),global.IsBooleanCheckboxFilter=(e,l)=>"CHECKBOX"==l.FldHtmlTag&&IsBooleanField(e,l),global.GetDropdownDefaultValue=e=>{let l=e||FIELD,t="",a=l.FldDateSearchDefaultYear,d=l.FldDateSearchDefaultQuarter,r=l.FldDateSearchDefaultMonth,n=l.FldDateSearchDefaultDay;switch((l.FldDateSearch||"").toLowerCase()){case"year":IsEmpty(a)||(t=a);break;case"quarter":IsEmpty(a)||IsEmpty(d)||(t=isNaN(a)||isNaN(d)?`${a} . "|" . ${d}`:`"${a}|${d}"`);break;case"month":IsEmpty(a)||IsEmpty(r)||(t=isNaN(a)||isNaN(r)?`${a} . "|" . ${r}`:`"${a}|${r.padStart(2,"0")}"`);break;case"day":IsEmpty(a)||IsEmpty(r)||IsEmpty(n)||(t=isNaN(a)||isNaN(r)||isNaN(n)?`${a} . "|" . ${r} . "|" . ${n}`:`"${a}|${r.padStart(2,"0")}|${n.padStart(2,"0")}"`);break;default:t=l.FldSearchDefault,("CHECKBOX"==l.FldHtmlTag||"SELECT"==l.FldHtmlTag&&l.FldSelectMultiple)&&(IsEmpty(t)||!ContainsText(t,",")||IsArrayString(t)||(t="["+t+"]"))}return IsEmpty(t)&&(t="INIT_VALUE"),t},global.IsArrayString=e=>/^array\([^\)]*\)$/.test(e=e.trim())||/^\[[^\]]*\]$/.test(e),global.IsAggregateSql=e=>e.trim().match(/^(AVG|COUNT|MAX|MIN|SUM)\(/i),global.NullIfFunction=(e,l)=>"ACCESS"==DbType(l)?"IIF("+e+" = 0,NULL,"+e+")":"NULLIF("+e+",0)",global.IsChartDrillDown=e=>!IsEmpty(e.ChartDrillTable)&&!IsEmpty(e.ChartDrillSourceFields)&&!IsEmpty(e.ChartDrillTargetFields),global.ChartDrillDownUrl=e=>{let l='"',t=GetTableObject(e.ChartDrillTable);if(IsChartDrillDown(e)&&t){let a=t.TblVar,d=e.ChartDrillSourceFields.split("||"),r=e.ChartDrillTargetFields.split("||");if(l+="REPORT"==t.TblType?GetRouteUrl(t.TblReportType,t):GetRouteUrl("list",t),l+="?d=1&t="+a+"&s="+TABLE.TblVar,d.length==r.length){let a=0,n=ArrayCombine(d,r);for(let[d,r]of n.entries()){let n,i=GetFieldObject(TABLE,d),p=i.FldName,s=GetFieldObject(t,r).FldParm,o="",_=e.ChartType;n=String(_).startsWith("1")?"":e.ChartSeriesFldName,o=p==e.ChartXFldName?"%0:"+s+":"+i.FldType+"%":p==n?"%1:"+s+":"+i.FldType+"%":"f"+a,l+="&"+s+"="+o,a++}}}return l+='"',l},global.IsDrillDownSource=(e,l)=>{let t=!1;return e&&IsArray(e.Fields)&&(t=e.Fields.filter((e=>IsFieldDrillDown(e))).some((t=>t.FldDrillSourceFields.trim().replace(/\|\|$/,"").split("||").map((l=>GetFieldObject(e,l))).some((e=>e&&e.FldName==l.FldName))))),!t&&e&&IsArray(e.Charts)&&(t=e.Charts.filter((e=>e.ShowChart&&IsChartDrillDown(e))).some((t=>t.ChartDrillSourceFields.trim().replace(/\|\|$/,"").split("||").map((l=>GetFieldObject(e,l))).some((e=>e&&e.FldName==l.FldName))))),t},global.captchaExtName="",global.captchaResponseField="",global.TogglePasswordButton=e=>`<button type="button" class="btn btn-default ew-toggle-password${e?" rounded-right":""}" onclick="ew.togglePassword(event);"><i class="fas fa-eye"></i></button>`,global.EjsOptions={context:global,delimiter:"#",outputFunctionName:"write",escape:e=>e,strict:!0,rmWhitespace:!1,localsName:"args",compileDebug:!!gitPath},global.EjsFileExtensions=["js","ejs","php","html","css","scss"];let project=process.argv[2];if(!project)throw new Error("No project specified");let jsonFile=project;if(jsonFile.toLowerCase().endsWith(".json")||(jsonFile+=".json"),!fs.existsSync(jsonFile))throw new Error(`Project json file '${jsonFile}' not found`);path.isAbsolute(jsonFile)||(jsonFile="./"+jsonFile);let json=require(jsonFile),projectID=json.ProjID.trim();projectID.startsWith("{")||projectID.endsWith("}")||(projectID="{"+projectID+"}"),json.ProjID=projectID,global.DB=json.DB,global.CONTROLS=json.Controls,global.PropertyHandler={get:function(e,l){return l in e?e[l]:l in e.Properties?e.Properties[l]:void 0}},global.PROJ=new Proxy(json,PropertyHandler),global.ProductVersion=PROJ.Version.replace(/^\d+/,version),global.ProjectNamespace=GetProjectNamespace(),global.TABLES=DB.Tables,global.MasterDetails=PROJ.MasterDetails,global.EXTENSIONS=PROJ.Extensions||[],global.Languages=[],global.LanguageFiles=[],global.DefaultLanguageFile=PROJ.DefaultLanguageFile||"english.xml",global.MultiLanguage=PROJ.MultiLanguage,global.LanguageCount=0,global.NodeWriteFileSync=PROJ.NodeWriteFileSync,global.NodeGarbageCollection=PROJ.NodeGarbageCollection;let dbId="DB",dbType=DbType(dbId),_DbMsAccess="ACCESS"==dbType,_DbMsSql="MSSQL"==dbType,_DbMySql="MYSQL"==dbType,_DbPostgreSql="POSTGRESQL"==dbType,_DbOracle="ORACLE"==dbType,_DbSQLite="SQLITE"==dbType;global.IsMsAccess=()=>_DbMsAccess,global.IsMsSQL=()=>_DbMsSql,global.IsMySQL=()=>_DbMySql,global.IsPostgreSQL=()=>_DbPostgreSql,global.IsOracle=()=>_DbOracle,global.IsSQLite=()=>_DbSQLite,PROJ.IsMsAccess=IsMsAccess(),PROJ.IsMsSQL=IsMsSQL(),PROJ.IsMySQL=IsMySQL(),PROJ.IsPostgreSQL=IsPostgreSQL(),PROJ.IsOracle=IsOracle(),PROJ.IsSQLite=IsSQLite();let multiLanguage=PROJ.MultiLanguage;Languages=[];let languageFiles=multiLanguage?PROJ.LanguageFiles:PROJ.DefaultLanguageFile;""==languageFiles&&(languageFiles="english.xml"),LanguageFiles=languageFiles.split(","),LanguageCount=LanguageFiles.length;for(let e=0;e<LanguageCount;e++)LanguageFiles[e]=RemoveQuotes(LanguageFiles[e]),Languages[e]=GetLanguageFileId(LanguageFiles[e]);for(let e of TABLES){if(e.UseSqlAliasForCustomView=!1,"CUSTOMVIEW"==e.TblType){let l=SqlPart(e.TblCustomSQL,"GROUP BY"),t=SqlPart(e.TblCustomSQL,"HAVING"),a=SqlPart(e.TblCustomSQL,"ORDER BY"),d=SqlPart(e.TblCustomSQL,"LIMIT");IsEmpty(l)&&IsEmpty(t)&&IsEmpty(a)&&IsEmpty(d)||(e.UseSqlAliasForCustomView=!0)}e.ChildFields=[],e.ParentFields=[],!HasCustomTemplate&&e.TblGen&&(HasCustomTemplate=CustomScriptExist("Template","Table","","",e.TblName,""))}for(let e of TABLES)for(let l of e.Fields){l.FldParm=l.FldParm||l.FldVar.replace(/^x_/,"");for(let t=1;t<=4;t++){let a=GetParentSelect(l,t),d=GetParentSelectTable(l,t);if(a&&!IsEmpty(a))if(d&&!IsEmpty(d)){let t={FldName:l.FldName,ParentTable:d,ParentField:a},r={FldName:a,Table:e.TblName,ChildField:l.FldName};GetTableObject(d).ChildFields.push(r),e.ParentFields.push(t)}else{let t={FldName:l.FldName,ParentField:a},d={FldName:a,ChildField:l.FldName};e.ChildFields.push(d),e.ParentFields.push(t)}}!CheckPasswordStrength&&l.FldCheckPasswordStrength&&(CheckPasswordStrength=!0),!GeneratePassword&&l.FldGeneratePassword&&(GeneratePassword=!0)}global.TotalFileCount=0,global.FileCount=0,global.CanPhpEncrypt=!0,global.ComposerUpdate=!1,global.GetPath=()=>path,global.GetFS=()=>fs,global.LogStart=e=>{e&&console.log(e),LogCompleted()},global.LogCompleted=(e,l)=>{if(l){if(IsObject(l))throw l;IsString(l)&&console.log(l)}else e&&console.log(e+" generated.");FileCount++,console.log("[32m"+Math.round(100*FileCount/TotalFileCount)+"%[0m")},global.GenerateFile=(e,l,t,a,d,r)=>{if(!e)return void LogCompleted(null,new Error("Failed to generate: Missing control ID."));global.CONTROL=IsObject(e)?e:GetControlObject(e,l),CONTROL.CtrlSkipHeaderFooter=d;let n,i,p=CONTROL.CtrlCond,s=CONTROL.CtrlIFiles,o=CONTROL.CtrlIFolder,_=SameText(CONTROL.CtrlType,"copy");global.TABLE=!_&&t?GetTableObject(t):null,global.FIELD=!_&&TABLE&&a?GetFieldObject(TABLE,a):null;let c=GetFileName(e,l),u=c.toLowerCase(),g=path.join(PROJ.Destination,c),f=u.endsWith(".js"),m=u.endsWith(".min.js"),b=f&&!m&&uglifyJs&&PROJ.CompressJs,F=path.dirname(g),C=c?path.basename(g)+(l?` (${l})`:""):path.basename(o||s),T=GetEventName(s),S=CONTROL.CtrlExt?GetExtensionObject(CONTROL.CtrlExt):null;if(!_&&(S&&S.Template&&(T=PascalCase(path.basename(S.Template,".zip"))+T),n=global[T],!IsFunction(n)))throw new Error(`Missing template "${T}"`);if(p){if(!new Function(`try { return ${p}; } catch(e) { console.log("Invalid condition '${p}' for ${C}"); }`)())return LogStart(),void LogCompleted(C,`Skipped generating ${C}`)}if(_){let e=o?S?path.join(GetExtensionPath(S),o):path.join(templatePath,o):S?path.join(GetExtensionPath(S),s):path.join(templatePath,s);if(fs.statSync(e).isDirectory()){LogStart(`Copying ${C} (folder)...`);try{fsExtra.copySync(e,g),LogCompleted(`${C} (folder)`)}catch(e){LogCompleted(C,e)}return}if(LogStart(`Copying ${C}...`),!fs.existsSync(e))throw new Error(`File ${e} not found.`);if(!b){if(r||global.NodeWriteFileSync){try{fs.copyFileSync(e,g),LogCompleted(C)}catch(e){LogCompleted(C,e)}return}return copyFile(e,g).then((()=>LogCompleted(C))).catch((e=>LogCompleted(C,e)))}i=fs.readFileSync(e,"utf8")}else LogStart(`Generating ${C}...`),i=FormatCode(n(),C);if(global.NodeGarbageCollection&&global.gc&&gc(),i){if(SameText(path.basename(g),"composer.json"))if(fs.existsSync(g)){i!=fs.readFileSync(g,"utf-8")&&(ComposerUpdate=!0)}else ComposerUpdate=!0;else if(b)try{console.log(`Compressing ${C}...`),i=uglifyJs.minify(i,uglifyJsOptions).code||i}catch(e){console.log(`Warning: Failed to compress ${C}. ${e.message}`)}if(fs.existsSync(F)||fs.mkdirSync(F,{recursive:!0}),fs.existsSync(g)&&fs.unlinkSync(g),r||global.NodeWriteFileSync){try{console.log(`Writing ${g}...`),fs.writeFileSync(g,i),LogCompleted(C)}catch(e){LogCompleted(C,e)}return}return writeFile(g,i).then((()=>LogCompleted(C))).catch((e=>LogCompleted(C,e)))}LogCompleted(C,new Error(`Failed to generate ${C}`))},global.PhpEnabled=()=>{let e="PhpIsEnabled";return global.hasOwnProperty(e)||(console.log("Checking PHP CLI..."),global[e]=ExecSync("php -v").toString().startsWith("PHP")),global[e]},global.PhpVersion=()=>{let e="_PhpVersion";if(!global.hasOwnProperty(e)){let l=ExecSync("php -v").toString().match(/^PHP (\d\.\d)/);global[e]=l?parseFloat(l[1]):-1}return global[e]},global.IsPhp73=()=>PhpVersion()>=7.3,global.IsPhp8=()=>PhpVersion()>=8,global.PhpEncryptFilePath=path.join(workPath,"src","phpencrypt.php"),global.PhpEncrypt=(e,l,t)=>{if(CanPhpEncrypt){console.log("Encrypting "+(t||"data")+"...");let a=ExecSync('php "'+PhpEncryptFilePath+'" encrypt "'+e+'" "'+l+'"').toString();if(!a.match(/^[a-z0-9]+$/))throw new Error(`Failed to encrypt ${t||"data"}: ${a}`);return a}return e},global.PhpDecrypt=(e,l,t)=>CanPhpEncrypt?(console.log("Decrypting "+(t||"data")+"..."),ExecSync('php "'+PhpEncryptFilePath+'" decrypt "'+e+'" "'+l+'"').toString()):e,global.CheckPhpDecrypt=()=>{let e=PROJ.EncryptionKey,l="PhpEncryptTestString",t=PROJ.OtherGenList.split(",").includes("ewconfig=1");if(!IsEmpty(e)&&t&&PROJ.EncryptUsernamePassword)if(PhpEnabled()){let t=PhpEncryptFilePath;if(fs.existsSync(t)){let t=PhpEncrypt(l,e,"test data");l!==PhpDecrypt(t,e,"test data")&&(CanPhpEncrypt=!1,console.log("PHP encryption test failed. Unable to encrypt sensitive data such as password."))}else CanPhpEncrypt=!1,console.log("PHP encryption file not found. Unable to encrypt sensitive data such as password.")}else CanPhpEncrypt=!1,console.log("PHP CLI not enabled. Unable to encrypt sensitive data such as password.")},global.NetworkDrive="",global.CheckNetworkDrive=()=>{try{let e=PROJ.Destination.replace(/\\$/,"");if(e.startsWith("\\\\")&&(ExecSync("chcp 437"),""==NetworkDrive)){let l=ExecSync("net use").toString(),t=/(\w+)[ \t]+(\w)\:[ \t]+\\\\([ \S]+?)(Microsoft Windows Network)?[\r\n]/g,a=!1;if(l.replace(t,((l,t,d,r)=>{""==NetworkDrive&&SameText("\\\\"+r.trim(),e.trim())&&("OK"==t?NetworkDrive=d+":":(console.log("Network drive "+d+": ("+e+") error. Status: "+t+". Please check."),a=!0))})),a)return!1;if(""!=NetworkDrive)console.log("Use existing network drive "+NetworkDrive);else{let l=ExecSync('net use * "'+e+'"').toString(),t=/^Drive (\w)\:/.exec(l);console.log(l),NetworkDrive=t[1]+":"}}}catch(e){return NetworkDrive="",console.log("Setup network drive failed. Error: "+e.message),!1}return!0},global.RunComposerUpdate=()=>{if(PROJ.Composer&&ComposerUpdate&&PhpEnabled()){let e="composer update -n";if(IsPhp8()&&(e+=" --ignore-platform-req php"),console.log(`Running ${e}...`),Exec(e,{stdio:"inherit"}),NetworkDrive){let e=NetworkDrive+"\\vendor\\composer\\autoload_static.php",l=fs.readFileSync(e,"utf-8"),t=new RegExp(EscapeRegExChars("'"+NetworkDrive+"\\\\"),"g");l=l.replace(t,"__DIR__ . '/../..' . '"),fs.writeFileSync(e,l)}}},global.Exec=(e,l)=>{let t=process.cwd();try{let a=NetworkDrive?NetworkDrive+"\\":ExcludeTrailingPathDelimiter(PROJ.Destination);process.chdir(a),ExecSync(e,l)}finally{process.chdir(t)}},global.GetGenerateFiles=()=>{let e=[];for(let l of TABLES)if(!IsEmpty(l.TblGenList)){let t=l.TblGenList.split(","),a=l.TblName;for(let l of t){let d=l.split("="),r=d[0].split("|"),n=d[1]||"1",i=r[0];if(["1","3"].includes(n)){let l="3"==n,d=r[1]||"";if("class"==d){if(SameText(i,"custom")&&!EndsText(a,".php"))continue;l=t.some((e=>e.match(new RegExp(i+"(|view)?=3"))))}e.push([i,d,a,"",l])}}}let l=PROJ.OtherGenList.split(",");for(let t of l){let a=t.split("="),d=a[0].split("|"),r=a[1]||"1",n=d[0];if(!n.startsWith("@")&&["1","3"].includes(r)){let t=d[1],a=GetControlObject(n,t),i="3"==r;"class"==t&&(i=l.some((e=>e.match(new RegExp(n+"(|view)?=3"))))),a&&["simple","other","copy"].includes(a.CtrlType)&&(a.CtrlIFolder||a.CtrlIFiles)&&(["simple","other"].includes(a.CtrlType)&&a.CtrlIFolder&&!a.CtrlIFile?fs.readdirSync(path.join(templatePath,a.CtrlIFolder)).forEach(((l,t)=>e.push([{...a,CtrlID:a.CtrlIFolder+l,CtrlIFolder:"",CtrlIFiles:path.join(a.CtrlIFolder,l)},"","","",!1,!0]))):e.push([a,t,"","",i]))}}return TotalFileCount=2*e.length,FileCount=0,e},global.CompileTemplate=e=>{e.forEach((e=>{let[l,t]=e,a=IsObject(l)?l:GetControlObject(l,t),d=path.join(templatePath,a.CtrlIFiles),r=a.CtrlExt?GetExtensionObject(a.CtrlExt):null;if(SameText(a.CtrlType,"copy"))return;r&&r.Template&&(d=path.join(GetExtensionPath(r),a.CtrlIFiles));let n=GetEventName(d);if(gitPath&&console.log(`Checking template id="${a.CtrlID}"${t?" ("+t+")":""}...`),!global[n])if(fs.existsSync(d)){let e=Object.assign({},EjsOptions,{eventName:n,views:[templatePath]}),l=ejs.fileLoader(d,"utf-8");gitPath&&console.log(`Compiling [${r?r.Name:"template"}] ${n} (${d})...`),global[n]=ejs.compile(l,e)}else{let e=l+(t?`/${t}`:"");console.log(`Error: Control (${e}) file path '${d}' not found`)}}))};let templateName=path.basename(PROJ.Template,".zip"),appDataPath=path.join(process.env.APPDATA,product,templateName),templatePath=gitPath?path.join(gitPath,"template/"+templateName):path.join(appDataPath,"template");global.GetEventName=e=>{let l=path.extname(e),t=path.basename(e),a=path.basename(path.resolve(e,"../.."));return".ejs"==l&&(t=path.basename(t,l)),["extensions","customedittags","customviewtags"].includes(a)&&(t=path.basename(path.dirname(e))+" "+t),PascalCase(t)},global.CompileExtensions=()=>{for(let e of EXTENSIONS)if(e.Enabled&&e.Template){let l=GetExtensionPath(e);if(!fs.existsSync(l)){console.log(`Error: ${l} does not exist.`);continue}{let t=`${path.basename(e.Template,".zip")}.js`,a=path.join(l,t);fs.existsSync(a)&&require(a),fs.readdirSync(l,{withFileTypes:!0}).filter((a=>{let d=path.join(l,a.name),r=path.extname(d);fs.statSync(d);return a.isFile()&&EjsFileExtensions.includes(r.substr(1))&&!SameText(a.name,t)&&!SameText(a.name,"index.js")&&!CONTROLS.find((l=>SameText(l.CtrlIFiles,a.name)&&SameText(l.CtrlExt,e.Name)&&SameText(l.CtrlAction,"add")))})).forEach((e=>{let t=path.join(l,e.name),a=(path.extname(t),GetEventName(t)),d=ejs.fileLoader(t,"utf-8");global[a]=ejs.compile(d,Object.assign({},EjsOptions,{eventName:a,views:[templatePath]})),Events.on(GetEventName(e.name),(e=>{global[a].call(global,e)}))}))}}},global.CompileFunctions=()=>{if(gitPath)fs.readdirSync(syscodePath,{withFileTypes:!0}).filter((e=>e.isFile()&&".ejs"==path.extname(e.name))).forEach((e=>{let l=path.join(syscodePath,e.name),t=ejs.fileLoader(l,"utf-8"),a=GetEventName(l),d=Object.assign({},EjsOptions,{eventName:a});global[a]=ejs.compile(t,d)}));else if(IsObject(global.sources))for(let e in sources){let l=GetEventName(e),t=Object.assign({},EjsOptions,{eventName:l}),a=new ejs.Template(null,t);a.source=sources[e],global[e]=a.compile()}},CheckNetworkDrive()||process.exit(1);let usercodeFile=path.join(workPath,"src","usercode.js");fs.existsSync(usercodeFile)||(usercodeFile=path.join(appDataPath,"usercode.js")),fs.existsSync(usercodeFile)&&require(usercodeFile);let uglifyJs=PROJ.Properties.CompressJs?require(path.join(workPath,"node","node_modules","terser")):null;global.uglifyJsOptions={output:{comments:"some"}},console.log(`Running ${process.argv[0]} (${process.version})...`),Events.emit("BeginGenerate"),ComposerUpdate=PROJ.Restore,CheckPhpDecrypt(),CompileFunctions(),CompileExtensions();let files=GetGenerateFiles();CompileTemplate(files);let promises=files.map((e=>GenerateFile.apply(null,e)));Promise.all(promises).then((()=>{let e=process.hrtime.bigint(),l=String(e-hrstart),t=l.length>6?Number(l.substring(0,l.length-6))/1e3:0;console.log(`All files generated. (${(new Intl.NumberFormat).format(t)} seconds)`),Events.emit("EndGenerate"),RunComposerUpdate()})).catch((e=>console.error(e)));